<!-- BulkLP.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>ãƒ‡ã‚¿ã‚¦ãƒª.Detauri - ã‚¢ã‚½ãƒ¼ãƒˆå•†å“</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Noto Sans JP',sans-serif;background:#f5f5f5;color:#333;-webkit-font-smoothing:antialiased}
.container{max-width:1100px;margin:0 auto;background:#fff;min-height:100vh}

/* === Aæ¡ˆ 4-Row Header (Mobile) / 3-Row Header (Desktop) === */
.header{background:linear-gradient(135deg,#1a1a2e,#16213e);color:#fff;position:sticky;top:0;z-index:100;max-width:1100px;margin:0 auto}
.header-row1{display:flex;align-items:center;justify-content:center;gap:4px 12px;padding:6px 16px;flex-wrap:wrap}
.header-logo{font-size:15px;font-weight:800;white-space:nowrap;margin:0;letter-spacing:1px;color:#fff;flex-shrink:0;width:100%;text-align:center;max-height:30px;overflow:hidden;opacity:1;transition:max-height .25s ease,opacity .25s ease}
.header.row2-hidden .header-logo{max-height:0;opacity:0}
.header-nav{display:flex;gap:6px;flex-shrink:0}
.header-nav a{color:#93c5fd;text-decoration:none;font-size:11px;padding:4px 12px;border-radius:20px;border:1px solid rgba(255,255,255,.15);transition:all .2s;white-space:nowrap}
.header-nav a.active{background:#ffd700;color:#1a1a2e;border-color:#ffd700;font-weight:700}
.header-auth-wrap{display:none;align-items:center;gap:6px;font-size:12px;flex-shrink:1;min-width:0}
.header-cart-mob{display:flex;align-items:center;flex-shrink:0}
.header-row2{display:flex;justify-content:center;align-items:center;gap:8px;padding:2px 16px 4px}
.header-row3{display:flex;justify-content:center;gap:16px;padding:0 16px 6px;max-height:28px;overflow:hidden;opacity:1;transition:max-height .25s ease,opacity .25s ease,padding .25s ease}
.header-row3 a{color:#93c5fd;text-decoration:none;font-size:11px;font-weight:600;transition:color .2s;white-space:nowrap}
.header-row3 a:hover{color:#bfdbfe}
.header.row2-hidden .header-row3{max-height:0;opacity:0;padding-top:0;padding-bottom:0}
.member-badge{display:inline-block;font-size:10px;background:rgba(255,215,0,.15);color:#ffd700;padding:3px 10px;border-radius:12px;border:1px solid rgba(255,215,0,.3);white-space:nowrap;max-width:180px;overflow:hidden;text-overflow:ellipsis}

/* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.section{padding:20px}
.section-title{font-size:14px;font-weight:700;color:#1a1a2e;border-left:4px solid #ffd700;padding-left:10px;margin-bottom:14px}
.divider{height:1px;background:#eee;margin:0 20px}

/* å•†å“ã‚°ãƒªãƒƒãƒ‰ */
.product-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px}

/* å•†å“ã‚«ãƒ¼ãƒ‰ */
.product-card{border:1px solid #e8e8e8;border-radius:12px;overflow:hidden;background:#fff;transition:box-shadow .2s}
.product-card:hover{box-shadow:0 4px 16px rgba(0,0,0,.08)}
.product-images{position:relative;width:100%;aspect-ratio:1/1;background:#eee;overflow:hidden;cursor:pointer}
.product-images img{width:100%;height:100%;object-fit:cover;display:none}
.product-images img.active{display:block}
.img-dots{position:absolute;bottom:8px;left:50%;transform:translateX(-50%);display:flex;gap:6px}
.img-dot{width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,.5);cursor:pointer}
.img-dot.active{background:#fff}
.img-nav{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,.3);color:#fff;border:none;width:30px;height:30px;border-radius:50%;font-size:14px;cursor:pointer;display:none}
.img-nav.prev{left:8px}
.img-nav.next{right:8px}
.product-images:hover .img-nav{display:block}
.no-image{width:100%;aspect-ratio:1/1;background:#e0e0e0;display:flex;align-items:center;justify-content:center;color:#999;font-size:13px;cursor:pointer}
.product-body{padding:14px}
.product-name{font-size:14px;font-weight:700;color:#1a1a2e}
.product-desc{font-size:12px;color:#888;margin-top:4px;line-height:1.5;display:none}
.product-tag{display:inline-block;font-size:10px;background:#fff3cd;color:#856404;padding:2px 8px;border-radius:10px;margin-top:6px;font-weight:600}
.product-bottom{display:flex;align-items:center;justify-content:space-between;margin-top:12px;gap:8px}
.product-price-area{display:flex;flex-direction:column;gap:2px;min-width:0}
.product-price{font-size:20px;font-weight:800;color:#e74c3c}
.product-price small{font-size:12px;font-weight:400;color:#999}
.product-price .original{font-size:13px;font-weight:400;color:#999;text-decoration:line-through;margin-right:6px}
.product-price .disc-badge{display:inline-block;font-size:10px;background:#e74c3c;color:#fff;padding:2px 6px;border-radius:4px;margin-left:4px;font-weight:700;vertical-align:middle}
.qty-control{display:flex;align-items:center;border:1px solid #ddd;border-radius:8px;overflow:hidden}
.qty-btn{width:36px;height:36px;border:none;background:#f5f5f5;font-size:18px;cursor:pointer;color:#555;font-weight:700}
.qty-btn:active{background:#e0e0e0}
.qty-value{width:40px;height:36px;text-align:center;border:none;border-left:1px solid #ddd;border-right:1px solid #ddd;font-size:15px;font-weight:700;color:#333;background:#fff}

/* SOLD OUT */
.product-card.sold-out{opacity:.7;position:relative}
.sold-out-overlay{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;z-index:2;pointer-events:none}
.sold-out-badge{background:rgba(0,0,0,.6);color:#fff;font-size:20px;font-weight:900;padding:10px 24px;border-radius:8px;letter-spacing:2px}
.sold-out .qty-control{opacity:.3;pointer-events:none}

/* å•†å“è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« */
.modal-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);z-index:1000;justify-content:center;align-items:center;padding:20px}
.modal-overlay.active{display:flex}
.modal-content{background:#fff;border-radius:16px;max-width:600px;width:100%;max-height:90vh;overflow:hidden;position:relative;display:flex;flex-direction:column}
.modal-close{position:absolute;top:12px;right:12px;width:36px;height:36px;border-radius:50%;border:none;background:rgba(0,0,0,.5);color:#fff;font-size:20px;cursor:pointer;z-index:3;display:flex;align-items:center;justify-content:center;line-height:1}
.modal-close:hover{background:rgba(0,0,0,.7)}
.modal-fixed-top{flex-shrink:0}
.modal-images{position:relative;width:100%;aspect-ratio:4/3;background:#eee;overflow:hidden}
.modal-images img{width:100%;height:100%;object-fit:contain;display:none;background:#f0f0f0}
.modal-images img.active{display:block}
.modal-images .img-nav{display:block;width:36px;height:36px;font-size:18px}
.modal-images .img-dots{bottom:12px}
.modal-images .img-dot{width:10px;height:10px}
.modal-thumbs{display:flex;gap:8px;padding:12px 16px;overflow-x:auto}
.modal-thumbs img{width:64px;height:64px;object-fit:cover;border-radius:8px;cursor:pointer;border:2px solid transparent;flex-shrink:0;transition:border-color .2s}
.modal-thumbs img.active{border-color:#1a1a2e}
.modal-right{display:flex;flex-direction:column;flex:1;overflow:hidden;min-height:0}
.modal-title-bar{flex-shrink:0;padding:16px 20px 0;background:#fff}
.modal-title-bar .product-name{font-size:18px;margin:0}
.modal-title-bar .modal-stock{font-size:12px;color:#888;margin-top:6px}
.modal-scroll{flex:1;overflow-y:auto;min-height:0}
.modal-body{padding:12px 20px 20px}
.modal-body .product-name{font-size:18px;margin-bottom:8px}
.modal-body .product-desc{display:block;font-size:13px;color:#666;line-height:1.7;margin-bottom:12px;white-space:pre-wrap}
.modal-body .product-tag{margin-bottom:12px}
.modal-fixed-bottom{flex-shrink:0;padding:0 20px 20px;border-top:1px solid #eee;background:#fff}
.modal-fixed-bottom .product-bottom{display:flex;align-items:center;justify-content:space-between;padding-top:14px}
.modal-fixed-bottom .product-price{font-size:24px}

/* ã‚«ãƒ¼ãƒˆ */
.cart-summary{background:#f8f9fa;border-radius:12px;padding:14px}
.cart-row{display:flex;justify-content:space-between;align-items:center;font-size:13px;padding:6px 0;border-bottom:1px solid #eee}
.cart-row-name{flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding-right:4px}
.cart-row-ctrl{display:inline-flex;align-items:center;gap:3px;flex-shrink:0;width:76px;justify-content:center}
.cart-row-qty{font-size:12px;min-width:26px;text-align:center}
.cart-cqbtn{padding:2px 7px;font-size:13px;border:1px solid #bbb;border-radius:5px;background:#fff;cursor:pointer;line-height:1.4}
.cart-delbtn{flex-shrink:0;width:26px;height:26px;margin-right:6px;padding:0;border:1px solid #e88;border-radius:5px;background:#fff;color:#c33;cursor:pointer;display:inline-flex;align-items:center;justify-content:center}
.cart-row-price{flex-shrink:0;min-width:62px;text-align:right;margin-left:6px}
.cart-row:last-child{border-bottom:none}
.cart-row.total{font-weight:800;font-size:16px;color:#1a1a2e;border-top:2px solid #1a1a2e;margin-top:8px;padding-top:12px}
.cart-empty{text-align:center;color:#aaa;font-size:13px;padding:20px 0}

/* ã‚¯ãƒ¼ãƒãƒ³ */
.coupon-row{display:flex;gap:8px;margin-bottom:14px}
.coupon-row input{flex:1;padding:8px 10px;border:1px solid #ddd;border-radius:8px;font-size:13px}
.coupon-row button{padding:8px 16px;border:1px solid #1a1a2e;border-radius:8px;background:#fff;font-size:12px;font-weight:700;cursor:pointer}
.coupon-result{font-size:12px;margin-bottom:10px;padding:6px 10px;border-radius:6px;display:none}
.coupon-result.ok{background:#d4edda;color:#155724;display:block}
.coupon-result.err{background:#f8d7da;color:#721c24;display:block}
.coupon-result.loading{background:#fff3cd;color:#856404;display:block}
.coupon-row button:disabled{opacity:0.6;cursor:not-allowed}

/* ãƒ•ã‚©ãƒ¼ãƒ  */
.form-group{margin-bottom:12px}
.form-label{display:block;font-size:12px;font-weight:600;color:#555;margin-bottom:4px}
.form-label .req{color:#e74c3c;font-size:10px;margin-left:4px}
.form-input{width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:8px;font-size:14px;background:#fafafa}
.form-input:focus{outline:none;border-color:#1a1a2e;background:#fff}
.form-row{display:flex;gap:10px}
.form-row .form-group{flex:1}
.form-note{font-size:11px;color:#999;margin-top:3px}

/* æ±ºæ¸ˆãƒœã‚¿ãƒ³ */
.pay-button{width:100%;padding:16px;border:none;border-radius:12px;background:linear-gradient(135deg,#1a1a2e,#16213e);color:#fff;font-size:16px;font-weight:700;cursor:pointer;letter-spacing:1px;margin-top:8px;transition:box-shadow .2s}
.pay-button:hover{box-shadow:0 4px 20px rgba(26,26,46,.3)}
.pay-button:disabled{opacity:.5;cursor:not-allowed}
.pay-methods{display:flex;justify-content:center;gap:10px;margin-top:10px;flex-wrap:wrap}
.pay-badge{font-size:10px;color:#777;background:#f0f0f0;padding:4px 10px;border-radius:4px;font-weight:600}

/* ãƒ‡ã‚¿ã‚¦ãƒªèª˜å° */
.detauri-banner{margin:20px;border-radius:12px;background:linear-gradient(135deg,#0f3460,#16213e);color:#fff;padding:20px;text-align:center}
.detauri-banner h3{font-size:15px;font-weight:700}
.detauri-banner p{font-size:12px;color:#aab;margin-top:6px;line-height:1.6}
.detauri-banner .cta-btn{display:inline-block;margin-top:12px;padding:10px 24px;background:#ffd700;color:#1a1a2e;font-weight:700;font-size:13px;border-radius:24px;text-decoration:none}

/* ãƒ•ãƒƒã‚¿ãƒ¼ */
.footer{background:#1a1a2e;color:#888;text-align:center;padding:20px 20px 80px;font-size:11px;max-width:1100px;margin-left:auto;margin-right:auto}
.footer a{color:#aab;text-decoration:none}

/* ãƒšãƒ¼ã‚¸é·ç§»ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
#pageTransition{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#1a1a2e,#16213e);z-index:9999;display:flex;justify-content:center;align-items:center;opacity:0;pointer-events:none;transition:opacity .25s ease}
#pageTransition.active,body.page-entering #pageTransition{opacity:1;pointer-events:all}
#pageTransition .pt-content{text-align:center;color:#fff}
#pageTransition .pt-title{font-size:20px;font-weight:700;letter-spacing:2px}
#pageTransition .pt-sub{font-size:12px;color:#aab;margin-top:6px}

/* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
.loading{text-align:center;padding:60px 20px;color:#999}
.spinner{display:inline-block;width:24px;height:24px;border:3px solid #ddd;border-top-color:#1a1a2e;border-radius:50%;animation:spin .8s linear infinite;margin-bottom:8px}
@keyframes spin{to{transform:rotate(360deg)}}

/* ã‚¨ãƒ©ãƒ¼ */
.error-msg{background:#f8d7da;color:#721c24;padding:10px 14px;border-radius:8px;font-size:13px;margin-bottom:12px;display:none}

/* ç®¡ç†è€…ãƒãƒ¼ */
.admin-bar{background:#b8002a;color:#fff;text-align:center;padding:6px 14px;font-size:12px;font-weight:700;letter-spacing:1px;display:none;position:sticky;top:0;z-index:22;}
.admin-bar span{background:rgba(255,255,255,.2);padding:2px 8px;border-radius:4px;margin-left:8px;font-size:11px;font-weight:400;}
.admin-bar .admin-exit{background:rgba(255,255,255,.25);border:1px solid rgba(255,255,255,.5);color:#fff;padding:3px 10px;border-radius:12px;font-size:11px;font-weight:700;cursor:pointer;margin-left:10px;}
.admin-bar .admin-exit:hover{background:rgba(255,255,255,.4);}
body.admin-mode .header{border-top:3px solid #b8002a}

/* ãƒ—ãƒ­ãƒ¢ãƒãƒŠãƒ¼ */
.promo-banner{background:linear-gradient(90deg,#b8002a,#e63950);color:#fff;text-align:center;padding:10px 40px 10px 14px;font-size:13px;font-weight:400;position:sticky;top:0;z-index:102;display:none;max-width:1100px;margin:0 auto}
.promo-banner a{color:#fff;text-decoration:underline;margin-left:8px;font-weight:900}
.promo-banner a:hover{color:#ffd700}
.promo-banner .promo-close{position:absolute;right:10px;top:50%;transform:translateY(-50%);background:none;border:none;color:#fff;font-size:18px;cursor:pointer;padding:4px 8px;opacity:.8}
.promo-banner .promo-close:hover{opacity:1}

/* ãƒ˜ãƒƒãƒ€ãƒ¼èªè¨¼ã‚¨ãƒªã‚¢ */
.header-auth{display:flex;align-items:center;gap:6px;font-size:12px}
.auth-btn{background:rgba(255,255,255,.15);border:1px solid rgba(255,255,255,.3);border-radius:20px;padding:6px 16px;cursor:pointer;font-weight:700;font-size:12px;color:#fff;transition:all .2s}
.auth-btn:hover{background:rgba(255,255,255,.25)}
.auth-btn.logout{background:transparent;border:none;color:#aab;text-decoration:underline;padding:4px 8px;font-size:11px}
.auth-user{display:flex;align-items:center;gap:6px;font-size:12px;color:#fff}
.auth-user-name{font-weight:700;max-width:120px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.auth-discount{background:#e74c3c;color:#fff;font-size:10px;padding:2px 6px;border-radius:4px;font-weight:700}
.auth-points{background:#e65100;color:#fff;font-size:10px;padding:2px 6px;border-radius:4px;font-weight:700}
.auth-btn.mypage{background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.3);font-size:11px;padding:4px 12px;border-radius:20px}
.cart-header-btn{position:relative;padding:4px 10px!important;font-size:16px!important;background:rgba(255,255,255,.12)!important;border:1px solid rgba(255,255,255,.3)!important;border-radius:20px!important;cursor:pointer;color:#fff;line-height:1}
.mypage-tabs{display:flex;gap:0;border-bottom:2px solid #e0e0e0;margin-bottom:16px}
.mypage-tab{background:none;border:none;padding:10px 18px;font-size:14px;font-weight:600;color:#888;cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-2px;transition:color .2s,border-color .2s}
.mypage-tab:hover{color:#333}
.mypage-tab.active{color:#b8002a;border-bottom-color:#b8002a}
.mypage-content{min-height:120px}
.mp-order-card{border:1px solid #e8e8e8;border-radius:8px;padding:14px;margin-bottom:10px;background:#fafafa}
.mp-order-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;flex-wrap:wrap;gap:6px}
.mp-order-no{font-weight:700;font-size:14px;color:#333}
.mp-order-date{font-size:12px;color:#999}
.mp-order-status{font-size:12px;padding:2px 8px;border-radius:10px;font-weight:600}
.mp-order-status.done{background:#e8f5e9;color:#2e7d32}
.mp-order-status.pending{background:#fff3e0;color:#e65100}
.mp-order-status.active{background:#e3f2fd;color:#1565c0}
.mp-order-products{font-size:12px;color:#666;line-height:1.5;margin-bottom:6px}
.mp-order-footer{display:flex;justify-content:space-between;font-size:13px;flex-wrap:wrap;gap:4px}
.mp-order-total{font-weight:700;color:#333}

/* èªè¨¼ãƒ¢ãƒ¼ãƒ€ãƒ« */
.auth-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);z-index:1001;justify-content:center;align-items:center;padding:20px}
.auth-overlay.active{display:flex}
.auth-modal{background:#fff;border-radius:16px;max-width:440px;width:100%;max-height:90vh;overflow-y:auto;position:relative}
.auth-modal-header{padding:16px 20px;border-bottom:1px solid #eee;display:flex;align-items:center;justify-content:space-between}
.auth-modal-title{font-size:16px;font-weight:700;color:#1a1a2e}
.auth-modal-close{background:none;border:none;font-size:22px;cursor:pointer;padding:4px 8px;color:#999;line-height:1}
.auth-modal-body{padding:20px}
.auth-field{margin-bottom:12px}
.auth-field label{display:block;font-size:12px;font-weight:600;color:#555;margin-bottom:4px}
.auth-field input{width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:8px;font-size:14px;background:#fafafa}
.auth-field input:focus{outline:none;border-color:#1a1a2e;background:#fff}
.auth-submit{width:100%;padding:14px;border:none;border-radius:10px;background:#1a1a2e;color:#fff;font-size:15px;font-weight:700;cursor:pointer;margin-top:8px}
.auth-submit:hover{background:#16213e}
.auth-submit:disabled{opacity:.5;cursor:not-allowed}
.auth-switch{text-align:center;margin-top:14px;font-size:13px;color:#666}
.auth-switch a{color:#1a1a2e;font-weight:700;text-decoration:none}
.auth-error{background:#f8d7da;color:#721c24;padding:8px 12px;border-radius:6px;font-size:12px;margin-bottom:10px;display:none}
.pw-wrap{position:relative;display:flex;align-items:center}
.pw-wrap input{flex:1;padding-right:38px}
.pw-toggle{position:absolute;right:6px;background:none;border:none;cursor:pointer;font-size:16px;padding:4px;opacity:.5;line-height:1}
.pw-toggle:hover{opacity:.8}

/* ç®¡ç†è¨­å®šFAB */
.admin-settings-fab{position:fixed;left:16px;bottom:76px;z-index:31;width:48px;height:48px;border-radius:50%;background:#b8002a;color:#fff;border:none;cursor:pointer;display:none;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(0,0,0,.3);font-size:22px;transition:transform .2s;}
.admin-settings-fab:hover{transform:scale(1.1);}
body.admin-mode .admin-settings-fab{display:flex;}
.settings-panel{position:fixed;left:16px;bottom:136px;z-index:55;width:min(380px,90vw);background:#fff;border-radius:14px;border:1px solid #e6e8ee;box-shadow:0 10px 30px rgba(0,0,0,.25);display:none;overflow:hidden;}
.settings-panel.open{display:block;}
.settings-panel .sp-header{padding:12px 14px;border-bottom:1px solid #e6e8ee;display:flex;align-items:center;justify-content:space-between;background:#f8f9fa;}
.settings-panel .sp-title{font-weight:900;font-size:15px;}
.settings-panel .sp-close{background:transparent;border:none;font-size:20px;cursor:pointer;padding:4px 8px;line-height:1;}
.settings-panel .sp-body{padding:12px 14px;overflow:auto;max-height:60vh;}
.settings-panel .sp-section{margin-bottom:14px;padding-bottom:12px;border-bottom:1px solid #f0f0f0;}
.settings-panel .sp-section:last-child{margin-bottom:0;padding-bottom:0;border-bottom:none;}
.settings-panel .sp-section-title{font-weight:900;font-size:13px;margin-bottom:8px;color:#333;}
.settings-panel .sp-btn-row{display:flex;gap:8px;flex-wrap:wrap;}
.settings-panel .sp-btn{padding:8px 10px;border:1px solid #d9deea;border-radius:8px;background:#fff;cursor:pointer;font-weight:700;font-size:12px;}
.settings-panel .sp-btn.primary{background:#111;color:#fff;border-color:#111;}
.settings-panel .sp-btn:disabled{opacity:.5;cursor:not-allowed;}
.settings-panel .sp-mode-row{display:flex;align-items:center;gap:10px;flex-wrap:wrap;}
.settings-panel .sp-badge{display:inline-block;padding:3px 8px;border-radius:6px;font-weight:900;font-size:12px;}
.settings-panel .sp-badge.test{background:#fff3cd;color:#856404;border:1px solid #ffc107;}
.settings-panel .sp-badge.live{background:#d4edda;color:#155724;border:1px solid #28a745;}
.settings-panel .sp-badge.on{background:#d4edda;color:#155724;border:1px solid #28a745;}
.settings-panel .sp-badge.off{background:#f8d7da;color:#721c24;border:1px solid #dc3545;}
.settings-panel .sp-info{font-size:11px;color:#666;margin-top:4px;}
.settings-panel .sp-log{font-size:11px;color:#333;white-space:pre-wrap;line-height:1.4;margin-top:8px;max-height:80px;overflow:auto;background:#f8f9fa;border-radius:6px;padding:6px 8px;display:none;}

/* ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆç‰¹å•†æ³•ãƒ»ãŠå•ã„åˆã‚ã›ï¼‰ */
.bulk-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:500;}
.bulk-overlay.active{display:block;}
.bulk-modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;border-radius:16px;width:min(700px,94vw);max-height:85vh;overflow-y:auto;z-index:501;box-shadow:0 12px 40px rgba(0,0,0,.2);}
.bulk-modal-header{padding:14px 18px;border-bottom:1px solid #eee;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;background:#fff;z-index:1;border-radius:16px 16px 0 0;}
.bulk-modal-title{font-size:16px;font-weight:700;color:#1a1a2e;}
.bulk-modal-close{background:none;border:none;font-size:22px;cursor:pointer;padding:4px 8px;color:#999;line-height:1;}
.bulk-modal-body{padding:18px;}

/* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒˆãƒƒãƒ—ãƒœã‚¿ãƒ³ */
.toTop{position:fixed;right:14px;bottom:76px;width:46px;height:46px;border-radius:999px;border:1px solid #d9deea;background:#fff;display:none;align-items:center;justify-content:center;font-weight:900;z-index:70;box-shadow:0 6px 18px rgba(0,0,0,.12);transition:all .3s ease;}
.toTop.show{display:flex;}

/* ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ */
.chatbot-fab{position:fixed;bottom:16px;right:16px;z-index:9999;width:48px;height:48px;border-radius:50%;background:#1e293b;color:#fff;border:none;cursor:pointer;box-shadow:0 2px 10px rgba(0,0,0,.2);display:flex;align-items:center;justify-content:center;transition:transform .2s,background .2s;}
.chatbot-fab:hover{transform:scale(1.08);background:#334155;}
.chatbot-fab:hover::after{content:'AI\30C1\30E3\30C3\30C8\30DC\30C3\30C8';position:absolute;bottom:calc(100% + 8px);right:0;background:rgba(30,41,59,.9);color:#fff;font-size:11px;padding:5px 10px;border-radius:6px;white-space:nowrap;pointer-events:none;}
.chatbot-fab svg{width:24px;height:24px;fill:#fff;}
.chatbot-fab .chatbot-fab-close{display:none;}
.chatbot-badge{display:none!important;}
.chatbot-panel{position:fixed;bottom:76px;right:16px;z-index:9998;width:360px;max-width:calc(100vw - 32px);height:480px;max-height:calc(100vh - 200px);background:#fff;border-radius:16px;box-shadow:0 8px 32px rgba(0,0,0,.18);display:none;flex-direction:column;overflow:hidden;border:1px solid #e6e8ee;}
.chatbot-panel.open{display:flex;}
.chatbot-header{background:#1e293b;color:#fff;padding:14px 16px;font-weight:700;font-size:14px;display:flex;align-items:center;gap:8px;flex-shrink:0;}
.chatbot-header-actions{display:flex;align-items:center;gap:6px;margin-left:auto;}
.chatbot-header-toTop{width:30px;height:30px;border-radius:50%;border:1.5px solid rgba(255,255,255,.35);background:transparent;color:#fff;font-weight:900;font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s;}
.chatbot-header-toTop:hover{background:rgba(255,255,255,.15);border-color:rgba(255,255,255,.6);}
.chatbot-close-btn{width:30px;height:30px;border-radius:50%;border:1.5px solid rgba(255,255,255,.35);background:transparent;color:#fff;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s;line-height:1;}
.chatbot-close-btn:hover{background:rgba(255,255,255,.15);border-color:rgba(255,255,255,.6);}
.chatbot-header svg{width:20px;height:20px;fill:#fff;flex-shrink:0;}
.chatbot-messages{flex:1;overflow-y:auto;padding:12px 14px;display:flex;flex-direction:column;gap:10px;scroll-behavior:smooth;}
.chatbot-msg{max-width:85%;padding:10px 14px;border-radius:14px;font-size:13px;line-height:1.55;word-break:break-word;white-space:pre-wrap;}
.chatbot-msg.bot{align-self:flex-start;background:#f1f5f9;color:#1e293b;border-bottom-left-radius:4px;}
.chatbot-msg.user{align-self:flex-end;background:#1e293b;color:#fff;border-bottom-right-radius:4px;}
.chatbot-msg.typing{align-self:flex-start;background:#f1f5f9;padding:10px 18px;}
.chatbot-msg.typing .dot{display:inline-block;width:7px;height:7px;border-radius:50%;background:#94a3b8;margin:0 2px;animation:chatDot 1.4s infinite both;}
.chatbot-msg.typing .dot:nth-child(2){animation-delay:.2s;}
.chatbot-msg.typing .dot:nth-child(3){animation-delay:.4s;}
@keyframes chatDot{0%,80%,100%{opacity:.3;transform:scale(.8);}40%{opacity:1;transform:scale(1);}}
.chatbot-input-area{display:flex;gap:8px;padding:10px 12px;border-top:1px solid #e6e8ee;background:#fafbfc;flex-shrink:0;}
.chatbot-input-area textarea{flex:1;border:1px solid #d9deea;border-radius:10px;padding:9px 12px;font-size:13px;resize:none;outline:none;font-family:inherit;min-height:38px;max-height:80px;line-height:1.4;}
.chatbot-input-area textarea:focus{border-color:#1e293b;}
.chatbot-send-btn{width:38px;height:38px;border-radius:10px;border:none;background:#1e293b;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:background .15s;}
.chatbot-send-btn:hover{background:#334155;}
.chatbot-send-btn:disabled{opacity:.4;cursor:not-allowed;}
.chatbot-send-btn svg{width:18px;height:18px;fill:#fff;}
.chatbot-quick-replies{display:flex;flex-wrap:wrap;gap:6px;margin-top:4px;}
.chatbot-quick-btn{display:inline-block;padding:7px 13px;border-radius:18px;border:1.5px solid #e2e8f0;background:#fff;color:#334155;font-size:12px;cursor:pointer;transition:all .15s;white-space:nowrap;font-weight:500;}
.chatbot-quick-btn:hover{background:#eff6ff;border-color:#93c5fd;color:#2563eb;}
.chatbot-quick-category{font-size:11px;color:#64748b;font-weight:600;margin-top:8px;margin-bottom:2px;padding-left:2px;}
.chatbot-quick-category:first-child{margin-top:0;}
.chatbot-contact-link{display:inline-flex;align-items:center;gap:4px;margin-top:10px;padding:8px 16px;border-radius:10px;background:#fef2f2;border:1px solid #fecaca;color:#dc2626;font-size:12px;font-weight:600;cursor:pointer;transition:all .15s;text-decoration:none;}
.chatbot-contact-link:hover{background:#fee2e2;border-color:#f87171;}
.chatbot-contact-form{background:#f8fafc;border:1px solid #e2e8f0;border-radius:10px;padding:12px;margin-top:6px;}
.chatbot-contact-form label{display:block;font-size:11px;font-weight:600;color:#555;margin-bottom:3px;margin-top:8px;}
.chatbot-contact-form label:first-child{margin-top:0;}
.chatbot-contact-form input,.chatbot-contact-form textarea{width:100%;padding:8px 10px;border:1px solid #d9deea;border-radius:8px;font-size:13px;font-family:inherit;box-sizing:border-box;}
.chatbot-contact-form textarea{resize:none;min-height:60px;}
.chatbot-contact-form input:focus,.chatbot-contact-form textarea:focus{border-color:#1e293b;outline:none;}
.chatbot-contact-btn{display:inline-block;margin-top:10px;padding:8px 18px;border:none;border-radius:8px;background:#1e293b;color:#fff;font-size:13px;font-weight:700;cursor:pointer;}
.chatbot-contact-btn:disabled{opacity:.5;cursor:not-allowed;}
.chatbot-staff-btn{display:inline-flex;align-items:center;gap:4px;margin-top:6px;padding:7px 14px;border:1px solid #1e293b;border-radius:8px;background:#fff;color:#1e293b;font-size:12px;font-weight:600;cursor:pointer;}
.chatbot-staff-btn:hover{background:#f1f5f9;}
@media(max-width:480px){.chatbot-panel{bottom:0;right:0;left:0;width:100%;max-width:100%;height:100%;max-height:100%;border-radius:0;}.chatbot-fab{bottom:12px;right:12px;width:44px;height:44px;}.chatbot-fab svg{width:22px;height:22px;}.chatbot-fab:hover::after{display:none;}}

/* PC ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
@media(min-width:768px){
  body{background:#e0e0e0}
  .container{max-width:1100px;border-radius:0;box-shadow:none}
  .header-row1{display:grid;grid-template-columns:1fr auto 1fr;padding:10px 24px;gap:12px;align-items:center}
  .header-logo{font-size:17px;width:auto;text-align:left;max-height:none;overflow:visible;transition:none;opacity:1;justify-self:start}
  .header.row2-hidden .header-logo{max-height:none;opacity:1}
  .header-nav{justify-self:center}
  .header-nav a{font-size:12px;padding:5px 14px}
  .header-auth-wrap{display:flex;justify-self:end}
  .header-cart-mob{display:none}
  .header-row2{display:none}
  .header-row3{padding:0 24px 8px;gap:20px}
  .header-row3 a{font-size:12px}
  .section{padding:28px 40px}
  .product-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}
  .product-card{margin-bottom:0}
  .product-body{padding:16px}
  .product-name{font-size:15px}
  .product-price{font-size:18px}
  .product-price small{font-size:11px}
  .qty-btn{width:32px;height:32px;font-size:16px}
  .qty-value{width:36px;height:32px;font-size:14px}
  .pc-two-col{display:grid;grid-template-columns:minmax(0,1fr) minmax(0,1fr);gap:32px;align-items:start}
  .cart-summary{padding:18px}
  .detauri-banner{margin:28px 40px}
  .modal-content{max-width:900px;flex-direction:row;max-height:80vh}
  .modal-fixed-top{width:50%;flex-shrink:0;display:flex;flex-direction:column}
  .modal-images{aspect-ratio:1/1}
  .modal-right{width:50%;display:flex;flex-direction:column;overflow:hidden}
  .modal-scroll{flex:1;overflow-y:auto}
  .modal-fixed-bottom{flex-shrink:0}
  .modal-close{top:8px;right:8px}
}

@media(min-width:560px) and (max-width:767px){
  body{display:flex;justify-content:center;padding:20px;background:#e0e0e0}
  .container{border-radius:20px;overflow:hidden;box-shadow:0 8px 40px rgba(0,0,0,.15)}
  .product-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px}
  .product-card{margin-bottom:0}
}

@media(max-width:559px){
  .product-grid{grid-template-columns:repeat(2,1fr);gap:10px}
  .product-body{padding:10px}
  .product-name{font-size:12px}
  .product-bottom{flex-direction:column;align-items:flex-start}
  .product-price{font-size:16px}
  .product-price small{font-size:10px}
  .product-price .original{font-size:11px}
  .qty-control{margin-top:6px}
  .qty-btn{width:30px;height:30px;font-size:14px}
  .qty-value{width:32px;height:30px;font-size:12px}
}
</style>
</head>
<body>
<script>(function(){try{if(sessionStorage.getItem('_pageTransition')==='1'){document.body.style.background='#1a1a2e';document.body.classList.add('page-entering');sessionStorage.removeItem('_pageTransition');}}catch(e){}try{if((typeof google==='undefined'||!google.script)&&window.location.pathname.indexOf('BulkLP')!==-1){history.replaceState(null,'','/');}}catch(e){}})()</script>
<!-- ç®¡ç†è€…ãƒãƒ¼ -->
<div class="admin-bar" id="adminBar">ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰<span>ã‚¢ã‚½ãƒ¼ãƒˆå•†å“</span><button class="admin-exit" id="adminExit" type="button">ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰è§£é™¤</button></div>

<!-- ãƒ—ãƒ­ãƒ¢ãƒãƒŠãƒ¼ -->
<div class="promo-banner" id="promoBanner">
  æœŸé–“é™å®šï¼šä¼šå“¡ç™»éŒ²ã§å…¨å“<strong>10%OFF</strong>ï¼ˆ2026å¹´9æœˆæœ«ã¾ã§ãƒ»30ç‚¹å‰²å¼•ã¨ä½µç”¨å¯ï¼‰<a href="#" id="promoRegisterLink">ä»Šã™ãç„¡æ–™ç™»éŒ² ï¼</a>
  <button class="promo-close" id="promoClose" type="button">âœ•</button>
</div>

<div id="pageTransition"><div class="pt-content"><div class="pt-title">ãƒ‡ã‚¿ã‚¦ãƒª.Detauri</div><div class="pt-sub">èª­ã¿è¾¼ã¿ä¸­...</div></div></div>

<!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
<header class="header">
  <div class="header-row1">
    <h1 class="header-logo" id="appTitle">ãƒ‡ã‚¿ã‚¦ãƒª.Detauri</h1>
    <nav class="header-nav">
      <a id="detauriLink" href="./">æ¡å¯¸ä»˜ãå€‹å“ï¼ˆãƒ‡ã‚¿ã‚¦ãƒªï¼‰</a>
      <a class="active" href="#">ã‚¢ã‚½ãƒ¼ãƒˆå•†å“</a>
    </nav>
    <div class="header-cart-mob" id="headerCartMob"></div>
    <div class="header-auth-wrap">
      <div class="header-auth" id="headerAuth">
        <button class="auth-btn" id="openAuthBtn" type="button">ãƒ­ã‚°ã‚¤ãƒ³ / æ–°è¦ç™»éŒ²</button>
      </div>
    </div>
  </div>
  <div class="header-row2">
    <div class="header-auth" id="headerAuthMob">
      <button class="auth-btn" id="openAuthBtnMob" type="button">ãƒ­ã‚°ã‚¤ãƒ³ / æ–°è¦ç™»éŒ²</button>
    </div>
  </div>
  <div class="header-row3">
    <a href="#" id="openBulkGuideLink">å•†å“ã‚¬ã‚¤ãƒ‰</a>
    <a href="#" id="openBulkShippingLink">ã‚¢ã‚½ãƒ¼ãƒˆé€æ–™è¡¨</a>
    <a href="#" id="openContactLinkHeader">ãŠå•ã„åˆã‚ã›</a>
  </div>
</header>

<div class="container">

<!-- èªè¨¼ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="auth-overlay" id="authOverlay">
  <div class="auth-modal">
    <div class="auth-modal-header">
      <div class="auth-modal-title" id="authModalTitle">ãƒ­ã‚°ã‚¤ãƒ³</div>
      <button class="auth-modal-close" id="authCloseBtn" type="button">&times;</button>
    </div>
    <div class="auth-modal-body">
      <div class="auth-error" id="authError"></div>
      <!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ  -->
      <div id="loginForm">
        <div class="auth-field">
          <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
          <input id="loginEmail" type="email" autocomplete="email">
        </div>
        <div class="auth-field">
          <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
          <div class="pw-wrap"><input id="loginPassword" type="password" autocomplete="current-password"><button type="button" class="pw-toggle" onclick="togglePw(this)">&#x1F441;</button></div>
        </div>
        <div class="auth-field" style="margin-top:-4px;">
          <label style="display:flex;align-items:center;gap:6px;cursor:pointer;font-weight:400;font-size:13px;">
            <input type="checkbox" id="rememberMe" style="width:16px;height:16px;">
            ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹ï¼ˆ30æ—¥é–“ï¼‰
          </label>
        </div>
        <button class="auth-submit" id="loginBtn" type="button">ãƒ­ã‚°ã‚¤ãƒ³</button>
        <div class="auth-switch">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã§ãªã„æ–¹ã¯ <a href="#" id="showRegisterLink">æ–°è¦ç™»éŒ²</a></div>
        <div style="text-align:center;margin-top:8px;font-size:12px;color:#888;">
          <a href="#" id="showForgotPwLink" style="color:#666;">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¿˜ã‚ŒãŸæ–¹</a>
          <span style="margin:0 6px;">|</span>
          <a href="#" id="showForgotEmailLink" style="color:#666;">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å¿˜ã‚ŒãŸæ–¹</a>
        </div>
      </div>
      <!-- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  -->
      <div id="forgotPwForm" style="display:none;">
        <p style="font-size:13px;color:#555;margin:0 0 14px;">ç™»éŒ²æ¸ˆã¿ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ä»®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒ¡ãƒ¼ãƒ«ã§ãŠé€ã‚Šã—ã¾ã™ã€‚</p>
        <div class="auth-field">
          <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
          <input id="resetEmail" type="email" autocomplete="email">
        </div>
        <button class="auth-submit" id="resetPwBtn" type="button">ä»®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’é€ä¿¡</button>
        <div class="auth-switch"><a href="#" id="backToLoginFromReset">ãƒ­ã‚°ã‚¤ãƒ³ã«æˆ»ã‚‹</a></div>
      </div>
      <!-- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ç¢ºèªãƒ•ã‚©ãƒ¼ãƒ  -->
      <div id="forgotEmailForm" style="display:none;">
        <p style="font-size:13px;color:#555;margin:0 0 14px;">ã”ç™»éŒ²æ™‚ã®ä¼šç¤¾å/æ°åã¨é›»è©±ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ç™»éŒ²ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒ’ãƒ³ãƒˆã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p>
        <div class="auth-field">
          <label>ä¼šç¤¾å/æ°å</label>
          <input id="recoverCompanyName" type="text">
        </div>
        <div class="auth-field">
          <label>é›»è©±ç•ªå·</label>
          <input id="recoverPhone" type="tel" inputmode="numeric">
        </div>
        <div id="recoverEmailResult" style="display:none;margin:12px 0;padding:12px;background:#f0f7ff;border-radius:6px;font-size:14px;text-align:center;"></div>
        <button class="auth-submit" id="recoverEmailBtn" type="button">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç¢ºèª</button>
        <div class="auth-switch"><a href="#" id="backToLoginFromRecover">ãƒ­ã‚°ã‚¤ãƒ³ã«æˆ»ã‚‹</a></div>
      </div>
      <!-- ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ  -->
      <div id="registerForm" style="display:none;">
        <div class="auth-field">
          <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ *</label>
          <input id="regEmail" type="email" autocomplete="email">
        </div>
        <div class="auth-field">
          <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆ6æ–‡å­—ä»¥ä¸Šï¼‰ *</label>
          <div class="pw-wrap"><input id="regPassword" type="password" autocomplete="new-password"><button type="button" class="pw-toggle" onclick="togglePw(this)">&#x1F441;</button></div>
        </div>
        <div class="auth-field">
          <label>ä¼šç¤¾å/æ°å *</label>
          <input id="regCompanyName" type="text" autocomplete="name">
        </div>
        <div class="auth-field">
          <label>é›»è©±ç•ªå·</label>
          <input id="regPhone" type="tel" inputmode="numeric">
        </div>
        <div class="auth-field">
          <label>éƒµä¾¿ç•ªå·</label>
          <input id="regPostal" type="text" inputmode="numeric" placeholder="0000000">
        </div>
        <div class="auth-field">
          <label>ä½æ‰€</label>
          <input id="regAddress" type="text" autocomplete="street-address">
        </div>
        <div class="auth-field">
          <label style="display:flex;align-items:center;gap:8px;cursor:pointer;font-weight:400;">
            <input type="checkbox" id="regNewsletter" checked style="width:18px;height:18px;">
            <span>ãŠå¾—ãªæƒ…å ±ã‚’ãƒ¡ãƒ¼ãƒ«ã§å—ã‘å–ã‚‹</span>
          </label>
        </div>
        <button class="auth-submit" id="registerBtn" type="button">ç™»éŒ²ã™ã‚‹</button>
        <div class="auth-switch">æ—¢ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã®æ–¹ã¯ <a href="#" id="showLoginLink">ãƒ­ã‚°ã‚¤ãƒ³</a></div>
      </div>
    </div>
  </div>
</div>

<!-- å•†å“ä¸€è¦§ -->
<section class="section" id="productSection">
  <div class="section-title">ã‚¢ã‚½ãƒ¼ãƒˆå•†å“</div>
  <div class="product-grid" id="productList">
    <div class="loading"><div class="spinner"></div><div>èª­ã¿è¾¼ã¿ä¸­...</div></div>
  </div>
</section>

<!-- å•†å“è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal-overlay" id="productModal" onclick="closeModalOverlay(event)">
  <div class="modal-content">
    <button class="modal-close" onclick="closeModal()">&times;</button>
    <div class="modal-fixed-top">
      <div class="modal-images" id="modalImages"></div>
      <div class="modal-thumbs" id="modalThumbs"></div>
    </div>
    <div class="modal-right">
      <div class="modal-title-bar" id="modalTitleBar"></div>
      <div class="modal-scroll">
        <div class="modal-body" id="modalBody"></div>
      </div>
      <div class="modal-fixed-bottom" id="modalBottom"></div>
    </div>
  </div>
</div>

<div class="divider"></div>

<!-- ã‚«ãƒ¼ãƒˆãƒ»ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆPC: 2ã‚«ãƒ©ãƒ ï¼‰ -->
<div class="pc-two-col section">
<div>

<!-- ã‚«ãƒ¼ãƒˆ -->
<div>
  <div class="section-title" style="display:flex;align-items:center;justify-content:space-between;">
    <span>ã”æ³¨æ–‡å†…å®¹</span>
    <div id="cartClearBtns" style="display:none;gap:6px;flex-wrap:wrap;"></div>
  </div>
  <div id="cartSection">
    <div class="cart-empty">å•†å“ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
  </div>
</div>

<div style="height:20px"></div>

<!-- ã‚¯ãƒ¼ãƒãƒ³ -->
<div>
  <div class="section-title">ã‚¯ãƒ¼ãƒãƒ³</div>
  <div class="coupon-row">
    <input type="text" id="couponInput" placeholder="ã‚¯ãƒ¼ãƒãƒ³ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›" style="text-transform:uppercase">
    <button id="couponBtn" onclick="applyCoupon()">é©ç”¨</button>
  </div>
  <div class="coupon-result" id="couponResult"></div>
  <p style="font-size:12px;margin:6px 0 0;color:#c00;font-weight:700;">2æœˆæœ«ã¾ã§ã€ŒFREE_SHIPPING_20260228ã€ã‚’å…¥åŠ›ã§é€æ–™ç„¡æ–™<br><span style="font-size:11px;color:#888;font-weight:400;">â€»ä¾¡æ ¼ç ´å£Šå•†å“ã¯å¯¾è±¡å¤–ã§ã™</span></p>
</div>

</div>
<div>

<!-- ãŠå±Šå…ˆæƒ…å ± -->
<div>
  <div class="section-title">ãŠå±Šå…ˆæƒ…å ±</div>
  <div class="error-msg" id="formError"></div>

  <div class="form-group">
    <label class="form-label">ä¼šç¤¾å / æ°å<span class="req">å¿…é ˆ</span></label>
    <input class="form-input" type="text" id="companyName" placeholder="ä¾‹ï¼šå±±ç”°å¤ªéƒ">
  </div>

  <div class="form-group">
    <label class="form-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹<span class="req">å¿…é ˆ</span></label>
    <input class="form-input" type="email" id="contact" placeholder="example@mail.com">
  </div>

  <div class="form-row">
    <div class="form-group" style="flex:.4">
      <label class="form-label">éƒµä¾¿ç•ªå·<span class="req">å¿…é ˆ</span></label>
      <input class="form-input" type="text" id="postal" placeholder="000-0000" maxlength="8">
    </div>
    <div class="form-group" style="flex:.6">
      <label class="form-label">é›»è©±ç•ªå·<span class="req">å¿…é ˆ</span></label>
      <input class="form-input" type="tel" id="phone" placeholder="090-0000-0000">
    </div>
  </div>

  <div class="form-group">
    <label class="form-label">ä½æ‰€<span class="req">å¿…é ˆ</span></label>
    <input class="form-input" type="text" id="address" placeholder="éƒ½é“åºœçœŒãƒ»å¸‚åŒºç”ºæ‘ãƒ»ç•ªåœ°">
    <div class="form-note">â€» éƒµä¾¿ç•ªå·å…¥åŠ›ã§ä½æ‰€ãŒè‡ªå‹•å…¥åŠ›ã•ã‚Œã¾ã™</div>
  </div>

  <div class="form-group">
    <label class="form-label">å»ºç‰©åãƒ»éƒ¨å±‹ç•ªå·</label>
    <input class="form-input" type="text" id="building" placeholder="ãƒãƒ³ã‚·ãƒ§ãƒ³åãƒ»å·å®¤ãªã©">
  </div>

  <div class="form-group">
    <label class="form-label">å‚™è€ƒ</label>
    <input class="form-input" type="text" id="note" placeholder="å‚™è€ƒãŒã‚ã‚Šã¾ã—ãŸã‚‰ã”è¨˜å…¥ãã ã•ã„">
  </div>

  <!-- æ±ºæ¸ˆãƒœã‚¿ãƒ³ -->
  <button class="pay-button" id="payButton" onclick="submitOrder()" disabled>
    ã‚«ãƒ¼ãƒˆãŒç©ºã§ã™
  </button>

  <div class="pay-methods">
    <span class="pay-badge">ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰</span>
    <span class="pay-badge">ã‚³ãƒ³ãƒ“ãƒ‹æ‰•ã„</span>
    <span class="pay-badge">éŠ€è¡ŒæŒ¯è¾¼</span>
    <span class="pay-badge">PayPay</span>
  </div>
</div>

</div>
</div>

<div class="divider"></div>

<!-- ãƒ‡ã‚¿ã‚¦ãƒªèª˜å° -->
<div class="detauri-banner">
  <h3>1ç‚¹ãšã¤é¸ã³ãŸã„æ–¹ã¯ã“ã¡ã‚‰</h3>
  <p>å…¨å“æ¡å¯¸ãƒ‡ãƒ¼ã‚¿ä»˜ãã€‚ã‚µã‚¤ã‚ºãƒ»ãƒ–ãƒ©ãƒ³ãƒ‰ãƒ»çŠ¶æ…‹ã‚’ç¢ºèªã—ãªãŒã‚‰1ç‚¹ãšã¤ãŠé¸ã³ã„ãŸã ã‘ã¾ã™ã€‚</p>
  <a id="detauriBannerLink" class="cta-btn" href="./">ãƒ‡ã‚¿ã‚¦ãƒªã§å•†å“ã‚’è¦‹ã‚‹ â†’</a>
</div>

<!-- ç®¡ç†è¨­å®šFAB + ãƒ‘ãƒãƒ« -->
<button class="admin-settings-fab" id="adminSettingsFab" type="button" title="ç®¡ç†è¨­å®š">&#9881;</button>
<div class="settings-panel" id="settingsPanel">
  <div class="sp-header">
    <div class="sp-title">ç®¡ç†è¨­å®š</div>
    <button class="sp-close" id="settingsClose" type="button">&times;</button>
  </div>
  <div class="sp-body">
    <div class="sp-section">
      <div class="sp-section-title">ç®¡ç†</div>
      <div class="sp-btn-row">
        <button class="sp-btn primary" id="spBtnCompact" type="button">æœŸé™åˆ‡ã‚Œç¢ºä¿ã®æ•´ç†</button>
        <button class="sp-btn" id="spBtnRebuild" type="button">çŠ¶æ…‹ã®å†æ§‹ç¯‰</button>
      </div>
      <div class="sp-btn-row" style="margin-top:6px;">
        <button class="sp-btn" id="spBtnClearCache" type="button">å•†å“ã‚­ãƒ£ãƒƒã‚·ãƒ¥å‰Šé™¤</button>
        <button class="sp-btn" id="spBtnApplyDv" type="button">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³é©ç”¨</button>
      </div>
      <div class="sp-log" id="spLog"></div>
    </div>
    <div class="sp-section">
      <div class="sp-section-title">KOMOJU æ±ºæ¸ˆãƒ¢ãƒ¼ãƒ‰</div>
      <div class="sp-mode-row">
        <span class="sp-badge" id="spModeBadge">èª­è¾¼ä¸­...</span>
        <button class="sp-btn primary" id="spBtnToggleMode" type="button" disabled>åˆ‡æ›¿</button>
      </div>
      <div class="sp-info" id="spModeKeys"></div>
    </div>
    <div class="sp-section">
      <div class="sp-section-title">ä¼šå“¡å‰²å¼•</div>
      <div class="sp-mode-row">
        <span class="sp-badge" id="spDiscountBadge">èª­è¾¼ä¸­...</span>
        <button class="sp-btn primary" id="spBtnToggleDiscount" type="button" disabled>åˆ‡æ›¿</button>
      </div>
      <div class="sp-info" id="spDiscountInfo"></div>
    </div>
  </div>
</div>

<!-- å•†å“ã‚¬ã‚¤ãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="bulk-overlay" id="bulkGuideOverlay"></div>
<div class="bulk-modal" id="bulkGuideModal" style="display:none;">
  <div class="bulk-modal-header">
    <div class="bulk-modal-title">å•†å“ã‚¬ã‚¤ãƒ‰</div>
    <button class="bulk-modal-close" id="bulkGuideCloseBtn" type="button">&times;</button>
  </div>
  <div class="bulk-modal-body" style="line-height:1.7;">
    <div style="margin-bottom:20px;">
      <h3 style="margin:0 0 12px;font-size:16px;color:#1e293b;border-bottom:2px solid #3b82f6;padding-bottom:8px;">ã‚¢ã‚½ãƒ¼ãƒˆå•†å“ã¨ã¯</h3>
      <ul style="margin:0;padding-left:20px;color:#475569;">
        <li>å‰¯æ¥­ç‰©è²©å‘ã‘ã®<strong>å¤ç€å¸å£²ã‚Šãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </strong>ã®ã¾ã¨ã‚è²·ã„å°‚ç”¨ãƒšãƒ¼ã‚¸ã§ã™</li>
        <li>ã‚«ãƒ†ã‚´ãƒªãƒ»ãƒ–ãƒ©ãƒ³ãƒ‰ã”ã¨ã«ã¾ã¨ã‚ãŸ<strong>å¤ç€ã‚»ãƒƒãƒˆ</strong>ã‚’æ•°é‡æŒ‡å®šã§ã”æ³¨æ–‡ã„ãŸã ã‘ã¾ã™</li>
        <li>å†™çœŸã¯ã‚µãƒ³ãƒ—ãƒ«ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚å®Ÿç‰©ã¨å¤šå°‘ç•°ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™</li>
        <li>1ç‚¹ãšã¤é¸ã³ãŸã„æ–¹ã¯<strong>ãƒ‡ã‚¿ã‚¦ãƒªï¼ˆæ¡å¯¸ä»˜ãå€‹å“ï¼‰</strong>ãƒšãƒ¼ã‚¸ã‚‚ã‚ã‚Šã¾ã™ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã®ã€Œãƒ‡ã‚¿ã‚¦ãƒªã€ã‹ã‚‰åˆ‡æ›¿ï¼‰</li>
      </ul>
    </div>
    <div style="margin-bottom:20px;">
      <h3 style="margin:0 0 12px;font-size:16px;color:#1e293b;border-bottom:2px solid #3b82f6;padding-bottom:8px;">ã”æ³¨æ–‡ã«ã¤ã„ã¦</h3>
      <ul style="margin:0;padding-left:20px;color:#475569;">
        <li style="margin-bottom:8px;">æ•°é‡ã‚’é¸ã‚“ã§ã‚«ãƒ¼ãƒˆã«è¿½åŠ ã—ã¦ãã ã•ã„</li>
        <li>é€æ–™ã¯ãŠå±Šã‘å…ˆã«å¿œã˜ã¦è‡ªå‹•è¨ˆç®—ã•ã‚Œã¾ã™ï¼ˆãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ä¼šå“¡ã¯é€æ–™ç„¡æ–™ï¼‰</li>
      </ul>
    </div>
    <div style="margin-bottom:20px;">
      <h3 style="margin:0 0 12px;font-size:16px;color:#1e293b;border-bottom:2px solid #3b82f6;padding-bottom:8px;">ã”æ³¨æ–‡ã®æµã‚Œ</h3>
      <ol style="margin:0;padding-left:20px;color:#475569;">
        <li style="margin-bottom:8px;"><strong>å•†å“é¸æŠ</strong>ï¼šæ•°é‡ã‚’æ±ºã‚ã¦ã‚«ãƒ¼ãƒˆã«è¿½åŠ </li>
        <li style="margin-bottom:8px;"><strong>ãŠå±Šã‘å…ˆå…¥åŠ›</strong>ï¼šä½æ‰€ã‚’å…¥åŠ›ã™ã‚‹ã¨é€æ–™ãŒè‡ªå‹•è¡¨ç¤ºã•ã‚Œã¾ã™</li>
        <li style="margin-bottom:8px;"><strong>ãŠæ”¯æ‰•ã„</strong>ï¼šå•†å“ä»£ï¼‹é€æ–™ã‚’ã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ±ºæ¸ˆ<br><span style="font-size:12px;color:#888;">â€»ã‚³ãƒ³ãƒ“ãƒ‹æ±ºæ¸ˆã¯åˆ¥é€”æ‰‹æ•°æ–™220å††ã€éŠ€è¡ŒæŒ¯è¾¼ãƒ»ãƒšã‚¤ã‚¸ãƒ¼ã®æŒ¯è¾¼æ‰‹æ•°æ–™ã¯ãŠå®¢æ§˜è² æ‹…</span></li>
        <li><strong>ç™ºé€</strong>ï¼šæ±ºæ¸ˆå®Œäº†å¾Œã€é€šå¸¸2ã€œ5å–¶æ¥­æ—¥ã§ç™ºé€ã„ãŸã—ã¾ã™</li>
      </ol>
    </div>
    <div style="margin-bottom:20px;">
      <h3 style="margin:0 0 12px;font-size:16px;color:#1e293b;border-bottom:2px solid #3b82f6;padding-bottom:8px;">å‰²å¼•ã«ã¤ã„ã¦</h3>
      <ul style="margin:0;padding-left:20px;color:#475569;">
        <li><strong>ä¼šå“¡å‰²å¼•</strong>ï¼šç„¡æ–™ä¼šå“¡ç™»éŒ²ã§<span style="color:#b8002a;font-weight:700;">10%OFF</span><span style="color:#666;font-size:13px;">ï¼ˆ2026å¹´9æœˆæœ«ã¾ã§ï¼‰</span></li>
      </ul>
    </div>
    <div style="margin-bottom:20px;">
      <h3 style="margin:0 0 12px;font-size:16px;color:#1e293b;border-bottom:2px solid #3b82f6;padding-bottom:8px;">ä¾¿åˆ©ãªæ©Ÿèƒ½</h3>
      <ul style="margin:0;padding-left:20px;color:#475569;">
        <li style="margin-bottom:8px;"><strong>ğŸ’¡ å‰¯æ¥­ç‰©è²©ãŠå½¹ç«‹ã¡æƒ…å ±</strong>ï¼šç”»é¢å·¦ä¸‹ã®ãƒœã‚¿ãƒ³ã‹ã‚‰ã€ç‰©è²©ãƒã‚¦ãƒã‚¦è¨˜äº‹ã‚’æ¯æ—¥é…ä¿¡ä¸­</li>
        <li style="margin-bottom:8px;"><strong>ğŸ¤– AIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ</strong>ï¼šã”ä¸æ˜ç‚¹ã¯ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã«è³ªå•ã§ãã¾ã™</li>
        <li><strong>ã‚¢ã‚½ãƒ¼ãƒˆé€æ–™è¡¨</strong>ï¼šãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰é€æ–™ã®è©³ç´°ã‚’ç¢ºèªã§ãã¾ã™</li>
      </ul>
    </div>
    <div>
      <h3 style="margin:0 0 12px;font-size:16px;color:#1e293b;border-bottom:2px solid #3b82f6;padding-bottom:8px;">æ³¨æ„äº‹é …</h3>
      <ul style="margin:0;padding-left:20px;color:#475569;">
        <li>ã”æ³¨æ–‡ç¢ºå®šå¾Œã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒ»å¤‰æ›´ã¯ã§ãã¾ã›ã‚“</li>
        <li>è¿”å“ãƒ»äº¤æ›ã¯åŸå‰‡ãŠå—ã‘ã—ã¦ãŠã‚Šã¾ã›ã‚“ã€‚ä¸‡ä¸€ã€å•†å“å†…å®¹ãŒè¨˜è¼‰äº‹é …ã¨å¤§ããç•°ãªã‚‹å ´åˆã¯ã€å•†å“åˆ°ç€å¾Œ7æ—¥ä»¥å†…ã«ã”é€£çµ¡ãã ã•ã„</li>
      </ul>
    </div>
  </div>
</div>

<!-- ã‚¢ã‚½ãƒ¼ãƒˆé€æ–™è¡¨ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="bulk-overlay" id="bulkShippingOverlay"></div>
<div class="bulk-modal" id="bulkShippingModal" style="display:none;width:min(800px,96vw);">
  <div class="bulk-modal-header">
    <div class="bulk-modal-title">ã‚¢ã‚½ãƒ¼ãƒˆé€æ–™è¡¨</div>
    <button class="bulk-modal-close" id="bulkShippingCloseBtn" type="button">&times;</button>
  </div>
  <div class="bulk-modal-body" style="line-height:1.7;">
    <!-- è¥¿æ—¥æœ¬ -->
    <div style="margin-bottom:20px;">
      <h3 style="margin:0 0 12px;font-size:16px;color:#1e293b;border-bottom:2px solid #f472b6;padding-bottom:8px;">è¥¿æ—¥æœ¬ï¼ˆå—ä¹å·ã€œåŒ—é™¸ï¼‰</h3>
      <div style="overflow-x:auto;">
        <table style="width:100%;border-collapse:collapse;font-size:12px;min-width:500px;">
          <tr style="background:#fce7f3;">
            <th style="padding:8px;text-align:center;border:1px solid #f9a8d4;width:80px;">å®…é…ä¾¿</th>
            <th style="padding:8px;text-align:center;border:1px solid #f9a8d4;">å—ä¹å·</th>
            <th style="padding:8px;text-align:center;border:1px solid #f9a8d4;">åŒ—ä¹å·</th>
            <th style="padding:8px;text-align:center;border:1px solid #f9a8d4;">å››å›½</th>
            <th style="padding:8px;text-align:center;border:1px solid #f9a8d4;">ä¸­å›½</th>
            <th style="padding:8px;text-align:center;border:1px solid #f9a8d4;">é–¢è¥¿</th>
            <th style="padding:8px;text-align:center;border:1px solid #f9a8d4;">åŒ—é™¸</th>
          </tr>
          <tr style="background:#fdf2f8;font-size:10px;color:#6b7280;">
            <td style="padding:6px;border:1px solid #f9a8d4;text-align:center;">éƒ½é“åºœçœŒ</td>
            <td style="padding:6px;border:1px solid #f9a8d4;text-align:center;">é¹¿å…å³¶ãƒ»ç†Šæœ¬ãƒ»å®®å´</td>
            <td style="padding:6px;border:1px solid #f9a8d4;text-align:center;">ç¦å²¡ãƒ»ä½è³€ãƒ»å¤§åˆ†ãƒ»é•·å´</td>
            <td style="padding:6px;border:1px solid #f9a8d4;text-align:center;">é¦™å·ãƒ»æ„›åª›ãƒ»é«˜çŸ¥ãƒ»å¾³å³¶</td>
            <td style="padding:6px;border:1px solid #f9a8d4;text-align:center;">åºƒå³¶ãƒ»å²¡å±±ãƒ»å³¶æ ¹ãƒ»å±±å£ãƒ»é³¥å–</td>
            <td style="padding:6px;border:1px solid #f9a8d4;text-align:center;">å¤§é˜ªãƒ»å…µåº«ãƒ»äº¬éƒ½ãƒ»å¥ˆè‰¯ãƒ»å’Œæ­Œå±±ãƒ»æ»‹è³€</td>
            <td style="padding:6px;border:1px solid #f9a8d4;text-align:center;">çŸ³å·ãƒ»ç¦äº•ãƒ»å¯Œå±±</td>
          </tr>
          <tr>
            <td style="padding:8px;border:1px solid #f9a8d4;text-align:center;font-weight:700;background:#fff0f6;">å®…é…ä¾¿ï¼ˆå¤§ï¼‰</td>
            <td style="padding:8px;border:1px solid #f9a8d4;text-align:center;">1,700å††</td>
            <td style="padding:8px;border:1px solid #f9a8d4;text-align:center;">1,620å††</td>
            <td style="padding:8px;border:1px solid #f9a8d4;text-align:center;">1,440å††</td>
            <td style="padding:8px;border:1px solid #f9a8d4;text-align:center;">1,480å††</td>
            <td style="padding:8px;border:1px solid #f9a8d4;text-align:center;">1,260å††</td>
            <td style="padding:8px;border:1px solid #f9a8d4;text-align:center;">1,420å††</td>
          </tr>
        </table>
      </div>
    </div>
    <!-- æ±æ—¥æœ¬ -->
    <div style="margin-bottom:20px;">
      <h3 style="margin:0 0 12px;font-size:16px;color:#1e293b;border-bottom:2px solid #67e8f9;padding-bottom:8px;">æ±æ—¥æœ¬ï¼ˆæ±æµ·ã€œåŒ—æµ·é“ï¼‰</h3>
      <div style="overflow-x:auto;">
        <table style="width:100%;border-collapse:collapse;font-size:12px;min-width:500px;">
          <tr style="background:#cffafe;">
            <th style="padding:8px;text-align:center;border:1px solid #a5f3fc;width:80px;">å®…é…ä¾¿</th>
            <th style="padding:8px;text-align:center;border:1px solid #a5f3fc;">æ±æµ·</th>
            <th style="padding:8px;text-align:center;border:1px solid #a5f3fc;">ä¿¡è¶Š</th>
            <th style="padding:8px;text-align:center;border:1px solid #a5f3fc;">é–¢æ±</th>
            <th style="padding:8px;text-align:center;border:1px solid #a5f3fc;">å—æ±åŒ—</th>
            <th style="padding:8px;text-align:center;border:1px solid #a5f3fc;">åŒ—æ±åŒ—</th>
            <th style="padding:8px;text-align:center;border:1px solid #a5f3fc;">åŒ—æµ·é“</th>
          </tr>
          <tr style="background:#ecfeff;font-size:10px;color:#6b7280;">
            <td style="padding:6px;border:1px solid #a5f3fc;text-align:center;">éƒ½é“åºœçœŒ</td>
            <td style="padding:6px;border:1px solid #a5f3fc;text-align:center;">æ„›çŸ¥ãƒ»é™å²¡ãƒ»å²é˜œãƒ»ä¸‰é‡</td>
            <td style="padding:6px;border:1px solid #a5f3fc;text-align:center;">æ–°æ½Ÿãƒ»é•·é‡</td>
            <td style="padding:6px;border:1px solid #a5f3fc;text-align:center;">æ±äº¬ãƒ»ç¥å¥ˆå·ãƒ»åŸ¼ç‰ãƒ»åƒè‘‰ãƒ»èŒ¨åŸãƒ»æ ƒæœ¨ãƒ»ç¾¤é¦¬ãƒ»å±±æ¢¨</td>
            <td style="padding:6px;border:1px solid #a5f3fc;text-align:center;">å®®åŸãƒ»ç¦å³¶ãƒ»å±±å½¢</td>
            <td style="padding:6px;border:1px solid #a5f3fc;text-align:center;">å²©æ‰‹ãƒ»ç§‹ç”°ãƒ»é’æ£®</td>
            <td style="padding:6px;border:1px solid #a5f3fc;text-align:center;">åŒ—æµ·é“</td>
          </tr>
          <tr>
            <td style="padding:8px;border:1px solid #a5f3fc;text-align:center;font-weight:700;background:#f0fdff;">å®…é…ä¾¿ï¼ˆå¤§ï¼‰</td>
            <td style="padding:8px;border:1px solid #a5f3fc;text-align:center;">1,440å††</td>
            <td style="padding:8px;border:1px solid #a5f3fc;text-align:center;">1,540å††</td>
            <td style="padding:8px;border:1px solid #a5f3fc;text-align:center;">1,680å††</td>
            <td style="padding:8px;border:1px solid #a5f3fc;text-align:center;">1,900å††</td>
            <td style="padding:8px;border:1px solid #a5f3fc;text-align:center;">1,980å††</td>
            <td style="padding:8px;border:1px solid #a5f3fc;text-align:center;">2,380å††</td>
          </tr>
        </table>
      </div>
    </div>
    <!-- æ²–ç¸„ -->
    <div style="margin-bottom:20px;">
      <h3 style="margin:0 0 12px;font-size:16px;color:#1e293b;border-bottom:2px solid #f59e0b;padding-bottom:8px;">æ²–ç¸„æœ¬å³¶</h3>
      <div style="overflow-x:auto;">
        <table style="width:100%;border-collapse:collapse;font-size:12px;max-width:300px;">
          <tr style="background:#fef3c7;">
            <th style="padding:8px;text-align:center;border:1px solid #fcd34d;width:80px;">å®…é…ä¾¿</th>
            <th style="padding:8px;text-align:center;border:1px solid #fcd34d;">æ²–ç¸„æœ¬å³¶</th>
          </tr>
          <tr>
            <td style="padding:8px;border:1px solid #fcd34d;text-align:center;font-weight:700;background:#fffbeb;">å®…é…ä¾¿ï¼ˆå¤§ï¼‰</td>
            <td style="padding:8px;border:1px solid #fcd34d;text-align:center;">3,500å††</td>
          </tr>
        </table>
      </div>
      <p style="margin:8px 0 0;color:#b45309;font-size:12px;">â€» æ²–ç¸„çœŒã®é›¢å³¶ï¼ˆå®®å¤å³¶ãƒ»çŸ³å£å³¶ç­‰ï¼‰ã¯é…é€å¯¾è±¡å¤–ã§ã™ã€‚</p>
    </div>
    <!-- ã‚µã‚¤ã‚ºç›®å®‰ -->
    <div style="margin-bottom:20px;">
      <h3 style="margin:0 0 12px;font-size:16px;color:#1e293b;border-bottom:2px solid #10b981;padding-bottom:8px;">ã‚µã‚¤ã‚ºã®ç›®å®‰</h3>
      <ul style="margin:0;padding-left:20px;color:#475569;font-size:13px;">
        <li><strong>å®…é…ä¾¿ï¼ˆå¤§ï¼‰</strong>ï¼š10kgç¨‹åº¦</li>
      </ul>
    </div>
    <!-- é…é€ã«ã¤ã„ã¦ -->
    <div style="margin-bottom:20px;">
      <h3 style="margin:0 0 12px;font-size:16px;color:#1e293b;border-bottom:2px solid #10b981;padding-bottom:8px;">é…é€ã«ã¤ã„ã¦</h3>
      <ul style="margin:0;padding-left:20px;color:#475569;">
        <li>ä¸Šè¨˜é€æ–™ã¯å…¨ã¦<strong>ç¨è¾¼ã¿</strong>ã§ã™</li>
        <li>ä¼šå“¡å‰²å¼•ã¯å•†å“ä»£ã®ã¿ã«é©ç”¨ã•ã‚Œã¾ã™ï¼ˆ<strong>é€æ–™ã¯å‰²å¼•å¯¾è±¡å¤–</strong>ï¼‰</li>
        <li>ç™ºé€ã¯ãŠæ”¯æ‰•ã„ç¢ºèªå¾Œ<strong>2ã€œ5å–¶æ¥­æ—¥</strong>ä»¥å†…</li>
        <li>é…é€æ¥­è€…ï¼šä½å·æ€¥ä¾¿ãƒ»ãƒ¤ãƒãƒˆé‹è¼¸ãƒ»éƒµä¾¿å±€ã®ã„ãšã‚Œã‹ï¼ˆæŒ‡å®šä¸å¯ï¼‰</li>
        <li>æ—¥æ™‚æŒ‡å®šä¸å¯</li>
        <li style="color:#b8002a;"><strong>é›¢å³¶ã¸ã®é…é€ã¯å¯¾è±¡å¤–ã§ã™</strong></li>
      </ul>
    </div>
    <!-- æ±ºæ¸ˆæ‰‹æ•°æ–™ -->
    <div>
      <h3 style="margin:0 0 12px;font-size:16px;color:#1e293b;border-bottom:2px solid #f59e0b;padding-bottom:8px;">ãŠå®¢æ§˜ã”è² æ‹…ã®æ±ºæ¸ˆæ‰‹æ•°æ–™</h3>
      <ul style="margin:0;padding-left:20px;color:#475569;">
        <li><strong>ã‚³ãƒ³ãƒ“ãƒ‹æ±ºæ¸ˆ</strong>ï¼š220å††ï¼ˆç¨è¾¼ï¼‰ã®æ±ºæ¸ˆæ‰‹æ•°æ–™ãŒã‹ã‹ã‚Šã¾ã™</li>
        <li><strong>éŠ€è¡ŒæŒ¯è¾¼</strong>ï¼šæŒ¯è¾¼æ‰‹æ•°æ–™ã¯ãŠå®¢æ§˜ã®ã”è² æ‹…ã¨ãªã‚Šã¾ã™ï¼ˆé‡‘é¡ã¯é‡‘èæ©Ÿé–¢ã«ã‚ˆã‚Šç•°ãªã‚Šã¾ã™ï¼‰</li>
        <li><strong>ãƒšã‚¤ã‚¸ãƒ¼</strong>ï¼šæŒ¯è¾¼æ‰‹æ•°æ–™ã¯ãŠå®¢æ§˜ã®ã”è² æ‹…ã¨ãªã‚Šã¾ã™ï¼ˆé‡‘é¡ã¯é‡‘èæ©Ÿé–¢ã«ã‚ˆã‚Šç•°ãªã‚Šã¾ã™ï¼‰</li>
        <li style="color:#888;">ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ãƒ»PayPayãƒ»Apple Payï¼šæ‰‹æ•°æ–™ã¯ã‹ã‹ã‚Šã¾ã›ã‚“</li>
      </ul>
    </div>
  </div>
</div>

<!-- ç‰¹å®šå•†å–å¼•æ³•ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="bulk-overlay" id="legalOverlay"></div>
<div class="bulk-modal" id="legalModal" style="display:none;">
  <div class="bulk-modal-header">
    <div class="bulk-modal-title">ç‰¹å®šå•†å–å¼•æ³•ã«åŸºã¥ãè¡¨è¨˜</div>
    <button class="bulk-modal-close" id="legalCloseBtn" type="button">&times;</button>
  </div>
  <div class="bulk-modal-body" style="line-height:1.7;">
    <table style="width:100%;border-collapse:collapse;font-size:14px;">
      <tr><th style="padding:12px;text-align:left;border:1px solid #e2e8f0;background:#f8fafc;width:140px;vertical-align:top;">è²©å£²æ¥­è€…</th><td style="padding:12px;border:1px solid #e2e8f0;">è¥¿å‡ºå…‹åˆ©</td></tr>
      <tr><th style="padding:12px;text-align:left;border:1px solid #e2e8f0;background:#f8fafc;vertical-align:top;">é‹å–¶çµ±æ‹¬è²¬ä»»è€…</th><td style="padding:12px;border:1px solid #e2e8f0;">è¥¿å‡ºå…‹åˆ©</td></tr>
      <tr><th style="padding:12px;text-align:left;border:1px solid #e2e8f0;background:#f8fafc;vertical-align:top;">æ‰€åœ¨åœ°</th><td style="padding:12px;border:1px solid #e2e8f0;">å¤§é˜ªåºœå¤§æ±å¸‚ç°å¡š4-16-15</td></tr>
      <tr><th style="padding:12px;text-align:left;border:1px solid #e2e8f0;background:#f8fafc;vertical-align:top;">é›»è©±ç•ªå·</th><td style="padding:12px;border:1px solid #e2e8f0;">090-5820-1803</td></tr>
      <tr><th style="padding:12px;text-align:left;border:1px solid #e2e8f0;background:#f8fafc;vertical-align:top;">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</th><td style="padding:12px;border:1px solid #e2e8f0;">nkonline1030@gmail.com</td></tr>
      <tr><th style="padding:12px;text-align:left;border:1px solid #e2e8f0;background:#f8fafc;vertical-align:top;">å–¶æ¥­æ™‚é–“</th><td style="padding:12px;border:1px solid #e2e8f0;">å¹³æ—¥ 10:00ã€œ18:00<br><span style="font-size:12px;color:#888;">â€»åœŸæ—¥ç¥ã¯ç™ºé€ãƒ»äº‹å‹™å‡¦ç†ä¼‘ã¿ï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿”ä¿¡ã¯å¯¾å¿œå¯ï¼‰</span></td></tr>
      <tr><th style="padding:12px;text-align:left;border:1px solid #e2e8f0;background:#f8fafc;vertical-align:top;">è²©å£²ä¾¡æ ¼</th><td style="padding:12px;border:1px solid #e2e8f0;">å„å•†å“ãƒšãƒ¼ã‚¸ã«è¡¨ç¤ºã•ã‚ŒãŸä¾¡æ ¼ï¼ˆç¨è¾¼ï¼‰</td></tr>
      <tr><th style="padding:12px;text-align:left;border:1px solid #e2e8f0;background:#f8fafc;vertical-align:top;">é€æ–™</th><td style="padding:12px;border:1px solid #e2e8f0;">åœ°åŸŸãƒ»ã‚µã‚¤ã‚ºã«ã‚ˆã‚Šç•°ãªã‚Šã¾ã™ã€‚</td></tr>
      <tr><th style="padding:12px;text-align:left;border:1px solid #e2e8f0;background:#f8fafc;vertical-align:top;">æ”¯æ‰•æ–¹æ³•</th><td style="padding:12px;border:1px solid #e2e8f0;">ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ï¼ˆVisa/Mastercard/JCB/AMEX/Diners/Discoverï¼‰ã€ã‚³ãƒ³ãƒ“ãƒ‹æ±ºæ¸ˆã€éŠ€è¡ŒæŒ¯è¾¼ã€PayPayã€ãƒšã‚¤ã‚¸ãƒ¼ã€Apple Pay</td></tr>
      <tr><th style="padding:12px;text-align:left;border:1px solid #e2e8f0;background:#f8fafc;vertical-align:top;">æ”¯æ‰•æ™‚æœŸ</th><td style="padding:12px;border:1px solid #e2e8f0;">ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ãƒ»PayPayãƒ»Apple Payï¼šã”æ³¨æ–‡æ™‚ã«æ±ºæ¸ˆ<br>ã‚³ãƒ³ãƒ“ãƒ‹æ±ºæ¸ˆï¼šã”æ³¨æ–‡å¾Œ3æ—¥ä»¥å†…ã«ãŠæ”¯æ‰•ã„<br>éŠ€è¡ŒæŒ¯è¾¼ãƒ»ãƒšã‚¤ã‚¸ãƒ¼ï¼šã”æ³¨æ–‡å¾Œ3æ—¥ä»¥å†…ã«ãŠæŒ¯è¾¼ã¿</td></tr>
      <tr><th style="padding:12px;text-align:left;border:1px solid #e2e8f0;background:#f8fafc;vertical-align:top;">ãŠå®¢æ§˜è² æ‹…ã®æ‰‹æ•°æ–™</th><td style="padding:12px;border:1px solid #e2e8f0;">ã‚³ãƒ³ãƒ“ãƒ‹æ±ºæ¸ˆï¼š<strong>220å††ï¼ˆç¨è¾¼ï¼‰</strong><br>éŠ€è¡ŒæŒ¯è¾¼ãƒ»ãƒšã‚¤ã‚¸ãƒ¼ï¼š<strong>æŒ¯è¾¼æ‰‹æ•°æ–™</strong>ã¯ãŠå®¢æ§˜è² æ‹…<br><span style="font-size:12px;color:#888;">â€»ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ãƒ»PayPayãƒ»Apple Payï¼šæ‰‹æ•°æ–™ãªã—</span></td></tr>
      <tr><th style="padding:12px;text-align:left;border:1px solid #e2e8f0;background:#f8fafc;vertical-align:top;">å•†å“å¼•æ¸¡ã—æ™‚æœŸ</th><td style="padding:12px;border:1px solid #e2e8f0;">ã”å…¥é‡‘ç¢ºèªå¾Œã€2ã€œ5å–¶æ¥­æ—¥ä»¥å†…ã«ç™ºé€</td></tr>
      <tr><th style="padding:12px;text-align:left;border:1px solid #e2e8f0;background:#f8fafc;vertical-align:top;">æ³¨æ–‡ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«</th><td style="padding:12px;border:1px solid #e2e8f0;">ç™ºé€æº–å‚™å‰ã®ã”æ³¨æ–‡ã«é™ã‚Šã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚’æ‰¿ã‚Šã¾ã™ã€‚<br>ç™ºé€æº–å‚™é–‹å§‹å¾Œã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã¯ãŠå—ã‘ã§ãã¾ã›ã‚“ã®ã§ã€ã‚ã‚‰ã‹ã˜ã‚ã”äº†æ‰¿ãã ã•ã„ã€‚<br><span style="font-size:12px;color:#888;">â€»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã”å¸Œæœ›ã®å ´åˆã¯ã€ãŠæ—©ã‚ã«ãƒ¡ãƒ¼ãƒ«ã¾ãŸã¯ãŠé›»è©±ã«ã¦ã”é€£çµ¡ãã ã•ã„ã€‚</span></td></tr>
      <tr><th style="padding:12px;text-align:left;border:1px solid #e2e8f0;background:#f8fafc;vertical-align:top;">è¿”å“ãƒ»äº¤æ›</th><td style="padding:12px;border:1px solid #e2e8f0;"><strong>ã€ãŠå®¢æ§˜éƒ½åˆã®å ´åˆã€‘</strong><br>ä¸­å¤è¡£é¡ã¨ã„ã†å•†å“ã®æ€§è³ªä¸Šã€ãŠå®¢æ§˜éƒ½åˆã«ã‚ˆã‚‹è¿”å“ãƒ»äº¤æ›ã¯åŸå‰‡ã¨ã—ã¦ãŠå—ã‘ã—ã¦ãŠã‚Šã¾ã›ã‚“ã€‚<br><br><strong>ã€å½“æ–¹ã«èµ·å› ã™ã‚‹å ´åˆã€‘</strong><br>å•†å“å†…å®¹ãŒè¨˜è¼‰äº‹é …ã¨å¤§ããç•°ãªã‚‹å ´åˆã€ã¾ãŸã¯é…é€ä¸­ã®ç ´æãƒ»æ±šæãŒã‚ã£ãŸå ´åˆã¯ã€å•†å“åˆ°ç€å¾Œ7æ—¥ä»¥å†…ã«ãƒ¡ãƒ¼ãƒ«ã¾ãŸã¯ãŠé›»è©±ã«ã¦ã”é€£çµ¡ãã ã•ã„ã€‚çŠ¶æ³ã‚’ç¢ºèªã®ã†ãˆã€è¿”å“ãƒ»äº¤æ›ã¾ãŸã¯è¿”é‡‘ã«ã¦å¯¾å¿œã„ãŸã—ã¾ã™ã€‚<br><span style="font-size:12px;color:#888;">â€»7æ—¥ã‚’éããŸå ´åˆã¯å¯¾å¿œã„ãŸã—ã‹ã­ã¾ã™ã®ã§ã”äº†æ‰¿ãã ã•ã„ã€‚</span></td></tr>
      <tr><th style="padding:12px;text-align:left;border:1px solid #e2e8f0;background:#f8fafc;vertical-align:top;">è¿”é‡‘ã«ã¤ã„ã¦</th><td style="padding:12px;border:1px solid #e2e8f0;">å½“æ–¹ã®éƒ½åˆã«ã‚ˆã‚‹è¿”é‡‘ã®å ´åˆã€ã”åˆ©ç”¨ã®æ±ºæ¸ˆæ–¹æ³•ã«å¿œã˜ã¦è¿”é‡‘å‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚<br>ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ãƒ»Apple Payï¼šã‚«ãƒ¼ãƒ‰ä¼šç¤¾çµŒç”±ã§ã®è¿”é‡‘<br>ã‚³ãƒ³ãƒ“ãƒ‹æ±ºæ¸ˆãƒ»éŠ€è¡ŒæŒ¯è¾¼ãƒ»ãƒšã‚¤ã‚¸ãƒ¼ï¼šã”æŒ‡å®šã®éŠ€è¡Œå£åº§ã¸è¿”é‡‘<br>PayPayï¼šPayPayæ®‹é«˜ã¸ã®è¿”é‡‘<br><span style="font-size:12px;color:#888;">â€»è¿”é‡‘å‡¦ç†ã«ã¯æ±ºæ¸ˆæ–¹æ³•ã«ã‚ˆã‚Š1ã€œ4é€±é–“ç¨‹åº¦ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</span></td></tr>
      <tr><th style="padding:12px;text-align:left;border:1px solid #e2e8f0;background:#f8fafc;vertical-align:top;">å¤ç‰©å•†è¨±å¯</th><td style="padding:12px;border:1px solid #e2e8f0;">å¤§é˜ªåºœå…¬å®‰å§”å“¡ä¼š ç¬¬62228R076481å·</td></tr>
      <tr><th style="padding:12px;text-align:left;border:1px solid #e2e8f0;background:#f8fafc;vertical-align:top;">ã‚¤ãƒ³ãƒœã‚¤ã‚¹ç™»éŒ²ç•ªå·</th><td style="padding:12px;border:1px solid #e2e8f0;">T9810785107076</td></tr>
    </table>
  </div>
</div>

<!-- ãŠå•ã„åˆã‚ã›ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="bulk-overlay" id="contactOverlay"></div>
<div class="bulk-modal" id="contactModal" style="display:none;width:min(500px,94vw);">
  <div class="bulk-modal-header">
    <div class="bulk-modal-title">ãŠå•ã„åˆã‚ã›</div>
    <button class="bulk-modal-close" id="contactCloseBtn" type="button">&times;</button>
  </div>
  <div class="bulk-modal-body">
    <div style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:10px 14px;margin-bottom:14px;font-size:13px;color:#475569;line-height:1.6;">
      <strong>å–¶æ¥­æ™‚é–“</strong>ï¼šå¹³æ—¥ 10:00ã€œ18:00ï¼ˆåœŸæ—¥ç¥ã¯ç™ºé€ãƒ»äº‹å‹™å‡¦ç†ä¼‘ã¿ï¼‰<br>
      ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¸ã®è¿”ä¿¡ã¯åœŸæ—¥ç¥ã‚‚å¯¾å¿œã—ã¦ãŠã‚Šã¾ã™ã€‚2å–¶æ¥­æ—¥ä»¥å†…ã«ã”è¿”ä¿¡ã„ãŸã—ã¾ã™ã€‚
    </div>
    <div style="margin-bottom:12px;"><label style="display:block;font-size:12px;font-weight:600;color:#555;margin-bottom:4px;">ãŠåå‰ *</label><input type="text" id="contactName" placeholder="ä¼šç¤¾å/æ°å" style="width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:8px;font-size:14px;"></div>
    <div style="margin-bottom:12px;"><label style="display:block;font-size:12px;font-weight:600;color:#555;margin-bottom:4px;">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ *</label><input type="email" id="contactEmail" placeholder="è¿”ä¿¡å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" style="width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:8px;font-size:14px;"></div>
    <div style="margin-bottom:12px;"><label style="display:block;font-size:12px;font-weight:600;color:#555;margin-bottom:4px;">ãŠå•ã„åˆã‚ã›å†…å®¹ *</label><textarea id="contactMessage" rows="6" placeholder="ãŠå•ã„åˆã‚ã›å†…å®¹ã‚’ã”è¨˜å…¥ãã ã•ã„" style="width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:8px;font-size:14px;resize:vertical;"></textarea></div>
    <div style="text-align:right;"><button id="contactSubmitBtn" type="button" style="padding:10px 24px;border:none;border-radius:10px;background:#1a1a2e;color:#fff;font-size:14px;font-weight:700;cursor:pointer;">é€ä¿¡</button></div>
  </div>
</div>

<!-- ãƒã‚¤ãƒšãƒ¼ã‚¸ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="bulk-overlay" id="myPageOverlay"></div>
<div class="bulk-modal" id="myPageModal" style="display:none;width:min(600px,96vw);">
  <div class="bulk-modal-header">
    <div class="bulk-modal-title">ãƒã‚¤ãƒšãƒ¼ã‚¸</div>
    <button class="bulk-modal-close" id="myPageCloseBtn" type="button">&times;</button>
  </div>
  <div class="bulk-modal-body">
    <div class="mypage-tabs">
      <button class="mypage-tab active" data-tab="profile" type="button">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</button>
      <button class="mypage-tab" data-tab="orders" type="button">æ³¨æ–‡å±¥æ­´</button>
      <button class="mypage-tab" data-tab="points" type="button">ãƒã‚¤ãƒ³ãƒˆ</button>
    </div>
    <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚¿ãƒ– -->
    <div class="mypage-content" id="mypageProfile">
      <div style="display:grid;grid-template-columns:1fr;gap:10px;">
        <div><label style="display:block;font-size:12px;font-weight:600;color:#555;margin-bottom:4px;">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label><input id="mpEmail" type="email" readonly style="width:100%;padding:8px 10px;border:1px solid #ddd;border-radius:6px;font-size:14px;background:#f5f5f5;"></div>
        <div><label style="display:block;font-size:12px;font-weight:600;color:#555;margin-bottom:4px;">ä¼šç¤¾å/æ°å *</label><input id="mpCompanyName" type="text" readonly style="width:100%;padding:8px 10px;border:1px solid #ddd;border-radius:6px;font-size:14px;background:#f5f5f5;"></div>
        <div><label style="display:block;font-size:12px;font-weight:600;color:#555;margin-bottom:4px;">é›»è©±ç•ªå·</label><input id="mpPhone" type="tel" inputmode="numeric" readonly style="width:100%;padding:8px 10px;border:1px solid #ddd;border-radius:6px;font-size:14px;background:#f5f5f5;"></div>
        <div><label style="display:block;font-size:12px;font-weight:600;color:#555;margin-bottom:4px;">éƒµä¾¿ç•ªå·</label><input id="mpPostal" type="text" inputmode="numeric" readonly style="width:100%;padding:8px 10px;border:1px solid #ddd;border-radius:6px;font-size:14px;background:#f5f5f5;"></div>
        <div><label style="display:block;font-size:12px;font-weight:600;color:#555;margin-bottom:4px;">ä½æ‰€</label><input id="mpAddress" type="text" readonly style="width:100%;padding:8px 10px;border:1px solid #ddd;border-radius:6px;font-size:14px;background:#f5f5f5;"></div>
        <div><label style="font-size:12px;color:#999;">ç™»éŒ²æ—¥: <span id="mpRegisteredAt">-</span></label></div>
      </div>
      <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;">
        <button id="mpEditBtn" type="button" style="padding:8px 16px;border:1px solid #ddd;border-radius:8px;background:#fff;cursor:pointer;font-size:13px;font-weight:600;">ç·¨é›†</button>
        <button id="mpSaveBtn" type="button" style="display:none;padding:8px 16px;border:none;border-radius:8px;background:#1a1a2e;color:#fff;cursor:pointer;font-size:13px;font-weight:600;">å¤‰æ›´ã‚’ä¿å­˜</button>
        <button id="mpCancelEditBtn" type="button" style="display:none;padding:8px 16px;border:1px solid #ddd;border-radius:8px;background:#fff;cursor:pointer;font-size:13px;font-weight:600;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button id="mpTogglePasswordBtn" type="button" style="padding:8px 16px;border:1px solid #ddd;border-radius:8px;background:#fff;cursor:pointer;font-size:13px;font-weight:600;">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´</button>
      </div>
      <div id="mpPasswordSection" style="display:none;margin-top:14px;padding:14px;background:#f9f9f9;border-radius:8px;">
        <div style="display:grid;grid-template-columns:1fr;gap:10px;">
          <div><label style="display:block;font-size:12px;font-weight:600;color:#555;margin-bottom:4px;">ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ *</label><input id="mpCurPass" type="password" style="width:100%;padding:8px 10px;border:1px solid #ddd;border-radius:6px;font-size:14px;"></div>
          <div><label style="display:block;font-size:12px;font-weight:600;color:#555;margin-bottom:4px;">æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆ6æ–‡å­—ä»¥ä¸Šï¼‰ *</label><input id="mpNewPass" type="password" style="width:100%;padding:8px 10px;border:1px solid #ddd;border-radius:6px;font-size:14px;"></div>
          <div><label style="display:block;font-size:12px;font-weight:600;color:#555;margin-bottom:4px;">æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆç¢ºèªï¼‰ *</label><input id="mpNewPassConfirm" type="password" style="width:100%;padding:8px 10px;border:1px solid #ddd;border-radius:6px;font-size:14px;"></div>
        </div>
        <button id="mpChangePassBtn" type="button" style="margin-top:10px;padding:8px 16px;border:none;border-radius:8px;background:#1a1a2e;color:#fff;cursor:pointer;font-size:13px;font-weight:600;">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´</button>
      </div>
    </div>
    <!-- æ³¨æ–‡å±¥æ­´ã‚¿ãƒ– -->
    <div class="mypage-content" id="mypageOrders" style="display:none;">
      <div id="mpOrderList" style="font-size:13px;color:#666;">èª­ã¿è¾¼ã¿ä¸­...</div>
    </div>
    <!-- ãƒã‚¤ãƒ³ãƒˆãƒ»çµ±è¨ˆã‚¿ãƒ– -->
    <div class="mypage-content" id="mypagePoints" style="display:none;">
      <div id="mpRankCard" style="background:linear-gradient(135deg,#1e293b,#334155);border-radius:12px;padding:20px;color:#fff;margin-bottom:16px;position:relative;overflow:hidden;">
        <div style="font-size:11px;opacity:0.7;">ç¾åœ¨ã®ãƒ©ãƒ³ã‚¯</div>
        <div id="mpRankName" style="font-size:28px;font-weight:900;margin:4px 0;">-</div>
        <div id="mpRankPointRate" style="font-size:13px;opacity:0.9;">ãƒã‚¤ãƒ³ãƒˆé‚„å…ƒç‡: -</div>
        <div id="mpRankBenefits" style="font-size:12px;opacity:0.8;margin-top:4px;"></div>
        <div id="mpRankProgress" style="margin-top:12px;"></div>
      </div>
      <div style="text-align:center;padding:16px 0;">
        <div style="font-size:13px;color:#888;">ãƒã‚¤ãƒ³ãƒˆæ®‹é«˜</div>
        <div id="mpPointBalance" style="font-size:40px;font-weight:bold;color:#b8002a;margin:8px 0;">0</div>
        <div style="font-size:12px;color:#aaa;">1ãƒã‚¤ãƒ³ãƒˆ = 1å††ã¨ã—ã¦ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™</div>
      </div>
      <div style="border-top:1px solid #eee;padding-top:16px;margin-top:8px;">
        <div style="font-size:14px;font-weight:600;color:#333;margin-bottom:12px;">ã”åˆ©ç”¨çŠ¶æ³</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
          <div style="background:#f8fafc;border-radius:8px;padding:14px;text-align:center;">
            <div style="font-size:11px;color:#888;">ç´¯è¨ˆæ³¨æ–‡å›æ•°</div>
            <div id="mpTotalOrders" style="font-size:22px;font-weight:bold;color:#1e293b;margin-top:4px;">-</div>
          </div>
          <div style="background:#f8fafc;border-radius:8px;padding:14px;text-align:center;">
            <div style="font-size:11px;color:#888;">å¹´é–“è³¼å…¥é‡‘é¡</div>
            <div id="mpTotalSpent" style="font-size:22px;font-weight:bold;color:#1e293b;margin-top:4px;">-</div>
          </div>
          <div style="background:#f8fafc;border-radius:8px;padding:14px;text-align:center;">
            <div style="font-size:11px;color:#888;">ç´¯è¨ˆè³¼å…¥ç‚¹æ•°</div>
            <div id="mpTotalItems" style="font-size:22px;font-weight:bold;color:#1e293b;margin-top:4px;">-</div>
          </div>
          <div style="background:#f8fafc;border-radius:8px;padding:14px;text-align:center;">
            <div style="font-size:11px;color:#888;">ä¼šå“¡ãƒ©ãƒ³ã‚¯</div>
            <div id="mpMemberRank" style="font-size:22px;font-weight:bold;color:#1e293b;margin-top:4px;">-</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="bulk-overlay" id="privacyOverlay"></div>
<div class="bulk-modal" id="privacyModal" style="display:none;">
  <div class="bulk-modal-header">
    <div class="bulk-modal-title">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</div>
    <button class="bulk-modal-close" id="privacyCloseBtn" type="button">&times;</button>
  </div>
  <div class="bulk-modal-body" style="line-height:1.8;font-size:14px;">
    <h3 style="font-size:16px;font-weight:700;margin:0 0 12px;">å€‹äººæƒ…å ±ã®å–ã‚Šæ‰±ã„ã«ã¤ã„ã¦</h3>
    <p>ãƒ‡ã‚¿ã‚¦ãƒª.Detauriï¼ˆä»¥ä¸‹ã€Œå½“ã‚µãƒ¼ãƒ“ã‚¹ã€ï¼‰ã¯ã€ãŠå®¢æ§˜ã®å€‹äººæƒ…å ±ã®ä¿è­·ã«ç´°å¿ƒã®æ³¨æ„ã‚’æ‰•ã„ã€ä»¥ä¸‹ã®æ–¹é‡ã«åŸºã¥ãé©åˆ‡ã«å–ã‚Šæ‰±ã„ã¾ã™ã€‚</p>

    <h4 style="font-size:14px;font-weight:700;margin:20px 0 8px;">1. åé›†ã™ã‚‹æƒ…å ±</h4>
    <p>å½“ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯ã€ã”æ³¨æ–‡ãƒ»ä¼šå“¡ç™»éŒ²ãƒ»ãŠå•ã„åˆã‚ã›ã®éš›ã«ä»¥ä¸‹ã®æƒ…å ±ã‚’åé›†ã—ã¾ã™ã€‚</p>
    <ul style="margin:8px 0;padding-left:24px;">
      <li>æ°åãƒ»ä¼šç¤¾å</li>
      <li>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</li>
      <li>é›»è©±ç•ªå·</li>
      <li>éƒµä¾¿ç•ªå·ãƒ»ä½æ‰€</li>
      <li>ã”æ³¨æ–‡å†…å®¹ãƒ»æ±ºæ¸ˆæƒ…å ±ï¼ˆæ±ºæ¸ˆå‡¦ç†ã¯KOMOJUç¤¾ãŒè¡Œã„ã¾ã™ï¼‰</li>
    </ul>

    <h4 style="font-size:14px;font-weight:700;margin:20px 0 8px;">2. åˆ©ç”¨ç›®çš„</h4>
    <ul style="margin:8px 0;padding-left:24px;">
      <li>ã”æ³¨æ–‡ã®å‡¦ç†ãƒ»å•†å“ã®ç™ºé€</li>
      <li>ãŠå•ã„åˆã‚ã›ã¸ã®å›ç­”</li>
      <li>ã‚µãƒ¼ãƒ“ã‚¹æ”¹å–„ãƒ»æ–°å•†å“ã®ã”æ¡ˆå†…ï¼ˆãƒ¡ãƒ«ãƒã‚¬ç™»éŒ²è€…ã®ã¿ï¼‰</li>
      <li>ä¸æ­£åˆ©ç”¨ã®é˜²æ­¢</li>
    </ul>

    <h4 style="font-size:14px;font-weight:700;margin:20px 0 8px;">3. ç¬¬ä¸‰è€…ã¸ã®æä¾›</h4>
    <p>ãŠå®¢æ§˜ã®å€‹äººæƒ…å ±ã¯ã€ä»¥ä¸‹ã®å ´åˆã‚’é™¤ãç¬¬ä¸‰è€…ã«æä¾›ã„ãŸã—ã¾ã›ã‚“ã€‚</p>
    <ul style="margin:8px 0;padding-left:24px;">
      <li>å•†å“é…é€ã®ãŸã‚ã«é…é€æ¥­è€…ã«å¿…è¦ãªæƒ…å ±ã‚’æä¾›ã™ã‚‹å ´åˆ</li>
      <li>æ±ºæ¸ˆå‡¦ç†ã®ãŸã‚ã«KOMOJUç¤¾ã«å¿…è¦ãªæƒ…å ±ã‚’æä¾›ã™ã‚‹å ´åˆ</li>
      <li>æ³•ä»¤ã«åŸºã¥ãå ´åˆ</li>
    </ul>

    <h4 style="font-size:14px;font-weight:700;margin:20px 0 8px;">4. å€‹äººæƒ…å ±ã®ç®¡ç†</h4>
    <p>ãŠå®¢æ§˜ã®å€‹äººæƒ…å ±ã¯ã€ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ãƒ»ç´›å¤±ãƒ»ç ´å£Šãƒ»æ”¹ã–ã‚“ãƒ»æ¼æ´©ç­‰ã‚’é˜²æ­¢ã™ã‚‹ãŸã‚ã€é©åˆ‡ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã‚’è¬›ã˜ã¦ç®¡ç†ã„ãŸã—ã¾ã™ã€‚</p>
    <p style="margin-top:8px;">ã”æ³¨æ–‡ã®å‡¦ç†ãƒ»å•†å“ã®ç™ºé€ãƒ»ãŠå•ã„åˆã‚ã›ã¸ã®å¯¾å¿œç­‰ã€æ¥­å‹™ä¸Šå¿…è¦ãªç¯„å›²ã«ãŠã„ã¦ã€å½“ã‚µãƒ¼ãƒ“ã‚¹ã®æ‹…å½“ã‚¹ã‚¿ãƒƒãƒ•ãŒãŠå®¢æ§˜ã®å€‹äººæƒ…å ±ï¼ˆæ°åãƒ»ä½æ‰€ãƒ»é›»è©±ç•ªå·ç­‰ï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ã‚¢ã‚¯ã‚»ã‚¹ã¯æ¥­å‹™ã«å¿…è¦ãªæœ€å°é™ã®ç¯„å›²ã«é™å®šã—ã€æƒ…å ±ã®å–ã‚Šæ‰±ã„ã«é–¢ã™ã‚‹ç®¡ç†ã‚’å®Ÿæ–½ã—ã¦ãŠã‚Šã¾ã™ã€‚</p>
    <p style="margin-top:8px;">ãªãŠã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯æš—å·åŒ–ã—ã¦ä¿å­˜ã—ã¦ãŠã‚Šã€ã‚¹ã‚¿ãƒƒãƒ•ã‚’å«ã‚€ä½•äººã‚‚é–²è¦§ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚</p>

    <h4 style="font-size:14px;font-weight:700;margin:20px 0 8px;">5. å€‹äººæƒ…å ±ã®ä¿æŒæœŸé–“</h4>
    <p>ãŠå®¢æ§˜ã®å€‹äººæƒ…å ±ã¯ã€åˆ©ç”¨ç›®çš„ã®é”æˆã«å¿…è¦ãªæœŸé–“ä¿æŒã„ãŸã—ã¾ã™ã€‚ä¼šå“¡ç™»éŒ²æƒ…å ±ã¯é€€ä¼šã®ãŠç”³ã—å‡ºãŒã‚ã‚‹ã¾ã§ã€æ³¨æ–‡ã«é–¢ã™ã‚‹æƒ…å ±ã¯æ³•ä»¤ï¼ˆç¨æ³•ç­‰ï¼‰ã§å®šã‚ã‚‰ã‚ŒãŸä¿å­˜æœŸé–“ãŒçµŒéã™ã‚‹ã¾ã§ä¿æŒã„ãŸã—ã¾ã™ã€‚ä¿æŒæœŸé–“çµŒéå¾Œã¯ã€é€Ÿã‚„ã‹ã«å‰Šé™¤ã¾ãŸã¯åŒ¿ååŒ–ã„ãŸã—ã¾ã™ã€‚</p>

    <h4 style="font-size:14px;font-weight:700;margin:20px 0 8px;">6. CookieãŠã‚ˆã³ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸</h4>
    <p>å½“ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯ã€ã‚«ãƒ¼ãƒˆæƒ…å ±ã®ä¿æŒãƒ»ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã®ç¶­æŒãƒ»ã‚µãƒ¼ãƒ“ã‚¹æ”¹å–„ã®ãŸã‚ã«CookieãŠã‚ˆã³ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã«ã‚ˆã‚Šç„¡åŠ¹åŒ–ã§ãã¾ã™ãŒã€ä¸€éƒ¨ã®æ©Ÿèƒ½ãŒåˆ¶é™ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p>

    <h4 style="font-size:14px;font-weight:700;margin:20px 0 8px;">7. ãŠå®¢æ§˜ã®æ¨©åˆ©</h4>
    <p>ãŠå®¢æ§˜ã¯ã€å€‹äººæƒ…å ±ã®ä¿è­·ã«é–¢ã™ã‚‹æ³•å¾‹ï¼ˆå€‹äººæƒ…å ±ä¿è­·æ³•ï¼‰ã«åŸºã¥ãã€å½“ã‚µãƒ¼ãƒ“ã‚¹ãŒä¿æœ‰ã™ã‚‹ã”è‡ªèº«ã®å€‹äººæƒ…å ±ã«ã¤ã„ã¦ã€ä»¥ä¸‹ã®è«‹æ±‚ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚</p>
    <ul style="margin:8px 0;padding-left:24px;">
      <li>åˆ©ç”¨ç›®çš„ã®é€šçŸ¥</li>
      <li>é–‹ç¤º</li>
      <li>å†…å®¹ã®è¨‚æ­£ãƒ»è¿½åŠ ãƒ»å‰Šé™¤</li>
      <li>åˆ©ç”¨ã®åœæ­¢ãƒ»æ¶ˆå»</li>
      <li>ç¬¬ä¸‰è€…ã¸ã®æä¾›ã®åœæ­¢</li>
    </ul>
    <p>ä¸Šè¨˜ã®ã”è«‹æ±‚ã¯ã€ä¸‹è¨˜ã®çª“å£ã¾ã§ã”é€£çµ¡ãã ã•ã„ã€‚ã”æœ¬äººç¢ºèªã®ã†ãˆã€åˆç†çš„ãªæœŸé–“å†…ã«å¯¾å¿œã„ãŸã—ã¾ã™ã€‚</p>
    <div style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:12px 16px;margin:8px 0;">
      <strong>ãƒ‡ã‚¿ã‚¦ãƒª.Detauriï¼ˆå€‹äººæƒ…å ±ã«é–¢ã™ã‚‹ãŠå•ã„åˆã‚ã›çª“å£ï¼‰</strong><br>
      ãƒ¡ãƒ¼ãƒ«ï¼šnkonline1030@gmail.com<br>
      é›»è©±ï¼š090-5820-1803ï¼ˆå¹³æ—¥ 10:00ã€œ18:00ï¼‰
    </div>

    <h4 style="font-size:14px;font-weight:700;margin:20px 0 8px;">8. æ”¹å®š</h4>
    <p>æœ¬ãƒãƒªã‚·ãƒ¼ã¯ã€æ³•ä»¤ã®å¤‰æ›´ã‚„ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹ã®å¤‰æ›´ã«ä¼´ã„ã€äºˆå‘Šãªãæ”¹å®šã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚æ”¹å®šå¾Œã®ãƒãƒªã‚·ãƒ¼ã¯å½“ã‚µãƒ¼ãƒ“ã‚¹ä¸Šã«æ²è¼‰ã—ãŸæ™‚ç‚¹ã§åŠ¹åŠ›ã‚’ç”Ÿã˜ã¾ã™ã€‚</p>

    <p style="margin-top:20px;color:#64748b;font-size:12px;">æœ€çµ‚æ›´æ–°æ—¥ï¼š2026å¹´2æœˆ21æ—¥</p>
  </div>
</div>

<!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
<footer class="footer">
  <p>NKonline Apparel / ãƒ‡ã‚¿ã‚¦ãƒª.Detauri</p>
  <p style="margin-top:6px">
    <a href="#" id="openLegalLink">ç‰¹å®šå•†å–å¼•æ³•ã«åŸºã¥ãè¡¨è¨˜</a> ï½œ
    <a href="#" id="openContactLink">ãŠå•ã„åˆã‚ã›</a> ï½œ
    <a href="#" id="openPrivacyLink">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a>
  </p>
  <p style="margin-top:8px;color:#64748b;">&copy; 2025-2026 ãƒ‡ã‚¿ã‚¦ãƒª.Detauri</p>
  <p style="margin-top:16px;padding-top:14px;border-top:1px solid #252545;font-size:10px;color:#4a5568;line-height:1.8;">
    é‹å–¶ä¼šç¤¾ï¼š<a href="https://nkonline-official.netlify.app" target="_blank" rel="noopener" style="color:#6b7a99;">NKonline</a>
    ï½œ å¤ç‰©å•†è¨±å¯ï¼šå¤§é˜ªåºœå…¬å®‰å§”å“¡ä¼š ç¬¬62228R076481å·
    ï½œ ã‚¤ãƒ³ãƒœã‚¤ã‚¹ç™»éŒ²ç•ªå·ï¼šT9810785107076<br>
    å‰¯æ¥­æ”¯æ´ï¼ˆã‚¢ãƒ‘ãƒ¬ãƒ«ç‰©è²©ï¼‰ãƒ»ç”ŸæˆAIã‚’æ´»ç”¨ã—ãŸã‚·ã‚¹ãƒ†ãƒ é–‹ç™º
  </p>
</footer>

</div>

<script>
// =====================================================
// çŠ¶æ…‹
// =====================================================
var BULK_CART_KEY = 'bulk_cart_v1';
var DETAURI_CART_KEY = 'estimate_cart_v2';
var SESSION_KEY = 'estimate_session';

// ãƒšãƒ¼ã‚¸é·ç§»ç”¨: ãƒ‡ã‚¿ã‚¦ãƒªãƒšãƒ¼ã‚¸HTMLã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆlocalStorageæ°¸ç¶šåŒ–ï¼‰
var _cachedDetailHtml = null;
var DETAIL_HTML_CACHE_KEY = 'page_html_detail_v14';
var PAGE_HTML_CACHE_TTL = 10 * 60 * 1000; // 10åˆ†

function loadDetailHtmlCache_() {
  try {
    var raw = localStorage.getItem(DETAIL_HTML_CACHE_KEY);
    if (!raw) return null;
    var c = JSON.parse(raw);
    if (!c || !c.ts || !c.html) return null;
    return { html: c.html, stale: (Date.now() - c.ts >= PAGE_HTML_CACHE_TTL) };
  } catch (e) { return null; }
}

function saveDetailHtmlCache_(html) {
  try {
    localStorage.setItem(DETAIL_HTML_CACHE_KEY, JSON.stringify({ ts: Date.now(), html: html }));
  } catch (e) {}
}

// å•†å“ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆãƒ‡ã‚¿ã‚¦ãƒªã¨åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
var BULK_PRODUCT_CACHE_KEY = 'bulk_product_cache_v1';
var BULK_PRODUCT_CACHE_TTL = 5 * 60 * 1000; // 5åˆ†

// ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ãƒ¢ãƒ¼ãƒ‰åˆ¤å®šï¼ˆCloudflare Pagesç­‰ã‹ã‚‰ã®é…ä¿¡æ™‚ï¼‰
var GAS_API_URL = 'https://script.google.com/macros/s/AKfycbzWcsi_QteRBwc2U88urRQvWG1FsrKUoFSd_r3uPmPasJnm0jfKe02IbmzlkK7Sb1x_Jg/exec';
var IS_STANDALONE = (typeof google === 'undefined' || !google.script);

// google.script.run shimç”Ÿæˆï¼ˆdocument.writeå¾Œã®ãƒ‡ã‚¿ã‚¦ãƒªãƒšãƒ¼ã‚¸ç”¨ï¼‰
function _buildGasShim(url) {
  return '<script>' +
    '(function(){' +
    'if(typeof google!=="undefined"&&google.script&&google.script.run)return;' +
    'var U="' + url + '";' +
    'window.google={script:{}};' +
    'function cr(){' +
      'var _o=null,_f=null,r={};' +
      'r.withSuccessHandler=function(fn){_o=fn;return r};' +
      'r.withFailureHandler=function(fn){_f=fn;return r};' +
      'return new Proxy(r,{get:function(t,p){' +
        'if(p==="withSuccessHandler"||p==="withFailureHandler")return t[p].bind(t);' +
        'return function(){' +
          'var a=[].slice.call(arguments),ok=_o,fl=_f;' +
          'fetch(U,{method:"POST",headers:{"Content-Type":"text/plain"},' +
          'body:JSON.stringify({action:p,args:a,adminKey:localStorage.getItem("_nk_owner_key")||""}),' +
          'redirect:"follow"})' +
          '.then(function(r){if(!r.ok)throw new Error("HTTP "+r.status);return r.json()})' +
          '.then(function(d){if(ok)ok(d)})' +
          '.catch(function(e){if(fl)fl(e)})' +
        '}' +
      '}})' +
    '}' +
    'Object.defineProperty(google.script,"run",{get:function(){return cr()}})' +
    '})()' +
    '<' + '/script>';
}

// Admin Key: URLã‹ã‚‰å–å¾—å¾Œã€localStorageã«ä¿å­˜ã—ã¦URLã‹ã‚‰é™¤å»
var ADMIN_KEY = (function() {
  var urlKey = (new URLSearchParams(window.location.search)).get('admin') || '';
  if (urlKey) {
    try { localStorage.setItem('_nk_owner_key', urlKey); } catch(e) {}
    try {
      var cleanUrl = new URL(window.location.href);
      cleanUrl.searchParams.delete('admin');
      window.history.replaceState({}, '', cleanUrl.toString());
    } catch(e) {}
    return urlKey;
  }
  try { return localStorage.getItem('_nk_owner_key') || ''; } catch(e) { return ''; }
})();

function runApi(fn) {
  var args = Array.prototype.slice.call(arguments, 1);
  if (IS_STANDALONE) {
    return fetch(GAS_API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain' },
      body: JSON.stringify({ action: fn, args: args, adminKey: (typeof ADMIN_KEY !== 'undefined' ? ADMIN_KEY : '') }),
      redirect: 'follow'
    })
    .then(function(res) {
      if (!res.ok) throw new Error('HTTP ' + res.status);
      return res.json();
    });
  }
  return new Promise(function(resolve, reject) {
    var done = false;
    var timer = setTimeout(function() {
      if (done) return; done = true;
      reject(new Error('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ'));
    }, 30000);
    try {
      var runner = google.script.run
        .withSuccessHandler(function(res) {
          if (done) return; done = true; clearTimeout(timer);
          resolve(res);
        })
        .withFailureHandler(function(err) {
          if (done) return; done = true; clearTimeout(timer);
          reject(err);
        });
      runner[fn].apply(runner, args);
    } catch (e) {
      if (done) return; done = true; clearTimeout(timer);
      reject(e);
    }
  });
}

var G = {
  products: [],
  cart: {},           // { productId: qty }
  settings: {},
  sessionId: null,    // ä¼šå“¡ã‚»ãƒƒã‚·ãƒ§ãƒ³ID
  customer: null,     // å…±æœ‰ä¼šå“¡æƒ…å ±
  coupon: null,       // { type, value, discountAmount, freeShipping, label }
  shipping: 0,
  shippingSize: '',
  shippingPref: '',
  submitting: false,
  detauriCartTotal: 0,
  detauriCartCount: 0,
  detauriShipping: 0,
  detauriShippingLabel: '',
  detauriShippingPref: '',
  detauriShippingSizeLabel: '',
  detauriItems: []
};

// =====================================================
// å•†å“ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆlocalStorageï¼‰
// =====================================================
function loadBulkProductCache_() {
  try {
    var raw = localStorage.getItem(BULK_PRODUCT_CACHE_KEY);
    if (!raw) return null;
    var c = JSON.parse(raw);
    if (!c || !c.ts || !c.data) return null;
    var fresh = (Date.now() - c.ts < BULK_PRODUCT_CACHE_TTL);
    return { data: c.data, stale: !fresh };
  } catch (e) { return null; }
}

function saveBulkProductCache_(data) {
  try {
    localStorage.setItem(BULK_PRODUCT_CACHE_KEY, JSON.stringify({ ts: Date.now(), data: data }));
  } catch (e) {}
}

function applyBulkData_(r, savedCart) {
  G.products = r.products || [];
  G.settings = r.settings || {};
  // ãƒ‡ã‚¿ã‚¦ãƒªãƒªãƒ³ã‚¯ã®href/targetã‚’è¨­å®šï¼ˆGAS URLã§é€šå¸¸é·ç§»å¯èƒ½ã«ã™ã‚‹ï¼‰
  var dl = document.getElementById('detauriLink');
  var dbl = document.getElementById('detauriBannerLink');
  // /BulkLP.html ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚ŒãŸå ´åˆã¯ãƒ‘ã‚¹ã‚’é™¤ã„ãŸãƒ«ãƒ¼ãƒˆã‚’ãƒ‡ã‚¿ã‚¦ãƒªãƒªãƒ³ã‚¯ã«ä½¿ç”¨
  var _basePath = window.location.pathname.replace(/\/BulkLP\.html$/, '') || '/';
  if (!_basePath.endsWith('/')) _basePath += '/';
  var _detauriUrl = window.location.origin + _basePath;
  if (dl) { dl.href = _detauriUrl; dl.target = '_top'; }
  if (dbl) { dbl.href = _detauriUrl; dbl.target = '_top'; }
  // ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãƒšãƒ¼ã‚¸åˆ‡æ›¿ï¼ˆdocument.writeæ–¹å¼ãƒ»å³æ™‚åˆ‡æ›¿: 0.1ç§’ä»¥å†…ï¼‰
  function navigateToDetail_() {
    // document.writeã¯æ—§DOMãŒæ®‹ã‚‹ãƒ–ãƒ©ã‚¦ã‚¶ãŒã‚ã‚‹ãŸã‚ã€ç›´æ¥ãƒŠãƒ“ã‚²ãƒ¼ãƒˆã«å¤‰æ›´
    try { sessionStorage.setItem('_pageTransition', '1'); } catch (e) {}
    window.location.href = _detauriUrl;
    return true;
  }
  if (dl) dl.addEventListener('click', function(e) { e.preventDefault(); navigateToDetail_(); });
  if (dbl) dbl.addEventListener('click', function(e) { e.preventDefault(); navigateToDetail_(); });
  if (savedCart && Object.keys(savedCart).length > 0) {
    var validProducts = {};
    G.products.forEach(function(p) { validProducts[p.productId] = true; });
    Object.keys(savedCart).forEach(function(pid) {
      if (validProducts[pid] && !G.cart[pid]) G.cart[pid] = savedCart[pid];
    });
  }
  renderProducts();
  updateCart();
}

// =====================================================
// ãƒ˜ãƒƒãƒ€ãƒ¼è‡ªå‹•ç¸®å°ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ–¹å‘é€£å‹•ï¼‰
// =====================================================
(function() {
  var _lastScrollY = 0;
  var _row2Hidden = false;
  window.addEventListener('scroll', function() {
    var header = document.querySelector('.header');
    if (!header) return;
    var currentY = window.scrollY;
    var delta = currentY - _lastScrollY;
    if (Math.abs(delta) < 5) { _lastScrollY = currentY; return; }
    if (currentY <= 0) {
      if (_row2Hidden) { _row2Hidden = false; header.classList.remove('row2-hidden'); }
    } else if (delta > 0) {
      if (!_row2Hidden) { _row2Hidden = true; header.classList.add('row2-hidden'); }
    } else {
      if (_row2Hidden) { _row2Hidden = false; header.classList.remove('row2-hidden'); }
    }
    _lastScrollY = currentY;
  }, { passive: true });
})();

// =====================================================
// ãƒ—ãƒ­ãƒ¢ãƒãƒŠãƒ¼ sticky é€£å‹•: header ã® top ä½ç½®ã‚’å‹•çš„èª¿æ•´
// =====================================================
function adjustHeaderForBanner_() {
  var banner = document.getElementById('promoBanner');
  var header = document.querySelector('.header');
  if (!header) return;
  if (banner && banner.style.display !== 'none') {
    header.style.top = banner.offsetHeight + 'px';
  } else {
    header.style.top = '0';
  }
}

// =====================================================
// åˆæœŸåŒ–ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥å„ªå…ˆ â†’ ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰æ›´æ–°ï¼‰
// =====================================================
window.addEventListener('DOMContentLoaded', function() {
  loadDetauriCart();
  var savedCart = loadBulkCart();
  loadSharedSession();
  window.addEventListener('resize', adjustHeaderForBanner_);

  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å³æ™‚è¡¨ç¤º
  var cached = loadBulkProductCache_();
  var cacheApplied = false;
  if (cached && cached.data) {
    console.log('BulkLP: ' + (cached.stale ? 'å¤ã„' : '') + 'ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å³æ™‚è¡¨ç¤º:', (cached.data.products || []).length + 'ä»¶');
    applyBulkData_(cached.data, savedCart);
    cacheApplied = true;
  }
  // ãƒšãƒ¼ã‚¸é·ç§»ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã®ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
  document.body.classList.remove('page-entering');
  document.body.style.background = '';
  var pt = document.getElementById('pageTransition');
  if (pt) pt.classList.remove('active');

  // ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
  var initDone = false;
  var loadTimer = setTimeout(function() {
    if (!initDone && !cacheApplied) {
      showProductError('èª­ã¿è¾¼ã¿ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
    }
  }, 30000);

  runApi('apiBulkInit')
    .then(function(r) {
      initDone = true;
      clearTimeout(loadTimer);
      try {
        if (!r || !r.ok) {
          if (!cacheApplied) showProductError(r && r.message ? r.message : 'èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
          return;
        }
        saveBulkProductCache_(r);
        var newCount = (r.products || []).length;
        if (!cacheApplied || newCount !== G.products.length) {
          console.log('BulkLP: æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã§æ›´æ–°:', newCount + 'ä»¶');
          applyBulkData_(r, savedCart);
        } else {
          // settingsï¼ˆä¼šå“¡å‰²å¼•ç­‰ï¼‰ã ã‘é™ã‹ã«æ›´æ–°
          G.settings = r.settings || {};
          updateCart();
        }
      } catch (err) {
        if (!cacheApplied) showProductError('è¡¨ç¤ºã‚¨ãƒ©ãƒ¼: ' + (err.message || err));
      }
    })
    .catch(function(e) {
      initDone = true;
      clearTimeout(loadTimer);
      if (!cacheApplied) showProductError(e && e.message ? e.message : 'æ¥ç¶šã‚¨ãƒ©ãƒ¼');
    });

  document.getElementById('postal').addEventListener('input', onPostalInput);

  // ãƒ‡ã‚¿ã‚¦ãƒªãƒšãƒ¼ã‚¸HTMLã‚’ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒï¼ˆã‚·ãƒ¼ãƒ ãƒ¬ã‚¹åˆ‡æ›¿ç”¨ï¼‰
  setTimeout(function() { prefetchDetailPage_(); }, 1000);
});

// =====================================================
// ãƒ‡ã‚¿ã‚¦ãƒªãƒšãƒ¼ã‚¸HTMLãƒ—ãƒªãƒ•ã‚§ãƒƒãƒï¼ˆdocument.writeé·ç§»ç”¨ï¼‰
// =====================================================
function prefetchDetailPage_() {
  if (_cachedDetailHtml) return;
  var cached = loadDetailHtmlCache_();
  if (cached && cached.html) {
    _cachedDetailHtml = cached.html;
    if (!cached.stale) return;
  }
  runApi('apiDetailPage')
    .then(function(r) {
      if (r && r.ok && r.html) {
        _cachedDetailHtml = r.html;
        saveDetailHtmlCache_(r.html);
        console.log('ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒå®Œäº†: ãƒ‡ã‚¿ã‚¦ãƒªãƒšãƒ¼ã‚¸HTML');
      }
    })
    .catch(function(e) { console.log('ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒå¤±æ•—:', e); });
}

// =====================================================
// å•†å“ä¸€è¦§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
// =====================================================
function showProductError(msg) {
  document.getElementById('productList').innerHTML = '<div class="cart-empty">' + escHtml(msg) + '</div>';
}

function renderProducts() {
  var el = document.getElementById('productList');
  if (!G.products.length) { el.innerHTML = '<div class="cart-empty">å•†å“ãŒã‚ã‚Šã¾ã›ã‚“</div>'; return; }

  var html = '';
  for (var i = 0; i < G.products.length; i++) {
    var p = G.products[i];
    html += renderProductCard(p, i);
  }
  el.innerHTML = html;
}

// =====================================================
// å•†å“è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«
// =====================================================
function openProductModal(idx) {
  var p = G.products[idx];
  if (!p) return;

  var modal = document.getElementById('productModal');
  var imagesEl = document.getElementById('modalImages');
  var thumbsEl = document.getElementById('modalThumbs');
  var bodyEl = document.getElementById('modalBody');

  // ç”»åƒ
  var imgHtml = '';
  var thumbHtml = '';
  if (p.images && p.images.length > 0) {
    for (var i = 0; i < p.images.length; i++) {
      imgHtml += '<img src="' + escAttr(p.images[i]) + '" alt="' + escAttr(p.name) + '" class="' + (i === 0 ? 'active' : '') + '" data-idx="' + i + '">';
    }
    if (p.images.length > 1) {
      imgHtml += '<button class="img-nav prev" onclick="slideModalImg(-1)">&#8249;</button>';
      imgHtml += '<button class="img-nav next" onclick="slideModalImg(1)">&#8250;</button>';
      imgHtml += '<div class="img-dots">';
      for (var d = 0; d < p.images.length; d++) {
        imgHtml += '<div class="img-dot' + (d === 0 ? ' active' : '') + '" onclick="goModalImg(' + d + ')"></div>';
      }
      imgHtml += '</div>';
    }
    // ã‚µãƒ ãƒã‚¤ãƒ«
    for (var t = 0; t < p.images.length; t++) {
      thumbHtml += '<img src="' + escAttr(p.images[t]) + '" alt="" class="' + (t === 0 ? 'active' : '') + '" onclick="goModalImg(' + t + ')">';
    }
  } else {
    imgHtml = '<div class="no-image" style="aspect-ratio:4/3">ç”»åƒãªã—</div>';
  }
  imagesEl.innerHTML = imgHtml;
  thumbsEl.innerHTML = thumbHtml;
  thumbsEl.style.display = (p.images && p.images.length > 1) ? 'flex' : 'none';

  // ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼ï¼ˆå›ºå®šé ˜åŸŸ: å•†å“å + åœ¨åº«æ•°ï¼‰
  var isSoldOut = p.soldOut === true;
  var titleBarEl = document.getElementById('modalTitleBar');
  var stockHtml = '';
  if (isSoldOut) {
    stockHtml = '<div class="modal-stock" style="color:#d93025;font-weight:700">SOLD OUT</div>';
  } else if (p.stock !== -1) {
    var effectiveMax = Math.min(p.maxQty, p.stock);
    stockHtml = '<div class="modal-stock">åœ¨åº«: ' + p.stock + 'ç‚¹ï¼ˆæœ€å¤§' + effectiveMax + p.unit + 'æ³¨æ–‡å¯ï¼‰</div>';
  }
  titleBarEl.innerHTML =
    '<div class="product-name">' + escHtml(p.name) + '</div>'
    + stockHtml;

  // æœ¬æ–‡ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é ˜åŸŸ: èª¬æ˜æ–‡ã®ã¿ï¼‰
  var tagHtml = p.tag ? '<span class="product-tag">' + escHtml(p.tag) + '</span>' : '';
  bodyEl.innerHTML =
    (p.description ? '<div class="product-desc">' + escHtml(p.description) + '</div>' : '');

  // å›ºå®šä¸‹éƒ¨: ä¾¡æ ¼ + æ•°é‡ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
  var bottomEl = document.getElementById('modalBottom');
  var priceHtml = '';
  if (p.discountRate > 0) {
    priceHtml = '<span class="original">Â¥' + numFmt(p.price) + '</span>'
      + 'Â¥' + numFmt(p.discountedPrice) + '<small>' + escHtml(p.unit) + '</small>'
      + '<span class="disc-badge">' + Math.round(p.discountRate * 100) + '%OFF</span>';
  } else {
    priceHtml = 'Â¥' + numFmt(p.price) + '<small>' + escHtml(p.unit) + '</small>';
  }
  var qty = isSoldOut ? 0 : (G.cart[p.productId] || 0);
  var qtyClass = 'qty-control' + (isSoldOut ? '" style="opacity:.3;pointer-events:none' : '');
  bottomEl.innerHTML =
    '<div class="product-bottom">'
    + '<div class="product-price-area">' + tagHtml + '<div class="product-price">' + priceHtml + '</div></div>'
    + '<div class="' + qtyClass + '">'
    + '<button class="qty-btn" onclick="changeQty(\'' + escAttr(p.productId) + '\',-1)">âˆ’</button>'
    + '<input class="qty-value" id="modal_qty_' + escAttr(p.productId) + '" value="' + qty + '" readonly>'
    + '<button class="qty-btn" onclick="changeQty(\'' + escAttr(p.productId) + '\',1)">+</button>'
    + '</div></div>';

  modal.classList.add('active');
  document.body.style.overflow = 'hidden';
  if (typeof hideFabsForModal_ === 'function') hideFabsForModal_();
}

function closeModal() {
  var modal = document.getElementById('productModal');
  modal.classList.remove('active');
  document.body.style.overflow = '';
  if (typeof showFabsAfterModal_ === 'function') showFabsAfterModal_();
  // ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®æ•°é‡å¤‰æ›´ã‚’ãƒªã‚¹ãƒˆå´ã«ã‚‚åæ˜ 
  G.products.forEach(function(p) {
    var qty = G.cart[p.productId] || 0;
    var input = document.getElementById('qty_' + p.productId);
    if (input) input.value = qty;
  });
}

function closeModalOverlay(e) {
  if (e.target === e.currentTarget) closeModal();
}

function slideModalImg(dir) {
  var wrap = document.getElementById('modalImages');
  if (!wrap) return;
  var imgs = wrap.querySelectorAll('img');
  var cur = 0;
  for (var i = 0; i < imgs.length; i++) { if (imgs[i].classList.contains('active')) { cur = i; break; } }
  goModalImg((cur + dir + imgs.length) % imgs.length);
}

function goModalImg(to) {
  var wrap = document.getElementById('modalImages');
  if (!wrap) return;
  var imgs = wrap.querySelectorAll('img');
  var dots = wrap.querySelectorAll('.img-dot');
  var thumbs = document.getElementById('modalThumbs').querySelectorAll('img');
  for (var i = 0; i < imgs.length; i++) { imgs[i].classList.toggle('active', i === to); }
  for (var d = 0; d < dots.length; d++) { dots[d].classList.toggle('active', d === to); }
  for (var t = 0; t < thumbs.length; t++) { thumbs[t].classList.toggle('active', t === to); }
}

function renderProductCard(p, idx) {
  var isSoldOut = p.soldOut === true;
  var cardClass = 'product-card' + (isSoldOut ? ' sold-out' : '');

  var imgHtml = '';
  if (p.images && p.images.length > 0) {
    imgHtml += '<div class="product-images" id="imgs_' + idx + '" onclick="openProductModal(' + idx + ')">';
    imgHtml += '<img src="' + escAttr(p.images[0]) + '" alt="' + escAttr(p.name) + '" class="active">';
    if (p.images.length > 1) {
      imgHtml += '<div class="img-dots">';
      for (var d = 0; d < p.images.length; d++) {
        imgHtml += '<div class="img-dot' + (d === 0 ? ' active' : '') + '"></div>';
      }
      imgHtml += '</div>';
    }
    imgHtml += '</div>';
  } else {
    imgHtml = '<div class="no-image" onclick="openProductModal(' + idx + ')">ç”»åƒãªã—</div>';
  }

  var soldOutHtml = isSoldOut ? '<div class="sold-out-overlay"><span class="sold-out-badge">SOLD OUT</span></div>' : '';

  var tagHtml = p.tag ? '<span class="product-tag">' + escHtml(p.tag) + '</span>' : '';
  var qty = isSoldOut ? 0 : (G.cart[p.productId] || 0);

  var priceHtml = '';
  if (p.discountRate > 0) {
    priceHtml = '<span class="original">Â¥' + numFmt(p.price) + '</span>'
      + 'Â¥' + numFmt(p.discountedPrice) + '<small>' + escHtml(p.unit) + '</small>'
      + '<span class="disc-badge">' + Math.round(p.discountRate * 100) + '%OFF</span>';
  } else {
    priceHtml = 'Â¥' + numFmt(p.price) + '<small>' + escHtml(p.unit) + '</small>';
  }

  return '<div class="' + cardClass + '">'
    + imgHtml
    + soldOutHtml
    + '<div class="product-body">'
    + '<div class="product-name">' + escHtml(p.name) + '</div>'
    + '<div class="product-bottom">'
    + '<div class="product-price-area">' + tagHtml + '<div class="product-price">' + priceHtml + '</div></div>'
    + '<div class="qty-control">'
    + '<button class="qty-btn" onclick="changeQty(\'' + escAttr(p.productId) + '\',-1)">âˆ’</button>'
    + '<input class="qty-value" id="qty_' + escAttr(p.productId) + '" value="' + qty + '" readonly>'
    + '<button class="qty-btn" onclick="changeQty(\'' + escAttr(p.productId) + '\',1)">+</button>'
    + '</div></div></div></div>';
}

// =====================================================
// æ•°é‡å¤‰æ›´
// =====================================================
function changeQty(productId, delta) {
  var p = G.products.find(function(x) { return x.productId === productId; });
  if (!p) return;
  if (p.soldOut) return;
  var cur = G.cart[productId] || 0;
  var limit = p.maxQty;
  if (p.stock !== -1 && p.stock < limit) limit = p.stock;
  var next = Math.max(0, Math.min(limit, cur + delta));
  if (next === 0) { delete G.cart[productId]; }
  else { G.cart[productId] = next; }

  var input = document.getElementById('qty_' + productId);
  if (input) input.value = next;
  var modalInput = document.getElementById('modal_qty_' + productId);
  if (modalInput) modalInput.value = next;

  updateCart();
  saveBulkCart();

  // ã‚¯ãƒ¼ãƒãƒ³é©ç”¨ä¸­ã«ã‚«ãƒ¼ãƒˆãŒå¤‰ã‚ã£ãŸã‚‰å†æ¤œè¨¼
  revalidateCoupon();
}

// =====================================================
// ã‚«ãƒ¼ãƒˆæ›´æ–°
// =====================================================
function updateCart() {
  var el = document.getElementById('cartSection');
  var keys = Object.keys(G.cart);
  if (keys.length === 0) {
    recalcDetauriShipping_(); // ãƒ‡ã‚¿ã‚¦ãƒªé€æ–™ã‚‚ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨ˆç®—
    var emptyHtml = '<div class="cart-empty">å•†å“ã‚’é¸æŠã—ã¦ãã ã•ã„</div>';
    if (G.detauriCartCount > 0) {
      var detRows = '';
      var _detItems = G.detauriItems || [];
      var _dDelSvg = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="13" height="13" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6V4h6v2"/></svg>';
      for (var _di0 = 0; _di0 < _detItems.length; _di0++) {
        var _dit0 = _detItems[_di0].item;
        var _did0 = _detItems[_di0].id;
        var _dname0 = (_dit0.noLabel ? _dit0.noLabel : _did0) + (_dit0.brand ? ' ' + _dit0.brand : '');
        detRows += '<div class="cart-row" style="color:#5B86C5;font-size:12px;border-bottom:none;">'
          + '<button class="cart-delbtn" onclick="deleteDetauriItem_(\'' + escAttr(_did0) + '\')" aria-label="å‰Šé™¤" style="color:#5B86C5;border-color:#5B86C5;">' + _dDelSvg + '</button>'
          + '<span class="cart-row-name">' + escHtml(_dname0) + '</span>'
          + '<span class="cart-row-price">Â¥' + numFmt(Number(_dit0.price || 0)) + '</span>'
          + '</div>';
      }
      detRows += '<div class="cart-row" style="color:#5B86C5;font-size:12px;border-bottom:none;">'
        + '<span>ãƒ‡ã‚¿ã‚¦ãƒª å•†å“ä»£ï¼ˆ' + G.detauriCartCount + 'ç‚¹ï¼‰</span>'
        + '<span>Â¥' + numFmt(G.detauriCartTotal) + '</span></div>';
      var shippingDesc0 = 'ãƒ‡ã‚¿ã‚¦ãƒª é€æ–™';
      if (G.detauriShippingPref && G.detauriShippingSizeLabel) {
        shippingDesc0 = 'ãƒ‡ã‚¿ã‚¦ãƒª é€æ–™ï¼ˆ' + escHtml(G.detauriShippingPref) + 'ãƒ»' + escHtml(G.detauriShippingSizeLabel) + 'ï¼‰';
      }
      if (G.detauriShipping > 0) {
        detRows += '<div class="cart-row" style="color:#5B86C5;font-size:12px;border-bottom:none;">'
          + '<span>' + shippingDesc0 + '</span>'
          + '<span>Â¥' + numFmt(G.detauriShipping) + '</span></div>';
      }
      var detauriSub0 = G.detauriCartTotal + G.detauriShipping;
      detRows += '<div class="cart-row" style="color:#5B86C5;font-size:13px;font-weight:700;border-top:1px solid #c8d8f0;margin-top:4px;padding-top:8px;">'
        + '<span>ãƒ‡ã‚¿ã‚¦ãƒª å°è¨ˆ</span>'
        + '<span>Â¥' + numFmt(detauriSub0) + '</span></div>';
      emptyHtml += '<div class="cart-summary" style="margin-top:10px;">' + detRows + '</div>';
    }
    el.innerHTML = emptyHtml;
    var emptyGrand = G.detauriCartTotal + G.detauriShipping;
    updatePayButton(emptyGrand > 0 ? emptyGrand : 0);
    updateCartClearBtns_();
    return;
  }

  var productMap = {};
  G.products.forEach(function(p) { productMap[p.productId] = p; });

  var subtotal = 0;
  var totalQty = 0;
  var rows = '';
  for (var i = 0; i < keys.length; i++) {
    var pid = keys[i];
    var qty = G.cart[pid];
    var p = productMap[pid];
    if (!p) continue;
    var unitPrice = (p.discountedPrice !== undefined) ? p.discountedPrice : p.price;
    var line = unitPrice * qty;
    subtotal += line;
    totalQty += qty;
    rows += '<div class="cart-row">'
      + '<button class="cart-delbtn" onclick="changeQty(\'' + escAttr(pid) + '\',-999)" aria-label="å‰Šé™¤"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="13" height="13" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6V4h6v2"/></svg></button>'
      + '<span class="cart-row-name">' + escHtml(p.name) + '</span>'
      + '<span class="cart-row-ctrl">'
      + '<button class="cart-cqbtn" onclick="changeQty(\'' + escAttr(pid) + '\',-1)">âˆ’</button>'
      + '<span class="cart-row-qty">Ã—' + qty + '</span>'
      + '<button class="cart-cqbtn" onclick="changeQty(\'' + escAttr(pid) + '\',1)">+</button>'
      + '</span>'
      + '<span class="cart-row-price">Â¥' + numFmt(line) + '</span>'
      + '</div>';
  }

  // å‰²å¼•
  var discounted = subtotal;
  var discountRows = '';

  if (G.coupon) {
    var cd = G.coupon.discountAmount || 0;
    if (G.coupon.type === 'shipping_free') {
      var _partialFree = G.coupon.shippingExcludeProducts && calcExcludedQty_() > 0;
      var _shLabel = _partialFree ? '-é€æ–™ï¼ˆä¸€éƒ¨å•†å“é™¤å¤–ï¼‰' : '-é€æ–™';
      discountRows += '<div class="cart-row"><span>' + escHtml(G.coupon.label) + '</span><span>' + _shLabel + '</span></div>';
    } else if (cd > 0) {
      discounted -= cd;
      discountRows += '<div class="cart-row"><span>' + escHtml(G.coupon.label) + '</span><span>-Â¥' + numFmt(cd) + '</span></div>';
    }
  }

  if (totalQty >= 30 && (!G.coupon || G.coupon.comboBulk !== false)) {
    var bulkDisc = Math.round(discounted * 0.10);
    discounted -= bulkDisc;
    discountRows += '<div class="cart-row"><span>30ç‚¹ä»¥ä¸Šå‰²å¼• (10%OFF)</span><span>-Â¥' + numFmt(bulkDisc) + '</span></div>';
  }

  // ä¼šå“¡å‰²å¼•
  var md = G.settings.memberDiscount;
  if (G.customer && md && md.enabled && (!G.coupon || G.coupon.comboMember !== false)) {
    var memberDisc = Math.round(discounted * md.rate);
    discounted -= memberDisc;
    discountRows += '<div class="cart-row"><span>ä¼šå“¡å‰²å¼• (' + Math.round(md.rate * 100) + '%OFF)</span><span>-Â¥' + numFmt(memberDisc) + '</span></div>';
  }

  discounted = Math.max(0, discounted);

  // é€æ–™
  calcShipping(totalQty);
  recalcDetauriShipping_(); // ãƒ‡ã‚¿ã‚¦ãƒªé€æ–™ã‚‚ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨ˆç®—
  var shipping = calcEffectiveShipping_();

  if (shipping > 0) {
    var shippingQtyLabel = totalQty;
    if (G.coupon && G.coupon.freeShipping && G.coupon.shippingExcludeProducts) {
      var _exQty = calcExcludedQty_();
      if (_exQty > 0) shippingQtyLabel = _exQty;
    }
    rows += '<div class="cart-row"><span>é€æ–™ï¼ˆ' + escHtml(G.shippingPref || 'æœªå…¥åŠ›') + 'ãƒ»å¤§Ã—' + shippingQtyLabel + 'ï¼‰</span><span>Â¥' + numFmt(shipping) + '</span></div>';
  } else if (shipping === 0 && G.shippingPref) {
    rows += '<div class="cart-row"><span>é€æ–™</span><span>Â¥0ï¼ˆç„¡æ–™ï¼‰</span></div>';
  }

  var total = discounted + shipping;
  rows += discountRows;
  rows += '<div class="cart-row total"><span>ã‚¢ã‚½ãƒ¼ãƒˆå•†å“ å°è¨ˆ</span><span>Â¥' + numFmt(total) + '</span></div>';

  // ãƒ‡ã‚¿ã‚¦ãƒªã‚«ãƒ¼ãƒˆã®åˆç®—è¡¨ç¤º
  var grandTotal = total;
  if (G.detauriCartCount > 0) {
    var _dItemsFull = G.detauriItems || [];
    var _dDelSvgF = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="13" height="13" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6V4h6v2"/></svg>';
    for (var _dii = 0; _dii < _dItemsFull.length; _dii++) {
      var _dittF = _dItemsFull[_dii].item;
      var _diidF = _dItemsFull[_dii].id;
      var _dnameF = (_dittF.noLabel ? _dittF.noLabel : _diidF) + (_dittF.brand ? ' ' + _dittF.brand : '');
      rows += '<div class="cart-row" style="color:#5B86C5;font-size:12px;border-bottom:none;' + (_dii === 0 ? 'padding-top:10px;' : '') + '">'
        + '<button class="cart-delbtn" onclick="deleteDetauriItem_(\'' + escAttr(_diidF) + '\')" aria-label="å‰Šé™¤" style="color:#5B86C5;border-color:#5B86C5;">' + _dDelSvgF + '</button>'
        + '<span class="cart-row-name">' + escHtml(_dnameF) + '</span>'
        + '<span class="cart-row-price">Â¥' + numFmt(Number(_dittF.price || 0)) + '</span>'
        + '</div>';
    }
    rows += '<div class="cart-row" style="color:#5B86C5;font-size:12px;border-bottom:none;">'
      + '<span>ãƒ‡ã‚¿ã‚¦ãƒª å•†å“ä»£ï¼ˆ' + G.detauriCartCount + 'ç‚¹ï¼‰</span>'
      + '<span>Â¥' + numFmt(G.detauriCartTotal) + '</span></div>';
    var shippingDesc = 'ãƒ‡ã‚¿ã‚¦ãƒª é€æ–™';
    if (G.detauriShippingPref && G.detauriShippingSizeLabel) {
      shippingDesc = 'ãƒ‡ã‚¿ã‚¦ãƒª é€æ–™ï¼ˆ' + escHtml(G.detauriShippingPref) + 'ãƒ»' + escHtml(G.detauriShippingSizeLabel) + 'ï¼‰';
    }
    if (G.detauriShipping > 0) {
      rows += '<div class="cart-row" style="color:#5B86C5;font-size:12px;border-bottom:none;">'
        + '<span>' + shippingDesc + '</span>'
        + '<span>Â¥' + numFmt(G.detauriShipping) + '</span></div>';
    }
    var detauriTotal = G.detauriCartTotal + G.detauriShipping;
    rows += '<div class="cart-row" style="color:#5B86C5;font-size:13px;font-weight:700;border-top:1px solid #c8d8f0;margin-top:4px;padding-top:8px;">'
      + '<span>ãƒ‡ã‚¿ã‚¦ãƒª å°è¨ˆ</span>'
      + '<span>Â¥' + numFmt(detauriTotal) + '</span></div>';
    grandTotal = total + detauriTotal;
    rows += '<div class="cart-row total" style="border-top-color:#5B86C5;"><span>ä¸¡ãƒãƒ£ãƒãƒ«åˆè¨ˆï¼ˆç¨è¾¼ï¼‰</span><span>Â¥' + numFmt(grandTotal) + '</span></div>';
  }

  el.innerHTML = '<div class="cart-summary">' + rows + '</div>';
  updatePayButton(grandTotal);
  updateCartClearBtns_();
}

function updatePayButton(total) {
  var btn = document.getElementById('payButton');
  var stickyBar = document.getElementById('bulkStickyPay');
  var stickyTotal = document.getElementById('bulkStickyPayTotal');
  var stickyBtn = document.getElementById('bulkStickyPayBtn');
  if (total > 0) {
    btn.disabled = false;
    btn.textContent = 'ãŠæ”¯æ‰•ã„ã¸é€²ã‚€ â€” Â¥' + numFmt(total);
    if (stickyBar) stickyBar.classList.add('active');
    if (stickyTotal) stickyTotal.textContent = 'Â¥' + numFmt(total);
    if (stickyBtn) stickyBtn.disabled = false;
    document.body.classList.add('has-bulk-cart');
  } else {
    btn.disabled = true;
    btn.textContent = 'ã‚«ãƒ¼ãƒˆãŒç©ºã§ã™';
    if (stickyBar) stickyBar.classList.remove('active');
    if (stickyTotal) stickyTotal.textContent = 'Â¥0';
    if (stickyBtn) stickyBtn.disabled = true;
    document.body.classList.remove('has-bulk-cart');
  }
}

// =====================================================
// é€æ–™è¨ˆç®—ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§å³æ™‚åæ˜ ï¼‰
// =====================================================
function calcShipping(totalQty) {
  var addr = document.getElementById('address').value;
  if (!addr) { G.shipping = 0; G.shippingPref = ''; G.shippingSize = ''; return; }

  var pref = detectPrefClient(addr);
  if (!pref) { G.shipping = 0; G.shippingPref = ''; G.shippingSize = ''; return; }

  G.shippingPref = pref;

  var areas = G.settings.shippingAreas || {};
  var rates = G.settings.shippingRates || {};
  var area = areas[pref];
  if (!area || !rates[area]) { G.shipping = 0; return; }

  // ã‚¢ã‚½ãƒ¼ãƒˆå•†å“: å¸¸ã«å¤§ã‚µã‚¤ã‚º Ã— æ•°é‡
  G.shippingSize = 'large';
  var largeRate = rates[area][1]; // [1] = å¤§
  G.shipping = largeRate * totalQty;
}

// é€æ–™é™¤å¤–å•†å“ã®æ•°é‡ã‚’è¨ˆç®—
function calcExcludedQty_() {
  if (!G.coupon || !G.coupon.shippingExcludeProducts) return 0;
  var excludeIds = G.coupon.shippingExcludeProducts.split(',').map(function(s) { return s.trim().toUpperCase(); }).filter(function(s) { return s; });
  if (excludeIds.length === 0) return 0;
  var qty = 0;
  Object.keys(G.cart).forEach(function(pid) {
    if (excludeIds.indexOf(pid.toUpperCase()) >= 0) qty += G.cart[pid];
  });
  return qty;
}

// é€æ–™ç„¡æ–™ã‚¯ãƒ¼ãƒãƒ³é©ç”¨æ™‚ã®å®ŸåŠ¹é€æ–™ã‚’è¨ˆç®—ï¼ˆé€æ–™é™¤å¤–å•†å“ã¯å€‹åˆ¥è¨ˆç®—ï¼‰
function calcEffectiveShipping_() {
  if (G.coupon && G.coupon.freeShipping) {
    var excludedQty = calcExcludedQty_();
    if (excludedQty > 0 && G.shippingPref) {
      var areas = G.settings.shippingAreas || {};
      var rates = G.settings.shippingRates || {};
      var area = areas[G.shippingPref];
      return (area && rates[area]) ? rates[area][1] * excludedQty : 0;
    }
    return 0;
  }
  return G.shipping;
}

// è¤‡æ•°å£é€æ–™è¨ˆç®—ï¼ˆä¸Šé™è¶…éæ™‚ã«åˆ†å‰²ï¼‰
function calculateMultiShipment_(thick, thin, rates) {
  var smallRate = rates[0], largeRate = rates[1];
  var totalAmount = 0, largeCnt = 0, smallCnt = 0;
  if (thick > 0) {
    var n = Math.ceil(thick / 20);
    largeCnt += n;
    totalAmount += n * largeRate;
  }
  var rem = thin;
  while (rem > 0) {
    var batch = Math.min(rem, 40);
    if (batch <= 10) { smallCnt++; totalAmount += smallRate; }
    else { largeCnt++; totalAmount += largeRate; }
    rem -= batch;
  }
  var parts = [];
  if (largeCnt > 0) parts.push('å¤§Ã—' + largeCnt);
  if (smallCnt > 0) parts.push('å°Ã—' + smallCnt);
  return { amount: totalAmount, sizeLabel: parts.join('ã€'), largeCnt: largeCnt, smallCnt: smallCnt };
}

// ãƒ‡ã‚¿ã‚¦ãƒªé€æ–™ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨ˆç®—ï¼ˆã‚¢ã‚½ãƒ¼ãƒˆå•†å“ãƒšãƒ¼ã‚¸ä¸Šã§ä½æ‰€å…¥åŠ›æ™‚ï¼‰
function recalcDetauriShipping_() {
  if (G.detauriCartCount === 0) return;
  var addr = document.getElementById('address').value;
  if (!addr) return; // ä½æ‰€æœªå…¥åŠ›æ™‚ã¯loadDetauriCart()ã§èª­ã¿è¾¼ã‚“ã å€¤ã‚’ç¶­æŒ

  var pref = detectPrefClient(addr);
  if (!pref) { G.detauriShipping = 0; G.detauriShippingPref = ''; G.detauriShippingSizeLabel = ''; return; }

  var areas = G.settings.shippingAreas || {};
  var rates = G.settings.shippingRates || {};
  var area = areas[pref];
  if (!area || !rates[area]) { G.detauriShipping = 0; return; }

  // estimate_cart_v2 ã‹ã‚‰ã‚¢ã‚¤ãƒ†ãƒ ã®åšã¿æƒ…å ±ã‚’å–å¾—
  try {
    var raw = localStorage.getItem(DETAURI_CART_KEY);
    if (!raw) return;
    var j = JSON.parse(raw);
    var ids = Array.isArray(j.ids) ? j.ids : [];
    var items = j.itemsById || {};
    var thick = 0, thin = 0;
    for (var i = 0; i < ids.length; i++) {
      var it = items[ids[i]];
      if (!it) continue;
      if (String(it.shippingMethod || '').trim() === 'ã‚†ã†ãƒ‘ã‚±ãƒƒãƒˆãƒã‚¹ãƒˆ') thin++;
      else thick++;
    }
    var total = thick + thin;
    if (total === 0) return;

    // ã‚µã‚¤ã‚ºåˆ¤å®šï¼ˆãƒ‡ã‚¿ã‚¦ãƒªã¨åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
    var size = null, sizeLabel = '', overLimit = false;
    if (thin === 0) {
      if (total > 20) overLimit = true;
      else { size = 'large'; sizeLabel = 'å¤§'; }
    } else if (thick === 0) {
      if (total > 40) overLimit = true;
      else { size = total <= 10 ? 'small' : 'large'; sizeLabel = total <= 10 ? 'å°' : 'å¤§'; }
    } else {
      if (total > 40) overLimit = true;
      else if (thick >= 10) { size = 'large'; sizeLabel = 'å¤§'; }
      else { size = total <= 10 ? 'small' : 'large'; sizeLabel = total <= 10 ? 'å°' : 'å¤§'; }
    }

    if (overLimit) {
      var multi = calculateMultiShipment_(thick, thin, [rates[area][0], rates[area][1]]);
      G.detauriShipping = multi.amount;
      G.detauriShippingPref = pref;
      G.detauriShippingSizeLabel = multi.sizeLabel;
      return;
    }

    var rateIdx = (size === 'small') ? 0 : 1;
    G.detauriShipping = rates[area][rateIdx];
    G.detauriShippingPref = pref;
    G.detauriShippingSizeLabel = sizeLabel;
  } catch (e) {}
}

function detectPrefClient(text) {
  var prefs = ['åŒ—æµ·é“','é’æ£®çœŒ','å²©æ‰‹çœŒ','å®®åŸçœŒ','ç§‹ç”°çœŒ','å±±å½¢çœŒ','ç¦å³¶çœŒ',
    'èŒ¨åŸçœŒ','æ ƒæœ¨çœŒ','ç¾¤é¦¬çœŒ','åŸ¼ç‰çœŒ','åƒè‘‰çœŒ','æ±äº¬éƒ½','ç¥å¥ˆå·çœŒ',
    'æ–°æ½ŸçœŒ','å¯Œå±±çœŒ','çŸ³å·çœŒ','ç¦äº•çœŒ','å±±æ¢¨çœŒ','é•·é‡çœŒ',
    'å²é˜œçœŒ','é™å²¡çœŒ','æ„›çŸ¥çœŒ','ä¸‰é‡çœŒ',
    'æ»‹è³€çœŒ','äº¬éƒ½åºœ','å¤§é˜ªåºœ','å…µåº«çœŒ','å¥ˆè‰¯çœŒ','å’Œæ­Œå±±çœŒ',
    'é³¥å–çœŒ','å³¶æ ¹çœŒ','å²¡å±±çœŒ','åºƒå³¶çœŒ','å±±å£çœŒ',
    'å¾³å³¶çœŒ','é¦™å·çœŒ','æ„›åª›çœŒ','é«˜çŸ¥çœŒ',
    'ç¦å²¡çœŒ','ä½è³€çœŒ','é•·å´çœŒ','ç†Šæœ¬çœŒ','å¤§åˆ†çœŒ','å®®å´çœŒ','é¹¿å…å³¶çœŒ','æ²–ç¸„çœŒ'];
  for (var i = 0; i < prefs.length; i++) {
    if (text.indexOf(prefs[i]) === 0) return prefs[i];
  }
  for (var j = 0; j < prefs.length; j++) {
    var sh = prefs[j].replace(/[éƒ½åºœçœŒ]$/, '');
    if (text.indexOf(sh) === 0) return prefs[j];
  }
  return null;
}

// ä½æ‰€å…¥åŠ›ã§é€æ–™ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
document.addEventListener('input', function(e) {
  if (e.target.id === 'address') updateCart();
});

// =====================================================
// éƒµä¾¿ç•ªå·â†’ä½æ‰€è‡ªå‹•å…¥åŠ›
// =====================================================
var postalTimer = null;
function onPostalInput() {
  clearTimeout(postalTimer);
  var val = this.value.replace(/[^0-9]/g, '');
  if (val.length === 7) {
    postalTimer = setTimeout(function() {
      fetch('https://zipcloud.ibsnet.co.jp/api/search?zipcode=' + val)
        .then(function(r) { return r.json(); })
        .then(function(j) {
          if (j.results && j.results[0]) {
            var r = j.results[0];
            document.getElementById('address').value = r.address1 + r.address2 + r.address3;
            updateCart();
          }
        })
        .catch(function() {});
    }, 300);
  }
}

// =====================================================
// ã‚¯ãƒ¼ãƒãƒ³é©ç”¨
// =====================================================
function applyCoupon() {
  var code = document.getElementById('couponInput').value.trim();
  var resEl = document.getElementById('couponResult');
  if (!code) { resEl.className = 'coupon-result err'; resEl.textContent = 'ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'; return; }

  var btn = document.getElementById('couponBtn');
  if (btn) { btn.disabled = true; btn.textContent = 'ç¢ºèªä¸­...'; }
  resEl.className = 'coupon-result';
  resEl.textContent = '';

  function restoreBtn_() {
    if (btn) { btn.disabled = false; btn.textContent = 'é©ç”¨'; }
  }

  var email = document.getElementById('contact').value.trim();
  var companyName = document.getElementById('companyName').value.trim();
  var subtotal = calcSubtotal();

  runApi('apiValidateCoupon', code, email, subtotal, 'bulk', Object.keys(G.cart), companyName)
    .then(function(r) {
      if (r && r.ok) {
        G.coupon = r;
        resEl.className = 'coupon-result ok';
        resEl.textContent = r.label + ' ãŒé©ç”¨ã•ã‚Œã¾ã—ãŸ';
        updateCart();
      } else {
        G.coupon = null;
        resEl.className = 'coupon-result err';
        resEl.textContent = r && r.message ? r.message : 'ã‚¯ãƒ¼ãƒãƒ³ãŒç„¡åŠ¹ã§ã™';
        // å…¥åŠ›æ¬„ã¯ã‚¯ãƒªã‚¢ã›ãšã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¦å†å…¥åŠ›å¯èƒ½ã«ã™ã‚‹
        document.getElementById('couponInput').value = '';
        updateCart();
      }
      restoreBtn_();
    })
    .catch(function(e) {
      resEl.className = 'coupon-result err';
      resEl.textContent = e && e.message ? e.message : 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
      restoreBtn_();
    });
}

function calcSubtotal() {
  var productMap = {};
  G.products.forEach(function(p) { productMap[p.productId] = p; });
  var sum = 0;
  Object.keys(G.cart).forEach(function(pid) {
    var p = productMap[pid];
    if (p) {
      var unitPrice = (p.discountedPrice !== undefined) ? p.discountedPrice : p.price;
      sum += unitPrice * G.cart[pid];
    }
  });
  return sum;
}

// =====================================================
// æ³¨æ–‡é€ä¿¡
// =====================================================
function submitOrder() {
  if (G.submitting) return;

  var errEl = document.getElementById('formError');
  errEl.style.display = 'none';

  var companyName = document.getElementById('companyName').value.trim();
  var contact = document.getElementById('contact').value.trim();
  var postal = document.getElementById('postal').value.trim();
  var address = document.getElementById('address').value.trim();
  var building = document.getElementById('building').value.trim();
  var phone = document.getElementById('phone').value.trim();
  var note = document.getElementById('note').value.trim();

  if (!companyName || !contact || !postal || !address || !phone) {
    errEl.textContent = 'å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
    errEl.style.display = 'block';
    return;
  }

  var fullAddress = address + (building ? ' ' + building : '');

  var items = [];
  Object.keys(G.cart).forEach(function(pid) {
    items.push({ productId: pid, qty: G.cart[pid] });
  });
  if (items.length === 0) return;

  var totalQty = 0;
  items.forEach(function(it) { totalQty += it.qty; });
  var shipping = calcEffectiveShipping_();

  // ãƒ‡ã‚¿ã‚¦ãƒªã‚«ãƒ¼ãƒˆã®é‡‘é¡ã‚‚å«ã‚ã‚‹ï¼ˆä¸¡ãƒãƒ£ãƒãƒ«åˆç®—æ±ºæ¸ˆï¼‰
  var detauriProductAmount = G.detauriCartTotal || 0;
  var detauriShippingAmount = G.detauriShipping || 0;
  var detauriItemCount = G.detauriCartCount || 0;

  var form = {
    companyName: companyName,
    contact: contact,
    postal: postal,
    address: fullAddress,
    phone: phone,
    note: note,
    couponCode: G.coupon ? document.getElementById('couponInput').value.trim() : '',
    shippingAmount: shipping,
    shippingSize: G.shippingSize,
    shippingPref: G.shippingPref,
    detauriProductAmount: detauriProductAmount,
    detauriShipping: detauriShippingAmount,
    detauriItemCount: detauriItemCount
  };

  G.submitting = true;
  var btn = document.getElementById('payButton');
  btn.disabled = true;
  btn.textContent = 'å‡¦ç†ä¸­...';

  runApi('apiBulkSubmit', form, items)
    .then(function(r) {
      G.submitting = false;
      if (r && r.ok && r.sessionUrl) {
        window.location.href = r.sessionUrl;
      } else {
        btn.disabled = false;
        updateCart();
        errEl.textContent = r && r.message ? r.message : 'æ³¨æ–‡ã«å¤±æ•—ã—ã¾ã—ãŸ';
        errEl.style.display = 'block';
      }
    })
    .catch(function(e) {
      G.submitting = false;
      btn.disabled = false;
      updateCart();
      errEl.textContent = e && e.message ? e.message : 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
      errEl.style.display = 'block';
    });
}

// =====================================================
// ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
// =====================================================
// =====================================================
// ã‚¯ãƒ¼ãƒãƒ³å†æ¤œè¨¼ï¼ˆã‚«ãƒ¼ãƒˆå¤‰æ›´æ™‚ï¼‰
// =====================================================
function revalidateCoupon() {
  if (!G.coupon) return;
  var code = document.getElementById('couponInput').value.trim();
  if (!code) { resetCouponUi_(); updateCart(); return; }

  var cartKeys = Object.keys(G.cart);
  if (cartKeys.length === 0) {
    // ã‚«ãƒ¼ãƒˆãŒç©ºã«ãªã£ãŸã‚‰ã‚¯ãƒ¼ãƒãƒ³ã‚’ã‚¯ãƒªã‚¢
    resetCouponUi_();
    updateCart();
    return;
  }

  var email = document.getElementById('contact').value.trim();
  var companyName = document.getElementById('companyName').value.trim();
  var subtotal = calcSubtotal();

  runApi('apiValidateCoupon', code, email, subtotal, 'bulk', cartKeys, companyName)
    .then(function(r) {
      if (r && r.ok) {
        G.coupon = r;
        var resEl = document.getElementById('couponResult');
        resEl.className = 'coupon-result ok';
        resEl.textContent = r.label + ' ãŒé©ç”¨ã•ã‚Œã¾ã—ãŸ';
      } else {
        resetCouponUi_();
      }
      updateCart();
    })
    .catch(function() {
      // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚¯ãƒ¼ãƒãƒ³ã‚’ç¶­æŒ
    });
}

function resetCouponUi_() {
  G.coupon = null;
  var input = document.getElementById('couponInput');
  if (input) { input.value = ''; }
  var resEl = document.getElementById('couponResult');
  if (resEl) { resEl.className = 'coupon-result'; resEl.textContent = ''; }
}

// =====================================================
// ä¼šå“¡ã‚»ãƒƒã‚·ãƒ§ãƒ³å…±æœ‰
// =====================================================
function loadSharedSession() {
  try {
    var raw = localStorage.getItem(SESSION_KEY);
    if (!raw) return;
    var saved = JSON.parse(raw);
    if (!saved || !saved.sessionId) return;

    // å³æ™‚åæ˜ : localStorageã®ãƒ‡ãƒ¼ã‚¿ã§å…ˆã«UIæ›´æ–°
    if (saved.customer) {
      G.sessionId = saved.sessionId;
      G.customer = saved.customer;
      autoFillCustomerForm();
      updateAuthUi_();
      updateCart();
    }

    // ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¤œè¨¼
    runApi('apiValidateSession', 'bulk', { sessionId: saved.sessionId })
      .then(function(r) {
        if (r && r.ok && r.data && r.data.customer) {
          G.sessionId = saved.sessionId;
          G.customer = r.data.customer;
          autoFillCustomerForm();
          updateAuthUi_();
          updateCart();
        } else {
          // ã‚»ãƒƒã‚·ãƒ§ãƒ³ç„¡åŠ¹ â†’ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
          G.sessionId = null;
          G.customer = null;
          updateAuthUi_();
          updateCart();
        }
      })
      .catch(function() {
        // æ¤œè¨¼å¤±æ•—æ™‚ã¯localStorageã®ãƒ‡ãƒ¼ã‚¿ã‚’ç¶­æŒ
      });
  } catch (e) {}
}

function autoFillCustomerForm() {
  if (!G.customer) return;
  var fields = [
    ['companyName', G.customer.companyName],
    ['contact', G.customer.email],
    ['phone', G.customer.phone],
    ['postal', G.customer.postal],
    ['address', G.customer.address]
  ];
  fields.forEach(function(f) {
    var el = document.getElementById(f[0]);
    if (el && !el.value && f[1]) {
      el.value = f[1];
    }
  });
  // ä½æ‰€ãŒå…¥åŠ›ã•ã‚ŒãŸã‚‰é€æ–™ã‚’å†è¨ˆç®—
  if (G.customer.address) updateCart();
}

function updateMemberUI() {
  if (!G.customer) return;
  var wrap = document.querySelector('.header-auth-wrap');
  if (!wrap) return;
  // æ—¢å­˜ãƒãƒƒã‚¸ãŒã‚ã‚Œã°å‰Šé™¤
  var old = document.getElementById('memberBadge');
  if (old) old.remove();
  var badge = document.createElement('div');
  badge.id = 'memberBadge';
  badge.className = 'member-badge';
  var md = G.settings.memberDiscount;
  var discountText = (md && md.enabled) ? ' ãƒ» ä¼šå“¡å‰²å¼•' + Math.round(md.rate * 100) + '%OFFé©ç”¨ä¸­' : '';
  badge.textContent = 'ä¼šå“¡ãƒ­ã‚°ã‚¤ãƒ³ä¸­: ' + (G.customer.companyName || G.customer.email) + discountText;
  wrap.appendChild(badge);
}

// =====================================================
// ã‚«ãƒ¼ãƒˆæ°¸ç¶šåŒ– (localStorage)
// =====================================================
function saveBulkCart() {
  try {
    var subtotal = calcSubtotal();
    var totalQty = 0;
    Object.keys(G.cart).forEach(function(pid) { totalQty += G.cart[pid]; });
    var shipping = calcEffectiveShipping_();
    var items = Object.keys(G.cart).map(function(pid) {
      var p = G.products.find(function(x) { return x.productId === pid; });
      var uPrice = p ? ((p.discountedPrice !== undefined) ? p.discountedPrice : p.price) : 0;
      var stockLimit = p ? (p.stock !== -1 && p.stock < p.maxQty ? p.stock : p.maxQty) : 1;
      return { id: pid, name: p ? p.name : pid, qty: G.cart[pid], unitPrice: uPrice, maxQty: stockLimit };
    });
    localStorage.setItem(BULK_CART_KEY, JSON.stringify({
      cart: G.cart,
      subtotal: subtotal,
      totalQty: totalQty,
      shipping: shipping,
      items: items
    }));
  } catch (e) {}
}

function loadBulkCart() {
  try {
    var raw = localStorage.getItem(BULK_CART_KEY);
    if (!raw) return {};
    var j = JSON.parse(raw);
    return j.cart || {};
  } catch (e) { return {}; }
}

function loadDetauriCart() {
  try {
    var raw = localStorage.getItem(DETAURI_CART_KEY);
    if (!raw) { G.detauriItems = []; return; }
    var j = JSON.parse(raw);
    var ids = Array.isArray(j.ids) ? j.ids : [];
    var itemsById = j.itemsById || {};
    G.detauriItems = ids.map(function(id) { return { id: id, item: itemsById[id] || {} }; });
    var sum = 0;
    for (var i = 0; i < ids.length; i++) {
      var it = itemsById[ids[i]];
      if (it) sum += Number(it.price || 0);
    }
    G.detauriCartTotal = sum;
    G.detauriCartCount = ids.length;
    G.detauriShipping = Number(j.shipping || 0);
    G.detauriShippingLabel = j.shippingLabel || '';
    G.detauriShippingPref = j.shippingPref || '';
    G.detauriShippingSizeLabel = j.shippingSizeLabel || '';
  } catch (e) { G.detauriItems = []; }
}

// =====================================================
// ãƒ‡ã‚¿ã‚¦ãƒªã‚«ãƒ¼ãƒˆã‚¢ã‚¤ãƒ†ãƒ å‰Šé™¤ï¼ˆã‚¢ã‚½ãƒ¼ãƒˆãƒšãƒ¼ã‚¸ã‹ã‚‰ã®æ“ä½œï¼‰
// =====================================================
function deleteDetauriItem_(id) {
  try {
    var raw = localStorage.getItem(DETAURI_CART_KEY);
    if (!raw) return;
    var j = JSON.parse(raw);
    var idx = (j.ids || []).indexOf(id);
    if (idx !== -1) j.ids.splice(idx, 1);
    if (j.itemsById) delete j.itemsById[id];
    localStorage.setItem(DETAURI_CART_KEY, JSON.stringify(j));
    loadDetauriCart();
    updateCart();
  } catch (e) {}
}

// =====================================================
// ã‚«ãƒ¼ãƒˆã‚¯ãƒªã‚¢
// =====================================================
function clearBulkCartOnly() {
  if (!confirm('ã‚¢ã‚½ãƒ¼ãƒˆã‚«ãƒ¼ãƒˆã‚’ç©ºã«ã—ã¾ã™ã‹ï¼Ÿ')) return;
  G.cart = {};
  resetCouponUi_();
  saveBulkCart();
  updateCart();
}

function clearDetauriCartOnly() {
  if (!confirm('ãƒ‡ã‚¿ã‚¦ãƒªã‚«ãƒ¼ãƒˆã‚’ç©ºã«ã—ã¾ã™ã‹ï¼Ÿ')) return;
  try { localStorage.removeItem(DETAURI_CART_KEY); } catch (e) {}
  G.detauriCartTotal = 0;
  G.detauriCartCount = 0;
  G.detauriShipping = 0;
  G.detauriShippingLabel = '';
  G.detauriShippingPref = '';
  G.detauriShippingSizeLabel = '';
  updateCart();
}

function clearAllCarts() {
  if (!confirm('ã™ã¹ã¦ã®ã‚«ãƒ¼ãƒˆã‚’ç©ºã«ã—ã¾ã™ã‹ï¼Ÿ')) return;
  G.cart = {};
  resetCouponUi_();
  saveBulkCart();
  try { localStorage.removeItem(DETAURI_CART_KEY); } catch (e) {}
  G.detauriCartTotal = 0;
  G.detauriCartCount = 0;
  G.detauriShipping = 0;
  G.detauriShippingLabel = '';
  G.detauriShippingPref = '';
  G.detauriShippingSizeLabel = '';
  updateCart();
  renderProducts();
}

function updateCartClearBtns_() {
  var wrap = document.getElementById('cartClearBtns');
  if (!wrap) return;
  var hasBulk = Object.keys(G.cart).length > 0;
  var hasDetauri = G.detauriCartCount > 0;
  if (!hasBulk && !hasDetauri) { wrap.style.display = 'none'; return; }
  wrap.style.display = 'flex';
  var btns = '';
  if (hasBulk) btns += '<button type="button" onclick="clearBulkCartOnly()" style="font-size:10px;padding:3px 8px;border:1px solid #ccc;border-radius:6px;background:#fff;cursor:pointer;white-space:nowrap;">ã‚¢ã‚½ãƒ¼ãƒˆç©º</button>';
  if (hasDetauri) btns += '<button type="button" onclick="clearDetauriCartOnly()" style="font-size:10px;padding:3px 8px;border:1px solid #ccc;border-radius:6px;background:#fff;cursor:pointer;white-space:nowrap;">ãƒ‡ã‚¿ã‚¦ãƒªç©º</button>';
  if (hasBulk && hasDetauri) btns += '<button type="button" onclick="clearAllCarts()" style="font-size:10px;padding:3px 8px;border:1px solid #e74c3c;border-radius:6px;background:#fff;color:#e74c3c;cursor:pointer;white-space:nowrap;">ã™ã¹ã¦ç©º</button>';
  wrap.innerHTML = btns;
}

// ESCã‚­ãƒ¼ã§ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') closeModal();
});

function escHtml(s) { var d = document.createElement('div'); d.textContent = s; return d.innerHTML; }
function escAttr(s) { return String(s).replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#39;').replace(/</g,'&lt;'); }
function numFmt(n) { return String(Math.round(n)).replace(/\B(?=(\d{3})+(?!\d))/g, ','); }

// =====================================================
// ä½æ‰€å…±æœ‰ï¼ˆlocalStorageçµŒç”±ã§ä¸¡ãƒšãƒ¼ã‚¸é–“ã§å…±æœ‰ï¼‰
// =====================================================
var SHARED_ADDRESS_KEY = 'shared_address_v1';

function saveSharedAddress_() {
  try {
    var data = {
      companyName: (document.getElementById('companyName').value || '').trim(),
      contact: (document.getElementById('contact').value || '').trim(),
      postal: (document.getElementById('postal').value || '').trim(),
      address: (document.getElementById('address').value || '').trim(),
      building: (document.getElementById('building').value || '').trim(),
      phone: (document.getElementById('phone').value || '').trim(),
      note: (document.getElementById('note').value || '').trim(),
      ts: Date.now()
    };
    localStorage.setItem(SHARED_ADDRESS_KEY, JSON.stringify(data));
  } catch (e) {}
}

function loadSharedAddress_() {
  try {
    var raw = localStorage.getItem(SHARED_ADDRESS_KEY);
    if (!raw) return;
    var data = JSON.parse(raw);
    if (!data || !data.ts) return;
    var fields = ['companyName', 'contact', 'postal', 'address', 'building', 'phone', 'note'];
    for (var i = 0; i < fields.length; i++) {
      var el = document.getElementById(fields[i]);
      if (el && data[fields[i]]) el.value = data[fields[i]];
    }
    if (data.address) updateCart();
  } catch (e) {}
}

// ãƒ•ã‚©ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å…¥åŠ›æ™‚ã«å…±æœ‰ä½æ‰€ã‚’ä¿å­˜
(function() {
  var fields = ['companyName', 'contact', 'postal', 'address', 'building', 'phone', 'note'];
  for (var i = 0; i < fields.length; i++) {
    var el = document.getElementById(fields[i]);
    if (el) {
      el.addEventListener('input', saveSharedAddress_);
    }
  }
})();

// ä»–ã‚¿ãƒ–ã§ã®ä½æ‰€å¤‰æ›´ãƒ»ãƒ‡ã‚¿ã‚¦ãƒªã‚«ãƒ¼ãƒˆå¤‰æ›´ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åæ˜ 
window.addEventListener('storage', function(e) {
  if (e.key === SHARED_ADDRESS_KEY && e.newValue) {
    try {
      var data = JSON.parse(e.newValue);
      if (!data || !data.ts) return;
      var fields = ['companyName', 'contact', 'postal', 'address', 'building', 'phone', 'note'];
      for (var i = 0; i < fields.length; i++) {
        var el = document.getElementById(fields[i]);
        if (el && data[fields[i]] !== undefined) el.value = data[fields[i]];
      }
      if (data.address) updateCart();
    } catch (e) {}
  }
  if (e.key === DETAURI_CART_KEY) {
    loadDetauriCart();
    updateCart();
  }
});

// =====================================================
// èªè¨¼UI
// =====================================================
function togglePw(btn) {
  var input = btn.previousElementSibling;
  if (input.type === 'password') { input.type = 'text'; btn.textContent = '\u{1F441}\u{FE0F}\u200D\u{1F5E8}\u{FE0F}'; }
  else { input.type = 'password'; btn.textContent = '\u{1F441}'; }
}

function openAuthModal_(mode) {
  var overlay = document.getElementById('authOverlay');
  if (!overlay) return;
  document.getElementById('loginForm').style.display = 'none';
  document.getElementById('registerForm').style.display = 'none';
  document.getElementById('forgotPwForm').style.display = 'none';
  document.getElementById('forgotEmailForm').style.display = 'none';
  var errEl = document.getElementById('authError');
  if (errEl) errEl.style.display = 'none';
  var recoverResult = document.getElementById('recoverEmailResult');
  if (recoverResult) recoverResult.style.display = 'none';

  if (mode === 'register') {
    document.getElementById('authModalTitle').textContent = 'æ–°è¦ç™»éŒ²';
    document.getElementById('registerForm').style.display = '';
  } else if (mode === 'forgotPassword') {
    document.getElementById('authModalTitle').textContent = 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãŠå¿˜ã‚Œã®æ–¹';
    document.getElementById('forgotPwForm').style.display = '';
  } else if (mode === 'forgotEmail') {
    document.getElementById('authModalTitle').textContent = 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ãŠå¿˜ã‚Œã®æ–¹';
    document.getElementById('forgotEmailForm').style.display = '';
  } else {
    document.getElementById('authModalTitle').textContent = 'ãƒ­ã‚°ã‚¤ãƒ³';
    document.getElementById('loginForm').style.display = '';
  }
  overlay.classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closeAuthModal_() {
  var overlay = document.getElementById('authOverlay');
  if (overlay) overlay.classList.remove('active');
  document.body.style.overflow = '';
}

function showAuthError_(msg) {
  var el = document.getElementById('authError');
  if (el) { el.textContent = msg; el.style.display = 'block'; }
}

function updateAuthUi_() {
  var area = document.getElementById('headerAuth');
  if (!area) return;

  // ãƒ—ãƒ­ãƒ¢ãƒãƒŠãƒ¼ã®è¡¨ç¤ºåˆ¶å¾¡
  var banner = document.getElementById('promoBanner');
  if (banner) {
    var dismissed = false;
    try { dismissed = sessionStorage.getItem('promoBannerDismissed') === '1'; } catch (e) {}
    var md = G.settings.memberDiscount;
    if (G.customer || dismissed || !(md && md.enabled)) {
      banner.style.display = 'none';
    } else {
      banner.style.display = 'block';
    }
    adjustHeaderForBanner_();
  }

  var cartBtnHtml = '<button class="auth-btn cart-header-btn" id="headerCartBtn" type="button" title="ã‚«ãƒ¼ãƒˆ">&#x1F6D2;</button>';

  if (G.customer) {
    var md = G.settings.memberDiscount;
    var discountHtml = (md && md.enabled) ? '<span class="auth-discount">' + Math.round(md.rate * 100) + '%OFF</span>' : '';
    var pointsHtml = (G.customer.points > 0) ? '<span class="auth-points">' + G.customer.points + 'pt</span>' : '';
    var rankHtml = '';
    if (G.customer.rank && G.customer.rank.name) {
      rankHtml = '<span style="background:' + safeColor_(G.customer.rank.color) + ';color:#fff;font-size:10px;padding:2px 6px;border-radius:4px;font-weight:700;">' + escHtml(G.customer.rank.name) + '</span>';
    }
    area.innerHTML = cartBtnHtml +
      '<div class="auth-user">' +
        '<span class="auth-user-name">' + escHtml(G.customer.companyName || G.customer.email) + '</span>' +
        rankHtml + discountHtml + pointsHtml +
      '</div>' +
      '<button class="auth-btn mypage" id="openMyPageBtn" type="button">ãƒã‚¤ãƒšãƒ¼ã‚¸</button>' +
      '<button class="auth-btn logout" id="logoutBtn" type="button">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>';
    var openMyPageBtn = document.getElementById('openMyPageBtn');
    if (openMyPageBtn) {
      openMyPageBtn.addEventListener('click', function() { openMyPage_(); });
    }
    var logoutBtn = document.getElementById('logoutBtn');
    if (logoutBtn) {
      logoutBtn.addEventListener('click', function() { doLogout_(); });
    }
    // memberBadgeã‚‚æ›´æ–°
    updateMemberUI();
  } else {
    area.innerHTML = cartBtnHtml + '<button class="auth-btn" id="openAuthBtn" type="button">ãƒ­ã‚°ã‚¤ãƒ³ / æ–°è¦ç™»éŒ²</button>';
    var openBtn = document.getElementById('openAuthBtn');
    if (openBtn) {
      openBtn.addEventListener('click', function() { openAuthModal_('login'); });
    }
    // memberBadgeãŒã‚ã‚Œã°å‰Šé™¤
    var old = document.getElementById('memberBadge');
    if (old) old.remove();
  }

  // ã‚«ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ
  var headerCart = document.getElementById('headerCartBtn');
  if (headerCart) {
    headerCart.addEventListener('click', function() {
      var cs = document.getElementById('cartSection');
      if (cs) cs.scrollIntoView({ behavior: 'smooth' });
    });
  }

  // ãƒ¢ãƒã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼: ã‚«ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’header-row1ã«é…ç½®
  var mobCartArea = document.getElementById('headerCartMob');
  if (mobCartArea) {
    mobCartArea.innerHTML = '<button class="auth-btn cart-header-btn" id="headerCartBtnMob" type="button" title="ã‚«ãƒ¼ãƒˆ">&#x1F6D2;</button>';
    var mobCartBtn = document.getElementById('headerCartBtnMob');
    if (mobCartBtn) {
      mobCartBtn.addEventListener('click', function() {
        var cs = document.getElementById('cartSection');
        if (cs) cs.scrollIntoView({ behavior: 'smooth' });
      });
    }
  }

  // ãƒ¢ãƒã‚¤ãƒ«èªè¨¼ã‚¨ãƒªã‚¢ã«ãƒŸãƒ©ãƒ¼ã‚³ãƒ”ãƒ¼ï¼ˆã‚«ãƒ¼ãƒˆãƒœã‚¿ãƒ³ãªã—ï¼‰
  var mobArea = document.getElementById('headerAuthMob');
  if (mobArea) {
    // ã‚«ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’é™¤å¤–ã—ãŸHTMLã‚’ã‚³ãƒ”ãƒ¼
    var tempDiv = document.createElement('div');
    tempDiv.innerHTML = area.innerHTML;
    var cartInMob = tempDiv.querySelector('.cart-header-btn');
    if (cartInMob) cartInMob.remove();
    mobArea.innerHTML = tempDiv.innerHTML;
    var mobMyPage = mobArea.querySelector('#openMyPageBtn');
    if (mobMyPage) {
      mobMyPage.id = 'openMyPageBtnMob';
      mobMyPage.addEventListener('click', function() { openMyPage_(); });
    }
    var mobLogout = mobArea.querySelector('#logoutBtn');
    if (mobLogout) {
      mobLogout.id = 'logoutBtnMob';
      mobLogout.addEventListener('click', function() { doLogout_(); });
    }
    var mobAuth = mobArea.querySelector('#openAuthBtn');
    if (mobAuth) {
      mobAuth.id = 'openAuthBtnMob';
      mobAuth.addEventListener('click', function() { openAuthModal_('login'); });
    }
  }
}

function doLogin_() {
  var email = (document.getElementById('loginEmail').value || '').trim();
  var password = document.getElementById('loginPassword').value || '';
  var rememberMe = document.getElementById('rememberMe') ? document.getElementById('rememberMe').checked : false;

  if (!email || !password) { showAuthError_('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }

  var btn = document.getElementById('loginBtn');
  btn.disabled = true; btn.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³ä¸­...';

  runApi('apiLoginCustomer', 'bulk', { email: email, password: password, rememberMe: rememberMe })
    .then(function(res) {
      btn.disabled = false; btn.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³';
      if (res.ok && res.data) {
        G.sessionId = res.data.sessionId;
        G.customer = res.data.customer;
        try {
          localStorage.setItem(SESSION_KEY, JSON.stringify({ sessionId: res.data.sessionId, customer: res.data.customer }));
        } catch (e) {}
        updateAuthUi_();
        closeAuthModal_();
        autoFillCustomerForm();
        updateCart();
      } else {
        showAuthError_(res.message || 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    })
    .catch(function(e) {
      btn.disabled = false; btn.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³';
      showAuthError_('ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ');
    });
}

function doRegister_() {
  var email = (document.getElementById('regEmail').value || '').trim();
  var password = document.getElementById('regPassword').value || '';
  var companyName = (document.getElementById('regCompanyName').value || '').trim();
  var phone = (document.getElementById('regPhone').value || '').trim();
  var postal = (document.getElementById('regPostal').value || '').trim();
  var address = (document.getElementById('regAddress').value || '').trim();
  var newsletter = document.getElementById('regNewsletter').checked;

  if (!email || !email.includes('@')) { showAuthError_('æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
  if (!password || password.length < 6) { showAuthError_('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯6æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
  if (!companyName) { showAuthError_('ä¼šç¤¾å/æ°åã¯å¿…é ˆã§ã™'); return; }

  var btn = document.getElementById('registerBtn');
  btn.disabled = true; btn.textContent = 'ç™»éŒ²ä¸­...';

  runApi('apiRegisterCustomer', 'bulk', {
    email: email, password: password, companyName: companyName,
    phone: phone, postal: postal, address: address, newsletter: newsletter
  })
    .then(function(res) {
      btn.disabled = false; btn.textContent = 'ç™»éŒ²ã™ã‚‹';
      if (res.ok && res.data) {
        G.sessionId = res.data.sessionId;
        G.customer = res.data.customer;
        try {
          localStorage.setItem(SESSION_KEY, JSON.stringify({ sessionId: res.data.sessionId, customer: res.data.customer }));
        } catch (e) {}
        updateAuthUi_();
        closeAuthModal_();
        autoFillCustomerForm();
        updateCart();
        var md = G.settings.memberDiscount;
        alert((md && md.enabled) ? 'ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼' + Math.round(md.rate * 100) + '%å‰²å¼•ãŒé©ç”¨ã•ã‚Œã¾ã™' : 'ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼');
      } else {
        showAuthError_(res.message || 'ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    })
    .catch(function(e) {
      btn.disabled = false; btn.textContent = 'ç™»éŒ²ã™ã‚‹';
      showAuthError_('ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ');
    });
}

function doLogout_() {
  var saved = null;
  try {
    var raw = localStorage.getItem(SESSION_KEY);
    if (raw) saved = JSON.parse(raw);
  } catch (e) {}

  G.sessionId = null;
  G.customer = null;
  try { localStorage.removeItem(SESSION_KEY); } catch (e) {}
  updateAuthUi_();
  updateCart();

  if (saved && saved.sessionId) {
    runApi('apiLogoutCustomer', 'bulk', { sessionId: saved.sessionId }).catch(function() {});
  }
}

// =====================================================
// ãƒã‚¤ãƒšãƒ¼ã‚¸
// =====================================================
function safeColor_(c) { return /^#[0-9a-fA-F]{3,8}$/.test(c) ? c : '#64748b'; }
function showToast(msg) {
  var el = document.createElement('div');
  el.textContent = msg;
  el.style.cssText = 'position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:10px 20px;border-radius:8px;font-size:13px;z-index:9999;opacity:0;transition:opacity .3s;';
  document.body.appendChild(el);
  requestAnimationFrame(function() { el.style.opacity = '1'; });
  setTimeout(function() { el.style.opacity = '0'; setTimeout(function() { el.remove(); }, 300); }, 2500);
}

function openMyPage_() {
  var modal = document.getElementById('myPageModal');
  var overlay = document.getElementById('myPageOverlay');
  if (!modal) return;

  // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã§å³æ™‚è¡¨ç¤º
  if (G.customer) {
    document.getElementById('mpEmail').value = G.customer.email || '';
    document.getElementById('mpCompanyName').value = G.customer.companyName || '';
    document.getElementById('mpPhone').value = String(G.customer.phone || '').replace(/^'/, '');
    document.getElementById('mpPostal').value = String(G.customer.postal || '').replace(/^'/, '');
    document.getElementById('mpAddress').value = G.customer.address || '';
    document.getElementById('mpPointBalance').textContent = String(G.customer.points || 0);
  }

  openBulkModal_(modal, overlay);
  loadMyPage_();
}

function loadMyPage_() {
  if (!G.sessionId) return;
  var orderList = document.getElementById('mpOrderList');
  if (orderList) orderList.innerHTML = '<div style="text-align:center;padding:20px;color:#999;">èª­ã¿è¾¼ã¿ä¸­...</div>';

  runApi('apiGetMyPage', 'bulk', { sessionId: G.sessionId })
    .then(function(res) {
      if (!res || !res.ok || !res.data) {
        showToast((res && res.message) || 'ãƒã‚¤ãƒšãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
        return;
      }
      var d = res.data;
      // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«
      document.getElementById('mpEmail').value = d.profile.email || '';
      document.getElementById('mpCompanyName').value = d.profile.companyName || '';
      document.getElementById('mpPhone').value = d.profile.phone || '';
      document.getElementById('mpPostal').value = d.profile.postal || '';
      document.getElementById('mpAddress').value = d.profile.address || '';
      document.getElementById('mpRegisteredAt').textContent = d.profile.registeredAt || '-';
      // ãƒã‚¤ãƒ³ãƒˆ
      document.getElementById('mpPointBalance').textContent = String(d.points || 0);
      if (G.customer) G.customer.points = d.points || 0;
      updateAuthUi_();
      // çµ±è¨ˆãƒ‡ãƒ¼ã‚¿
      if (d.stats) {
        document.getElementById('mpTotalOrders').textContent = String(d.stats.totalOrders || 0) + 'å›';
        document.getElementById('mpTotalItems').textContent = String(d.stats.totalItems || 0) + 'ç‚¹';
      }
      // ãƒ©ãƒ³ã‚¯æƒ…å ±
      if (d.rank) {
        var r = d.rank;
        document.getElementById('mpTotalSpent').textContent = 'Â¥' + numFmt(r.annualSpent || 0);
        document.getElementById('mpMemberRank').innerHTML = '<span style="color:' + safeColor_(r.color) + ';">' + escHtml(r.name || 'ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼') + '</span>';
        var rankCard = document.getElementById('mpRankCard');
        if (rankCard) {
          var gradients = {
            'DIAMOND': 'linear-gradient(135deg,#006064,#00838f)',
            'GOLD': 'linear-gradient(135deg,#78350f,#b45309)',
            'SILVER': 'linear-gradient(135deg,#475569,#64748b)',
            'REGULAR': 'linear-gradient(135deg,#1e293b,#334155)'
          };
          rankCard.style.background = gradients[r.rank] || gradients['REGULAR'];
        }
        document.getElementById('mpRankName').textContent = r.name || 'ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼';
        document.getElementById('mpRankPointRate').textContent = 'ãƒã‚¤ãƒ³ãƒˆé‚„å…ƒç‡: ' + Math.round((r.pointRate || 0.01) * 100) + '%';
        var benefits = [];
        if (r.freeShipping) benefits.push('é€æ–™ç„¡æ–™');
        document.getElementById('mpRankBenefits').textContent = benefits.length > 0 ? 'ç‰¹å…¸: ' + benefits.join('ã€') : '';
        var progressEl = document.getElementById('mpRankProgress');
        if (progressEl && r.nextRank && r.nextThreshold > 0) {
          var pct = Math.min(100, Math.round((r.annualSpent / r.nextThreshold) * 100));
          progressEl.innerHTML = '<div style="font-size:11px;opacity:0.8;margin-bottom:4px;">æ¬¡ã®ãƒ©ãƒ³ã‚¯ï¼ˆ' + escHtml(r.nextRank) + 'ï¼‰ã¾ã§ã‚ã¨ Â¥' + numFmt(r.remaining || 0) + '</div>'
            + '<div style="background:rgba(255,255,255,0.2);border-radius:4px;height:6px;overflow:hidden;"><div style="background:#fff;height:100%;border-radius:4px;width:' + pct + '%;transition:width .5s;"></div></div>'
            + '<div style="font-size:10px;opacity:0.6;margin-top:2px;text-align:right;">Â¥' + numFmt(r.annualSpent) + ' / Â¥' + numFmt(r.nextThreshold) + '</div>';
        } else if (progressEl) {
          progressEl.innerHTML = '<div style="font-size:11px;opacity:0.8;">æœ€é«˜ãƒ©ãƒ³ã‚¯ã«åˆ°é”ã—ã¦ã„ã¾ã™</div>';
        }
        if (G.customer) G.customer.rank = r;
        updateAuthUi_();
      } else if (d.stats) {
        document.getElementById('mpTotalSpent').textContent = 'Â¥' + numFmt(d.stats.totalSpent || 0);
        var rank = getMemberRank_(d.stats.totalSpent || 0);
        document.getElementById('mpMemberRank').innerHTML = '<span style="color:' + safeColor_(rank.color) + ';">' + escHtml(rank.name) + '</span>';
      }
      // æ³¨æ–‡å±¥æ­´
      renderOrderHistory_(d.orders || []);
    })
    .catch(function() { showToast('ãƒã‚¤ãƒšãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ'); });
}

function getMemberRank_(totalSpent) {
  if (totalSpent >= 500000) return { name: 'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰', color: '#00bcd4', pointRate: 5, freeShipping: true };
  if (totalSpent >= 200000) return { name: 'ã‚´ãƒ¼ãƒ«ãƒ‰', color: '#f59e0b', pointRate: 5, freeShipping: false };
  if (totalSpent >= 50000) return { name: 'ã‚·ãƒ«ãƒãƒ¼', color: '#94a3b8', pointRate: 3, freeShipping: false };
  return { name: 'ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼', color: '#64748b', pointRate: 1, freeShipping: false };
}

function renderOrderHistory_(orders) {
  var el = document.getElementById('mpOrderList');
  if (!el) return;
  if (!orders || orders.length === 0) {
    el.innerHTML = '<div style="text-align:center;padding:30px;color:#999;">æ³¨æ–‡å±¥æ­´ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“</div>';
    return;
  }
  var html = '';
  for (var i = 0; i < orders.length; i++) {
    var o = orders[i];
    var statusClass = (o.status === 'å®Œäº†') ? 'done' : (o.status === 'ä¾é ¼ä¸­') ? 'active' : 'pending';
    var trackHtml = '';
    if (o.carrier && o.tracking) {
      trackHtml = '<div style="font-size:11px;color:#888;margin-top:4px;">é…é€: ' + escHtml(o.carrier) + ' ' + escHtml(o.tracking) + '</div>';
    }
    html += '<div class="mp-order-card">'
      + '<div class="mp-order-header">'
      + '<span class="mp-order-no">' + escHtml(o.receiptNo) + '</span>'
      + '<span class="mp-order-date">' + escHtml(o.date) + '</span>'
      + '<span class="mp-order-status ' + statusClass + '">' + escHtml(o.status) + '</span>'
      + '</div>'
      + '<div class="mp-order-products">' + escHtml(o.products) + '</div>'
      + '<div class="mp-order-footer">'
      + '<span>' + o.count + 'ç‚¹</span>'
      + '<span class="mp-order-total">Â¥' + numFmt(o.total) + '</span>'
      + '</div>'
      + trackHtml
      + '</div>';
  }
  el.innerHTML = html;
}

// =====================================================
// èªè¨¼UIã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
// =====================================================
(function() {
  // ãƒ¢ãƒ¼ãƒ€ãƒ«é–‹é–‰
  var openBtn = document.getElementById('openAuthBtn');
  if (openBtn) openBtn.addEventListener('click', function() { openAuthModal_('login'); });

  var closeBtn = document.getElementById('authCloseBtn');
  if (closeBtn) closeBtn.addEventListener('click', closeAuthModal_);

  // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
  var overlay = document.getElementById('authOverlay');
  if (overlay) overlay.addEventListener('click', function(e) { if (e.target === overlay) closeAuthModal_(); });

  // ãƒ­ã‚°ã‚¤ãƒ³/ç™»éŒ²ãƒœã‚¿ãƒ³
  var loginBtn = document.getElementById('loginBtn');
  if (loginBtn) loginBtn.addEventListener('click', doLogin_);

  var registerBtn = document.getElementById('registerBtn');
  if (registerBtn) registerBtn.addEventListener('click', doRegister_);

  // ãƒ•ã‚©ãƒ¼ãƒ åˆ‡ã‚Šæ›¿ãˆ
  var showReg = document.getElementById('showRegisterLink');
  if (showReg) showReg.addEventListener('click', function(e) { e.preventDefault(); openAuthModal_('register'); });

  var showLogin = document.getElementById('showLoginLink');
  if (showLogin) showLogin.addEventListener('click', function(e) { e.preventDefault(); openAuthModal_('login'); });

  var showForgotPw = document.getElementById('showForgotPwLink');
  if (showForgotPw) showForgotPw.addEventListener('click', function(e) { e.preventDefault(); openAuthModal_('forgotPassword'); });

  var showForgotEmail = document.getElementById('showForgotEmailLink');
  if (showForgotEmail) showForgotEmail.addEventListener('click', function(e) { e.preventDefault(); openAuthModal_('forgotEmail'); });

  // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ
  var resetPwBtn = document.getElementById('resetPwBtn');
  if (resetPwBtn) {
    resetPwBtn.addEventListener('click', function() {
      var email = (document.getElementById('resetEmail').value || '').trim();
      if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { showAuthError_('æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
      resetPwBtn.disabled = true; resetPwBtn.textContent = 'é€ä¿¡ä¸­...';
      runApi('apiRequestPasswordReset', 'bulk', { email: email })
        .then(function(res) {
          if (res && res.ok) { alert(res.message || 'ä»®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’é€ä¿¡ã—ã¾ã—ãŸ'); document.getElementById('resetEmail').value = ''; setTimeout(function() { openAuthModal_('login'); }, 500); }
          else { showAuthError_((res && res.message) || 'é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ'); }
        })
        .catch(function() { showAuthError_('é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ'); })
        .finally(function() { resetPwBtn.disabled = false; resetPwBtn.textContent = 'ä»®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’é€ä¿¡'; });
    });
  }

  var backFromReset = document.getElementById('backToLoginFromReset');
  if (backFromReset) backFromReset.addEventListener('click', function(e) { e.preventDefault(); openAuthModal_('login'); });

  // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ç¢ºèª
  var recoverBtn = document.getElementById('recoverEmailBtn');
  if (recoverBtn) {
    recoverBtn.addEventListener('click', function() {
      var cn = (document.getElementById('recoverCompanyName').value || '').trim();
      var ph = (document.getElementById('recoverPhone').value || '').trim();
      if (!cn) { showAuthError_('ä¼šç¤¾å/æ°åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
      if (!ph) { showAuthError_('é›»è©±ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
      recoverBtn.disabled = true; recoverBtn.textContent = 'ç¢ºèªä¸­...';
      var resultDiv = document.getElementById('recoverEmailResult');
      resultDiv.style.display = 'none';
      runApi('apiRecoverEmail', 'bulk', { companyName: cn, phone: ph })
        .then(function(res) {
          if (res && res.ok && res.data && res.data.maskedEmail) {
            resultDiv.innerHTML = 'ã”ç™»éŒ²ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:<br><strong style="font-size:16px;">' + escHtml(res.data.maskedEmail) + '</strong>';
            resultDiv.style.display = 'block';
          } else { showAuthError_((res && res.message) || 'ä¸€è‡´ã™ã‚‹æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ'); }
        })
        .catch(function() { showAuthError_('ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸ'); })
        .finally(function() { recoverBtn.disabled = false; recoverBtn.textContent = 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç¢ºèª'; });
    });
  }

  var backFromRecover = document.getElementById('backToLoginFromRecover');
  if (backFromRecover) backFromRecover.addEventListener('click', function(e) { e.preventDefault(); openAuthModal_('login'); });

  // ãƒã‚¤ãƒšãƒ¼ã‚¸ãƒ¢ãƒ¼ãƒ€ãƒ«
  var myPageCloseBtn = document.getElementById('myPageCloseBtn');
  if (myPageCloseBtn) myPageCloseBtn.addEventListener('click', function() { closeBulkModal_(document.getElementById('myPageModal'), document.getElementById('myPageOverlay')); });
  var myPageOverlay = document.getElementById('myPageOverlay');
  if (myPageOverlay) myPageOverlay.addEventListener('click', function() { closeBulkModal_(document.getElementById('myPageModal'), document.getElementById('myPageOverlay')); });

  // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
  var mpTabs = document.querySelectorAll('.mypage-tab');
  mpTabs.forEach(function(tab) {
    tab.addEventListener('click', function() {
      mpTabs.forEach(function(t) { t.classList.remove('active'); });
      tab.classList.add('active');
      var target = tab.getAttribute('data-tab');
      document.getElementById('mypageProfile').style.display = (target === 'profile') ? '' : 'none';
      document.getElementById('mypageOrders').style.display = (target === 'orders') ? '' : 'none';
      document.getElementById('mypagePoints').style.display = (target === 'points') ? '' : 'none';
    });
  });

  // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†
  var mpEditBtn = document.getElementById('mpEditBtn');
  var mpProfileFields = ['mpCompanyName', 'mpPhone', 'mpPostal', 'mpAddress'];
  function setProfileEditable_(editable) {
    for (var fi = 0; fi < mpProfileFields.length; fi++) {
      var inp = document.getElementById(mpProfileFields[fi]);
      if (inp) { inp.readOnly = !editable; inp.style.background = editable ? '#fff' : '#f5f5f5'; }
    }
    var eb = document.getElementById('mpEditBtn'); if (eb) eb.style.display = editable ? 'none' : '';
    var sb = document.getElementById('mpSaveBtn'); if (sb) sb.style.display = editable ? '' : 'none';
    var cb = document.getElementById('mpCancelEditBtn'); if (cb) cb.style.display = editable ? '' : 'none';
  }
  if (mpEditBtn) {
    mpEditBtn.addEventListener('click', function() {
      mpEditBtn._backup = {};
      for (var fi = 0; fi < mpProfileFields.length; fi++) {
        mpEditBtn._backup[mpProfileFields[fi]] = document.getElementById(mpProfileFields[fi]).value;
      }
      setProfileEditable_(true);
    });
  }
  var mpCancelEditBtn = document.getElementById('mpCancelEditBtn');
  if (mpCancelEditBtn) {
    mpCancelEditBtn.addEventListener('click', function() {
      if (mpEditBtn && mpEditBtn._backup) {
        for (var fi = 0; fi < mpProfileFields.length; fi++) {
          document.getElementById(mpProfileFields[fi]).value = mpEditBtn._backup[mpProfileFields[fi]] || '';
        }
      }
      setProfileEditable_(false);
    });
  }
  var mpSaveBtn = document.getElementById('mpSaveBtn');
  if (mpSaveBtn) {
    mpSaveBtn.addEventListener('click', function() {
      var pw = prompt('æœ¬äººç¢ºèªã®ãŸã‚ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      if (!pw) return;
      mpSaveBtn.disabled = true; mpSaveBtn.textContent = 'ä¿å­˜ä¸­...';
      runApi('apiUpdateCustomerProfile', 'bulk', {
        sessionId: G.sessionId,
        currentPassword: pw,
        companyName: document.getElementById('mpCompanyName').value,
        phone: document.getElementById('mpPhone').value,
        postal: document.getElementById('mpPostal').value,
        address: document.getElementById('mpAddress').value
      }).then(function(res) {
        if (res && res.ok) {
          showToast(res.message || 'æ›´æ–°ã—ã¾ã—ãŸ');
          if (G.customer) {
            G.customer.companyName = document.getElementById('mpCompanyName').value;
            G.customer.phone = document.getElementById('mpPhone').value;
            G.customer.postal = document.getElementById('mpPostal').value;
            G.customer.address = document.getElementById('mpAddress').value;
            try { localStorage.setItem(SESSION_KEY, JSON.stringify({ sessionId: G.sessionId, customer: G.customer })); } catch (e) {}
            updateAuthUi_();
          }
          setProfileEditable_(false);
        } else {
          showToast((res && res.message) || 'æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      }).catch(function() { showToast('æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ'); })
        .finally(function() { mpSaveBtn.disabled = false; mpSaveBtn.textContent = 'å¤‰æ›´ã‚’ä¿å­˜'; });
    });
  }
  var mpTogglePasswordBtn = document.getElementById('mpTogglePasswordBtn');
  if (mpTogglePasswordBtn) {
    mpTogglePasswordBtn.addEventListener('click', function() {
      var section = document.getElementById('mpPasswordSection');
      section.style.display = section.style.display === 'none' ? '' : 'none';
    });
  }
  var mpChangePassBtn = document.getElementById('mpChangePassBtn');
  if (mpChangePassBtn) {
    mpChangePassBtn.addEventListener('click', function() {
      var cur = document.getElementById('mpCurPass').value;
      var np = document.getElementById('mpNewPass').value;
      var npc = document.getElementById('mpNewPassConfirm').value;
      if (!cur) { showToast('ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
      if (!np || np.length < 6) { showToast('æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯6æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
      if (np !== npc) { showToast('æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“'); return; }
      mpChangePassBtn.disabled = true; mpChangePassBtn.textContent = 'å¤‰æ›´ä¸­...';
      runApi('apiChangePassword', 'bulk', {
        sessionId: G.sessionId,
        currentPassword: cur,
        newPassword: np
      }).then(function(res) {
        if (res && res.ok) {
          showToast(res.message || 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¾ã—ãŸ');
          document.getElementById('mpCurPass').value = '';
          document.getElementById('mpNewPass').value = '';
          document.getElementById('mpNewPassConfirm').value = '';
          document.getElementById('mpPasswordSection').style.display = 'none';
        } else {
          showToast((res && res.message) || 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      }).catch(function() { showToast('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸ'); })
        .finally(function() { mpChangePassBtn.disabled = false; mpChangePassBtn.textContent = 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´'; });
    });
  }

  // ãƒ—ãƒ­ãƒ¢ãƒãƒŠãƒ¼
  var promoClose = document.getElementById('promoClose');
  if (promoClose) {
    promoClose.addEventListener('click', function() {
      var b = document.getElementById('promoBanner');
      if (b) b.style.display = 'none';
      try { sessionStorage.setItem('promoBannerDismissed', '1'); } catch (e) {}
    });
  }
  var promoLink = document.getElementById('promoRegisterLink');
  if (promoLink) {
    promoLink.addEventListener('click', function(e) { e.preventDefault(); openAuthModal_('register'); });
  }

  // å…±æœ‰ä½æ‰€ã‚’èª­ã¿è¾¼ã¿ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³èª­ã¿è¾¼ã¿å¾Œã«å®Ÿè¡Œï¼‰
  setTimeout(function() {
    loadSharedAddress_();
    updateAuthUi_();
  }, 100);

  // ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰: ã‚°ãƒ­ãƒ¼ãƒãƒ« ADMIN_KEY ã‚’å‚ç…§
  if (ADMIN_KEY) {
    document.body.classList.add('admin-mode');
    var adminBar = document.getElementById('adminBar');
    if (adminBar) adminBar.style.display = 'block';
    var adminExit = document.getElementById('adminExit');
    if (adminExit) {
      adminExit.addEventListener('click', function() {
        if (confirm('ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰ã‚’è§£é™¤ã—ã¾ã™ã‹ï¼Ÿ\nå†åº¦ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ ?admin=xxx ã®URLãŒå¿…è¦ã§ã™ã€‚')) {
          try { localStorage.removeItem('_nk_owner_key'); } catch(e) {}
          location.reload();
        }
      });
    }

    // --- ç®¡ç†è¨­å®šãƒ‘ãƒãƒ« ---
    (function() {
      var fab = document.getElementById('adminSettingsFab');
      var panel = document.getElementById('settingsPanel');
      var closeBtn = document.getElementById('settingsClose');
      if (!fab || !panel) return;

      function showToast(msg) { alert(msg); }

      fab.addEventListener('click', function() {
        var isOpen = panel.classList.contains('open');
        if (isOpen) { panel.classList.remove('open'); return; }
        panel.classList.add('open');
        spLoadKomoju();
        spLoadDiscount();
      });
      if (closeBtn) closeBtn.addEventListener('click', function() { panel.classList.remove('open'); });

      function spLog(msg) {
        var el = document.getElementById('spLog');
        if (!el) return;
        el.style.display = 'block';
        el.textContent = (el.textContent ? el.textContent + '\n' : '') + msg;
        el.scrollTop = el.scrollHeight;
      }

      function spRunAdmin(fn, label) {
        spLog('å®Ÿè¡Œ: ' + label);
        runApi(fn).then(function(res) {
          if (res && res.ok) { showToast(label + ' å®Œäº†'); spLog('å®Œäº†'); }
          else { showToast(res && res.message ? res.message : label + ' å¤±æ•—'); spLog('å¤±æ•—'); }
        }).catch(function(e) { showToast(e.message || label + ' å¤±æ•—'); spLog('å¤±æ•—: ' + (e.message || '')); });
      }
      document.getElementById('spBtnCompact').addEventListener('click', function() { spRunAdmin('adminCompactHolds', 'æœŸé™åˆ‡ã‚Œç¢ºä¿ã®æ•´ç†'); });
      document.getElementById('spBtnRebuild').addEventListener('click', function() { spRunAdmin('adminRebuildStates', 'çŠ¶æ…‹ã®å†æ§‹ç¯‰'); });
      document.getElementById('spBtnClearCache').addEventListener('click', function() { spRunAdmin('adminClearProductsCache', 'å•†å“ã‚­ãƒ£ãƒƒã‚·ãƒ¥å‰Šé™¤'); });
      document.getElementById('spBtnApplyDv').addEventListener('click', function() { spRunAdmin('adminApplyStatusDropdown', 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³é©ç”¨'); });

      // KOMOJU
      function spUpdateMode(mode, hasTestKey, hasLiveKey) {
        var badge = document.getElementById('spModeBadge');
        var btn = document.getElementById('spBtnToggleMode');
        var keys = document.getElementById('spModeKeys');
        if (!badge || !btn) return;
        badge.textContent = (mode === 'live') ? 'æœ¬ç•ª' : 'ãƒ†ã‚¹ãƒˆ';
        badge.className = 'sp-badge ' + (mode === 'live' ? 'live' : 'test');
        btn.disabled = false;
        btn.textContent = (mode === 'live') ? 'ãƒ†ã‚¹ãƒˆã«åˆ‡æ›¿' : 'æœ¬ç•ªã«åˆ‡æ›¿';
        if (keys) keys.textContent = 'ãƒ†ã‚¹ãƒˆã‚­ãƒ¼: ' + (hasTestKey ? 'è¨­å®šæ¸ˆ' : 'æœªè¨­å®š') + ' ï¼ æœ¬ç•ªã‚­ãƒ¼: ' + (hasLiveKey ? 'è¨­å®šæ¸ˆ' : 'æœªè¨­å®š');
      }
      function spLoadKomoju() {
        runApi('adminGetKomojuMode').then(function(res) {
          if (res && res.ok) spUpdateMode(res.mode, res.hasTestKey, res.hasLiveKey);
          else document.getElementById('spModeBadge').textContent = 'å–å¾—å¤±æ•—';
        }).catch(function() { document.getElementById('spModeBadge').textContent = 'ã‚¨ãƒ©ãƒ¼'; });
      }
      document.getElementById('spBtnToggleMode').addEventListener('click', function() {
        var badge = document.getElementById('spModeBadge');
        var target = (badge.textContent === 'æœ¬ç•ª') ? 'ãƒ†ã‚¹ãƒˆ' : 'æœ¬ç•ª';
        if (!confirm('æ±ºæ¸ˆãƒ¢ãƒ¼ãƒ‰ã‚’ã€Œ' + target + 'ã€ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã‹ï¼Ÿ')) return;
        document.getElementById('spBtnToggleMode').disabled = true;
        runApi('adminToggleKomojuMode').then(function(res) {
          if (!res || !res.ok) { showToast(res && res.message ? res.message : 'åˆ‡æ›¿å¤±æ•—'); document.getElementById('spBtnToggleMode').disabled = false; return; }
          return runApi('adminGetKomojuMode');
        }).then(function(info) {
          if (info && info.ok) spUpdateMode(info.mode, info.hasTestKey, info.hasLiveKey);
          showToast('åˆ‡æ›¿å®Œäº†');
        }).catch(function(e) { showToast(e.message || 'åˆ‡æ›¿å¤±æ•—'); document.getElementById('spBtnToggleMode').disabled = false; });
      });

      // ä¼šå“¡å‰²å¼•
      function spUpdateDiscount(enabled, rate, endDate, reason) {
        var badge = document.getElementById('spDiscountBadge');
        var btn = document.getElementById('spBtnToggleDiscount');
        var info = document.getElementById('spDiscountInfo');
        if (!badge || !btn) return;
        badge.textContent = enabled ? 'ON' : 'OFF';
        badge.className = 'sp-badge ' + (enabled ? 'on' : 'off');
        btn.disabled = false;
        btn.textContent = enabled ? 'OFFã«ã™ã‚‹' : 'ONã«ã™ã‚‹';
        var t = 'å‰²å¼•ç‡: ' + Math.round((rate || 0) * 100) + '% ï¼ æœŸé™: ' + (endDate || 'æœªè¨­å®š');
        if (reason === 'expired') t += 'ï¼ˆæœŸé™åˆ‡ã‚Œï¼‰';
        if (info) info.textContent = t;
      }
      function spLoadDiscount() {
        runApi('adminGetMemberDiscountStatus').then(function(res) {
          if (res && res.ok) spUpdateDiscount(res.enabled, res.rate, res.endDate, res.reason);
          else document.getElementById('spDiscountBadge').textContent = 'å–å¾—å¤±æ•—';
        }).catch(function() { document.getElementById('spDiscountBadge').textContent = 'ã‚¨ãƒ©ãƒ¼'; });
      }
      document.getElementById('spBtnToggleDiscount').addEventListener('click', function() {
        var badge = document.getElementById('spDiscountBadge');
        var target = (badge.textContent === 'ON') ? 'OFF' : 'ON';
        if (!confirm('ä¼šå“¡å‰²å¼•ã‚’ã€Œ' + target + 'ã€ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã‹ï¼Ÿ')) return;
        document.getElementById('spBtnToggleDiscount').disabled = true;
        runApi('adminToggleMemberDiscount').then(function(res) {
          if (!res || !res.ok) { showToast(res && res.message ? res.message : 'åˆ‡æ›¿å¤±æ•—'); document.getElementById('spBtnToggleDiscount').disabled = false; return; }
          spUpdateDiscount(res.enabled, res.rate, res.endDate, res.reason);
          showToast(res.message || 'åˆ‡æ›¿å®Œäº†');
          document.getElementById('spBtnToggleDiscount').disabled = false;
        }).catch(function(e) { showToast(e.message || 'åˆ‡æ›¿å¤±æ•—'); document.getElementById('spBtnToggleDiscount').disabled = false; });
      });
    })();
  }

  // ç‰¹å•†æ³•ãƒ¢ãƒ¼ãƒ€ãƒ«
  var legalLink = document.getElementById('openLegalLink');
  var legalModal = document.getElementById('legalModal');
  var legalOverlay = document.getElementById('legalOverlay');
  var legalClose = document.getElementById('legalCloseBtn');
  function openBulkModal_(modal, overlay) {
    modal.style.display = 'block'; overlay.classList.add('active');
    if (typeof hideFabsForModal_ === 'function') hideFabsForModal_();
  }
  function closeBulkModal_(modal, overlay) {
    modal.style.display = 'none'; overlay.classList.remove('active');
    if (typeof showFabsAfterModal_ === 'function') showFabsAfterModal_();
  }

  if (legalLink && legalModal) {
    legalLink.addEventListener('click', function(e) { e.preventDefault(); openBulkModal_(legalModal, legalOverlay); });
    legalClose.addEventListener('click', function() { closeBulkModal_(legalModal, legalOverlay); });
    legalOverlay.addEventListener('click', function() { closeBulkModal_(legalModal, legalOverlay); });
  }

  // å•†å“ã‚¬ã‚¤ãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ«
  var bulkGuideLink = document.getElementById('openBulkGuideLink');
  var bulkGuideModal = document.getElementById('bulkGuideModal');
  var bulkGuideOverlay = document.getElementById('bulkGuideOverlay');
  var bulkGuideClose = document.getElementById('bulkGuideCloseBtn');
  if (bulkGuideLink && bulkGuideModal) {
    bulkGuideLink.addEventListener('click', function(e) { e.preventDefault(); openBulkModal_(bulkGuideModal, bulkGuideOverlay); });
    bulkGuideClose.addEventListener('click', function() { closeBulkModal_(bulkGuideModal, bulkGuideOverlay); });
    bulkGuideOverlay.addEventListener('click', function() { closeBulkModal_(bulkGuideModal, bulkGuideOverlay); });
  }

  // é€æ–™è¡¨ãƒ¢ãƒ¼ãƒ€ãƒ«
  var bulkShippingLink = document.getElementById('openBulkShippingLink');
  var bulkShippingModal = document.getElementById('bulkShippingModal');
  var bulkShippingOverlay = document.getElementById('bulkShippingOverlay');
  var bulkShippingClose = document.getElementById('bulkShippingCloseBtn');
  if (bulkShippingLink && bulkShippingModal) {
    bulkShippingLink.addEventListener('click', function(e) { e.preventDefault(); openBulkModal_(bulkShippingModal, bulkShippingOverlay); });
    bulkShippingClose.addEventListener('click', function() { closeBulkModal_(bulkShippingModal, bulkShippingOverlay); });
    bulkShippingOverlay.addEventListener('click', function() { closeBulkModal_(bulkShippingModal, bulkShippingOverlay); });
  }

  // ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ«
  var privacyLink = document.getElementById('openPrivacyLink');
  var privacyModal = document.getElementById('privacyModal');
  var privacyOverlay = document.getElementById('privacyOverlay');
  var privacyClose = document.getElementById('privacyCloseBtn');
  if (privacyLink && privacyModal) {
    privacyLink.addEventListener('click', function(e) { e.preventDefault(); openBulkModal_(privacyModal, privacyOverlay); });
    privacyClose.addEventListener('click', function() { closeBulkModal_(privacyModal, privacyOverlay); });
    privacyOverlay.addEventListener('click', function() { closeBulkModal_(privacyModal, privacyOverlay); });
  }

  // ãŠå•ã„åˆã‚ã›ãƒ¢ãƒ¼ãƒ€ãƒ«
  var contactLink = document.getElementById('openContactLink');
  var contactLinkHeader = document.getElementById('openContactLinkHeader');
  var contactModal = document.getElementById('contactModal');
  var contactOverlay = document.getElementById('contactOverlay');
  var contactClose = document.getElementById('contactCloseBtn');
  if (contactModal) {
    var openContact = function(e) { e.preventDefault(); openBulkModal_(contactModal, contactOverlay); };
    if (contactLink) contactLink.addEventListener('click', openContact);
    if (contactLinkHeader) contactLinkHeader.addEventListener('click', openContact);
    if (contactClose) contactClose.addEventListener('click', function() { closeBulkModal_(contactModal, contactOverlay); });
    if (contactOverlay) contactOverlay.addEventListener('click', function() { closeBulkModal_(contactModal, contactOverlay); });
  }

  // ãŠå•ã„åˆã‚ã›é€ä¿¡
  var contactSubmit = document.getElementById('contactSubmitBtn');
  if (contactSubmit) {
    contactSubmit.addEventListener('click', function() {
      var name = (document.getElementById('contactName').value || '').trim();
      var email = (document.getElementById('contactEmail').value || '').trim();
      var message = (document.getElementById('contactMessage').value || '').trim();
      if (!name || !email || !message) { alert('å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
      contactSubmit.disabled = true;
      contactSubmit.textContent = 'é€ä¿¡ä¸­...';
      runApi('apiSendContactForm', { name: name, email: email, message: message, page: 'ã‚¢ã‚½ãƒ¼ãƒˆ' })
        .then(function(res) {
          if (res && res.ok) {
            alert('ãŠå•ã„åˆã‚ã›ã‚’é€ä¿¡ã—ã¾ã—ãŸ');
            document.getElementById('contactName').value = '';
            document.getElementById('contactEmail').value = '';
            document.getElementById('contactMessage').value = '';
            contactModal.style.display = 'none';
            contactOverlay.classList.remove('active');
          } else { alert((res && res.message) || 'é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ'); }
        })
        .catch(function(e) { alert(e.message || 'é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ'); })
        .finally(function() { contactSubmit.disabled = false; contactSubmit.textContent = 'é€ä¿¡'; });
    });
  }
})();

</script>

<!-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒˆãƒƒãƒ—ãƒœã‚¿ãƒ³ -->
<button class="toTop" id="toTopBtn" type="button" aria-label="ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã¸">â†‘</button>

<!-- === AI Chatbot Widget === -->
<button class="chatbot-fab" id="chatbotFab" type="button" aria-label="AIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ" title="AIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ">
  <span class="chatbot-fab-icon"><svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H5.2L4 17.2V4h16v12z"/><circle cx="8" cy="10" r="1.2"/><circle cx="12" cy="10" r="1.2"/><circle cx="16" cy="10" r="1.2"/></svg></span>
  <span class="chatbot-fab-close"><svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></span>
</button>

<div class="chatbot-panel" id="chatbotPanel">
  <div class="chatbot-header">
    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
    AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
    <span class="chatbot-header-actions">
      <button class="chatbot-header-toTop" id="chatbotHeaderToTop" type="button" aria-label="ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã¸" title="ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã¸">â†‘</button>
      <button class="chatbot-close-btn" id="chatbotCloseBtn" type="button" aria-label="é–‰ã˜ã‚‹" title="é–‰ã˜ã‚‹">Ã—</button>
    </span>
  </div>
  <div class="chatbot-messages" id="chatbotMessages"></div>
  <div class="chatbot-input-area">
    <textarea id="chatbotInput" placeholder="è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..." rows="1"></textarea>
    <button class="chatbot-send-btn" id="chatbotSend" type="button" aria-label="é€ä¿¡"><svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg></button>
  </div>
</div>

<script>
(function(){
  var fab = document.getElementById('chatbotFab');
  var panel = document.getElementById('chatbotPanel');
  var messagesEl = document.getElementById('chatbotMessages');
  var input = document.getElementById('chatbotInput');
  var sendBtn = document.getElementById('chatbotSend');
  var badge = document.getElementById('chatbotBadge');
  var closeBtn = document.getElementById('chatbotCloseBtn');
  var headerToTop = document.getElementById('chatbotHeaderToTop');
  var isOpen = false;
  var chatHistory = [];
  var isSending = false;
  var greeted = false;

  window.closeChatbot = function(){
    if (!isOpen) return;
    isOpen = false;
    window._chatbotIsOpen = false;
    panel.classList.remove('open');
    fab.classList.remove('open');
    updateToTopBtn_();
  };

  var FAQ = [
    // --- æ³¨æ–‡ãƒ»è³¼å…¥ ---
    { q: 'æ³¨æ–‡æ–¹æ³•ã‚’æ•™ãˆã¦', category: 'æ³¨æ–‡ãƒ»è³¼å…¥',
      a: 'ã€ã”æ³¨æ–‡æ–¹æ³•ã€‘\n1. å•†å“ã‚’é¸ã‚“ã§æ•°é‡ã‚’æŒ‡å®š\n2. ã‚«ãƒ¼ãƒˆã«è¿½åŠ \n3. ãŠå±Šã‘å…ˆã‚’å…¥åŠ›ã™ã‚‹ã¨é€æ–™ãŒè‡ªå‹•è¨ˆç®—ã•ã‚Œã¾ã™\n4. ãŠæ”¯æ‰•ã„æ–¹æ³•ã‚’é¸ã‚“ã§æ³¨æ–‡ç¢ºå®š\n\nè©³ã—ãã¯ç”»é¢ä¸Šéƒ¨ã®ã€Œå•†å“ã‚¬ã‚¤ãƒ‰ã€ã‚‚ã”è¦§ãã ã•ã„ã€‚' },
    { q: 'æœ€ä½æ³¨æ–‡æ•°ã¯ï¼Ÿ', category: 'æ³¨æ–‡ãƒ»è³¼å…¥',
      a: 'ã‚¢ã‚½ãƒ¼ãƒˆå•†å“ã¯å„å•†å“ã”ã¨ã«æœ€ä½æ³¨æ–‡æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚å•†å“ã‚«ãƒ¼ãƒ‰ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹æ•°é‡ã‹ã‚‰ã”æ³¨æ–‡ã„ãŸã ã‘ã¾ã™ã€‚' },
    { q: 'æ³¨æ–‡å¾Œã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã¯ã§ãã‚‹ï¼Ÿ', category: 'æ³¨æ–‡ãƒ»è³¼å…¥',
      a: 'ã”æ³¨æ–‡ç¢ºå®šå¾Œã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒ»å¤‰æ›´ã¯ãŠå—ã‘ã—ã¦ãŠã‚Šã¾ã›ã‚“ã€‚\nã”æ³¨æ–‡å‰ã«å•†å“å†…å®¹ã‚’ã‚ˆãã”ç¢ºèªãã ã•ã„ã€‚\n\nä¸‡ä¸€ã€å•†å“å†…å®¹ãŒè¨˜è¼‰äº‹é …ã¨å¤§ããç•°ãªã‚‹å ´åˆã¯ã€å•†å“åˆ°ç€å¾Œ7æ—¥ä»¥å†…ã«ã”é€£çµ¡ãã ã•ã„ã€‚' },
    { q: 'ãƒ‡ã‚¿ã‚¦ãƒªï¼ˆå€‹å“ï¼‰ãƒšãƒ¼ã‚¸ã¨ã¯ï¼Ÿ', category: 'æ³¨æ–‡ãƒ»è³¼å…¥',
      a: 'ã€ãƒ‡ã‚¿ã‚¦ãƒªï¼ˆæ¡å¯¸ä»˜ãå€‹å“ï¼‰ãƒšãƒ¼ã‚¸ã€‘\n1ç‚¹ãšã¤å•†å“ã‚’é¸ã¹ã‚‹å€‹å“è²©å£²ãƒšãƒ¼ã‚¸ã§ã™ã€‚\n\nãƒ»ã™ã¹ã¦ã®å•†å“ã«æ¡å¯¸ãƒ‡ãƒ¼ã‚¿ãŒä»˜ã„ã¦ã„ã¾ã™\nãƒ»ãƒ–ãƒ©ãƒ³ãƒ‰ãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ»ä¾¡æ ¼å¸¯ãƒ»çŠ¶æ…‹ãƒ©ãƒ³ã‚¯ã§çµã‚Šè¾¼ã¿å¯èƒ½\nãƒ»ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã€Œãƒ‡ã‚¿ã‚¦ãƒªã€ãƒœã‚¿ãƒ³ã‹ã‚‰åˆ‡ã‚Šæ›¿ãˆã§ãã¾ã™\n\nã¾ã¨ã‚è²·ã„ãªã‚‰ã‚¢ã‚½ãƒ¼ãƒˆã€1ç‚¹ãšã¤é¸ã¶ãªã‚‰ãƒ‡ã‚¿ã‚¦ãƒªãŒãŠã™ã™ã‚ã§ã™ï¼' },

    // --- é€æ–™ãƒ»é…é€ ---
    { q: 'é€æ–™ã¯ã„ãã‚‰ï¼Ÿ', category: 'é€æ–™ãƒ»é…é€',
      a: 'ã€é€æ–™ã«ã¤ã„ã¦ã€‘\né€æ–™ã¯ãŠå±Šã‘å…ˆã®åœ°åŸŸã¨è·ç‰©ã®ã‚µã‚¤ã‚ºã«ã‚ˆã£ã¦ç•°ãªã‚Šã¾ã™ã€‚\nä½æ‰€ã‚’å…¥åŠ›ã™ã‚‹ã¨è‡ªå‹•è¨ˆç®—ã•ã‚Œã¾ã™ã€‚\n\nãƒ»ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ä¼šå“¡ã¯é€æ–™ç„¡æ–™ï¼\n\nè©³ã—ãã¯ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã€Œã‚¢ã‚½ãƒ¼ãƒˆé€æ–™è¡¨ã€ã‹ã‚‰ã”ç¢ºèªãã ã•ã„ã€‚' },
    { q: 'é…é€ã«ã‹ã‹ã‚‹æ—¥æ•°ã¯ï¼Ÿ', category: 'é€æ–™ãƒ»é…é€',
      a: 'æ±ºæ¸ˆå®Œäº†å¾Œã€é€šå¸¸2ã€œ5å–¶æ¥­æ—¥ã§ç™ºé€ã„ãŸã—ã¾ã™ã€‚\nãŠå±Šã‘ã¾ã§ã®æ—¥æ•°ã¯åœ°åŸŸã«ã‚ˆã‚Šç•°ãªã‚Šã¾ã™ãŒã€ç™ºé€ã‹ã‚‰1ã€œ3æ—¥ç¨‹åº¦ã§ã™ã€‚\n\nâ€»ç¹å¿™æœŸã‚„å¤©å€™ãƒ»ç½å®³ç­‰ã«ã‚ˆã‚Šé…å»¶ã™ã‚‹å ´åˆãŒã”ã–ã„ã¾ã™ã€‚' },
    { q: 'é€æ–™ç„¡æ–™ã«ãªã‚‹æ¡ä»¶ã¯ï¼Ÿ', category: 'é€æ–™ãƒ»é…é€',
      a: 'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ä¼šå“¡ã®ãŠå®¢æ§˜ã¯é€æ–™ç„¡æ–™ã§ã™ï¼\n\nãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ä¼šå“¡ã«ãªã‚‹ã«ã¯ã€ç´¯è¨ˆè³¼å…¥é¡30ä¸‡å††ä»¥ä¸ŠãŒæ¡ä»¶ã¨ãªã‚Šã¾ã™ã€‚\nè©³ã—ãã¯ã€Œä¼šå“¡ãƒ©ãƒ³ã‚¯ã«ã¤ã„ã¦ã€ã‚’ã”ç¢ºèªãã ã•ã„ã€‚' },

    // --- æ±ºæ¸ˆ ---
    { q: 'æ±ºæ¸ˆæ–¹æ³•ã¯ï¼Ÿ', category: 'æ±ºæ¸ˆ',
      a: 'ã€ã”åˆ©ç”¨å¯èƒ½ãªæ±ºæ¸ˆæ–¹æ³•ã€‘\nãƒ»ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ï¼ˆVisa/Mastercard/JCB/AMEX/Diners/Discoverï¼‰\nãƒ»Apple Pay\nãƒ»ã‚³ãƒ³ãƒ“ãƒ‹æ±ºæ¸ˆï¼ˆåˆ¥é€”æ‰‹æ•°æ–™220å††ï¼‰\nãƒ»éŠ€è¡ŒæŒ¯è¾¼ï¼ˆæŒ¯è¾¼æ‰‹æ•°æ–™ã¯ãŠå®¢æ§˜è² æ‹…ï¼‰\nãƒ»PayPay\nãƒ»ãƒšã‚¤ã‚¸ãƒ¼ï¼ˆæŒ¯è¾¼æ‰‹æ•°æ–™ã¯ãŠå®¢æ§˜è² æ‹…ï¼‰\n\nã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ãƒ»Apple Payãƒ»PayPayãŒæœ€ã‚‚ã‚¹ãƒ ãƒ¼ã‚ºã«ãŠæ‰‹ç¶šãã„ãŸã ã‘ã¾ã™ã€‚' },
    { q: 'ã‚³ãƒ³ãƒ“ãƒ‹æ±ºæ¸ˆã®æ‰‹æ•°æ–™ã¯ï¼Ÿ', category: 'æ±ºæ¸ˆ',
      a: 'ã‚³ãƒ³ãƒ“ãƒ‹æ±ºæ¸ˆã‚’ã”åˆ©ç”¨ã®å ´åˆã€åˆ¥é€”220å††ã®æ‰‹æ•°æ–™ãŒã‹ã‹ã‚Šã¾ã™ã€‚\n\næ‰‹æ•°æ–™ã‚’æŠ‘ãˆãŸã„å ´åˆã¯ã€ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ãƒ»Apple Payãƒ»PayPayæ±ºæ¸ˆãŒãŠã™ã™ã‚ã§ã™ã€‚' },
    { q: 'éŠ€è¡ŒæŒ¯è¾¼ã®æ‰‹æ•°æ–™ã¯ï¼Ÿ', category: 'æ±ºæ¸ˆ',
      a: 'éŠ€è¡ŒæŒ¯è¾¼ã‚’ã”åˆ©ç”¨ã®å ´åˆã€æŒ¯è¾¼æ‰‹æ•°æ–™ã¯ãŠå®¢æ§˜ã®ã”è² æ‹…ã¨ãªã‚Šã¾ã™ã€‚\næ‰‹æ•°æ–™ã®é‡‘é¡ã¯ã”åˆ©ç”¨ã®é‡‘èæ©Ÿé–¢ã«ã‚ˆã‚Šç•°ãªã‚Šã¾ã™ã€‚\nãƒšã‚¤ã‚¸ãƒ¼ã‚‚åŒæ§˜ã§ã™ã€‚' },

    // --- å‰²å¼•ãƒ»ã‚»ãƒ¼ãƒ« ---
    { q: 'å‰²å¼•ã¯ã‚ã‚‹ï¼Ÿ', category: 'å‰²å¼•ãƒ»ã‚»ãƒ¼ãƒ«',
      a: 'ã€ç¾åœ¨ã®å‰²å¼•åˆ¶åº¦ã€‘\n\n1. ä¼šå“¡ç™»éŒ²å‰²å¼•ï¼š10%OFFï¼ˆ2026å¹´9æœˆæœ«ã¾ã§ï¼‰\n2. ã‚¯ãƒ¼ãƒãƒ³ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã‚‹å‰²å¼•\n\nè©³ã—ãã¯ã‚¹ã‚¿ãƒƒãƒ•ã¾ã§ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚' },
    { q: 'ä¼šå“¡å‰²å¼•ã®æœŸé–“ã¯ï¼Ÿ', category: 'å‰²å¼•ãƒ»ã‚»ãƒ¼ãƒ«',
      a: 'ä¼šå“¡ç™»éŒ²ã§å…¨å“10%OFFã®ç‰¹å…¸ã¯2026å¹´9æœˆæœ«ã¾ã§ã®æœŸé–“é™å®šã§ã™ã€‚\n\nãƒ»ç„¡æ–™ç™»éŒ²ã™ã‚‹ã ã‘ã§é©ç”¨\nãƒ»æœŸé–“ä¸­ã¯ã„ã¤ã§ã‚‚ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™\n\nãŠæ—©ã‚ã®ç™»éŒ²ãŒãŠã™ã™ã‚ã§ã™ï¼' },

    // --- ä¼šå“¡ ---
    { q: 'ä¼šå“¡ç™»éŒ²ã®æ–¹æ³•ã¯ï¼Ÿ', category: 'ä¼šå“¡',
      a: 'ã€ä¼šå“¡ç™»éŒ²ã®æ–¹æ³•ã€‘\nç”»é¢ä¸Šéƒ¨ã®ã€Œãƒ­ã‚°ã‚¤ãƒ³ / æ–°è¦ç™»éŒ²ã€ãƒœã‚¿ãƒ³ã‹ã‚‰ãŠæ‰‹ç¶šãã„ãŸã ã‘ã¾ã™ã€‚\n\nãƒ»ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®è¨­å®šã ã‘ã§å®Œäº†\nãƒ»ç™»éŒ²ã¯ç„¡æ–™ã§ã™\nãƒ»ç™»éŒ²ç›´å¾Œã‹ã‚‰ä¼šå“¡å‰²å¼•ï¼ˆ10%OFFï¼‰ãŒé©ç”¨ã•ã‚Œã¾ã™' },
    { q: 'ä¼šå“¡ãƒ©ãƒ³ã‚¯ã«ã¤ã„ã¦', category: 'ä¼šå“¡',
      a: 'ã€ä¼šå“¡ãƒ©ãƒ³ã‚¯åˆ¶åº¦ã€‘\n\nãƒ»ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ï¼šåˆå›ç™»éŒ²æ™‚ï¼ˆ10%OFFç‰¹å…¸ï¼‰\nãƒ»ã‚·ãƒ«ãƒãƒ¼ï¼šç´¯è¨ˆ5ä¸‡å††ä»¥ä¸Š\nãƒ»ã‚´ãƒ¼ãƒ«ãƒ‰ï¼šç´¯è¨ˆ15ä¸‡å††ä»¥ä¸Š\nãƒ»ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ï¼šç´¯è¨ˆ30ä¸‡å††ä»¥ä¸Šï¼ˆé€æ–™ç„¡æ–™ï¼ï¼‰\n\nãƒ©ãƒ³ã‚¯ãŒä¸ŠãŒã‚‹ã»ã©ç‰¹å…¸ãŒå……å®Ÿã—ã¾ã™ã€‚' },
    { q: 'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ä¼šå“¡ã®ç‰¹å…¸ã¯ï¼Ÿ', category: 'ä¼šå“¡',
      a: 'ã€ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ä¼šå“¡ç‰¹å…¸ã€‘\nãƒ»é€æ–™ç„¡æ–™ï¼ˆå›½å†…å…¨åŸŸï¼‰\nãƒ»å„ªå…ˆåœ¨åº«ç¢ºä¿\n\næ¡ä»¶ï¼šç´¯è¨ˆè³¼å…¥é¡30ä¸‡å††ä»¥ä¸Š\nãŸãã•ã‚“ã”åˆ©ç”¨ã„ãŸã ãã»ã©ãŠå¾—ã«ãªã‚Šã¾ã™ï¼' },

    // --- æ©Ÿèƒ½ãƒ»ãã®ä»– ---
    { q: 'å‰¯æ¥­ç‰©è²©ãŠå½¹ç«‹ã¡æƒ…å ±ã£ã¦ä½•ï¼Ÿ', category: 'æ©Ÿèƒ½ãƒ»ãã®ä»–',
      a: 'ã€å‰¯æ¥­ç‰©è²©ãŠå½¹ç«‹ã¡æƒ…å ±ã€‘\nç”»é¢å·¦ä¸‹ã®ãƒœã‚¿ãƒ³ã‹ã‚‰ã€ç‰©è²©ã«å½¹ç«‹ã¤ãƒã‚¦ãƒã‚¦è¨˜äº‹ã‚’èª­ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚\n\nãƒ»æ¯æ—¥æ–°ã—ã„è¨˜äº‹ã‚’é…ä¿¡ä¸­\nãƒ»ãƒ•ãƒªãƒã‚¢ãƒ—ãƒªã§ã®å£²ã‚Šæ–¹ã‚„ä»•å…¥ã‚Œã®ã‚³ãƒ„ãªã©\nãƒ»å‰¯æ¥­ç‰©è²©ã‚’å§‹ã‚ã‚‹æ–¹ã«å½¹ç«‹ã¤æƒ…å ±ãŒæº€è¼‰ã§ã™' },

    // --- è¿”å“ãƒ»ã‚µãƒãƒ¼ãƒˆ ---
    { q: 'è¿”å“ãƒ»äº¤æ›ã¯ã§ãã‚‹ï¼Ÿ', category: 'è¿”å“ãƒ»ã‚µãƒãƒ¼ãƒˆ',
      a: 'è¿”å“ãƒ»äº¤æ›ã¯åŸå‰‡ãŠå—ã‘ã—ã¦ãŠã‚Šã¾ã›ã‚“ã€‚\n\nãŸã ã—ã€å•†å“å†…å®¹ãŒè¨˜è¼‰äº‹é …ã¨å¤§ããç•°ãªã‚‹å ´åˆã¯ã€å•†å“åˆ°ç€å¾Œ7æ—¥ä»¥å†…ã«ã”é€£çµ¡ãã ã•ã„ã€‚\n\nâœ‰ ãŠå•ã„åˆã‚ã› ã‚ˆã‚Šã”é€£çµ¡ã„ãŸã ã‘ã¾ã™ã€‚' },
    { q: 'ãŠå•ã„åˆã‚ã›ã—ãŸã„', category: 'è¿”å“ãƒ»ã‚µãƒãƒ¼ãƒˆ',
      a: 'ãŠå•ã„åˆã‚ã›ã¯ä»¥ä¸‹ã®æ–¹æ³•ã§æ‰¿ã£ã¦ãŠã‚Šã¾ã™ï¼š\n\nâœ‰ ãŠå•ã„åˆã‚ã› ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ã”é€£çµ¡ãã ã•ã„ã€‚\n\nå–¶æ¥­æ™‚é–“å†…ã«ã”è¿”ä¿¡ã„ãŸã—ã¾ã™ã€‚\nãŠæ°—è»½ã«ã©ã†ãï¼' },
    { q: 'å–¶æ¥­æ™‚é–“ã¯ï¼Ÿ', category: 'è¿”å“ãƒ»ã‚µãƒãƒ¼ãƒˆ',
      a: 'å–¶æ¥­æ™‚é–“ï¼šå¹³æ—¥ 10:00ã€œ18:00\nï¼ˆåœŸæ—¥ç¥ã¯ãŠä¼‘ã¿ã§ã™ï¼‰\n\nå–¶æ¥­æ™‚é–“å¤–ã®ãŠå•ã„åˆã‚ã›ã¯ç¿Œå–¶æ¥­æ—¥ã«ã”è¿”ä¿¡ã„ãŸã—ã¾ã™ã€‚' }
  ];

  var GREETING = 'ã“ã‚“ã«ã¡ã¯ï¼ã‚¢ã‚½ãƒ¼ãƒˆå•†å“ãƒšãƒ¼ã‚¸ã¸ã‚ˆã†ã“ãã€‚\nå‰¯æ¥­ç‰©è²©å‘ã‘ã®å¤ç€ã¾ã¨ã‚è²·ã„å°‚ç”¨ãƒšãƒ¼ã‚¸ã§ã™ã€‚\nã”è³ªå•ã®ã‚«ãƒ†ã‚´ãƒªã‚’ãŠé¸ã³ã„ãŸã ãã‹ã€ä¸‹ã®å…¥åŠ›æ¬„ã‹ã‚‰è‡ªç”±ã«ã”è³ªå•ãã ã•ã„ã€‚';

  function toggleChat(){
    isOpen = !isOpen;
    window._chatbotIsOpen = isOpen;
    panel.classList.toggle('open', isOpen);
    fab.classList.toggle('open', isOpen);
    if (badge) badge.classList.remove('show');
    if (isOpen && !greeted) {
      greeted = true;
      appendMessage('bot', GREETING);
      showCategoryButtons();
    }
    if (isOpen) {
      setTimeout(function(){ input.focus(); }, 200);
      scrollToBottom();
    }
    updateToTopBtn_();
  }

  function showCategoryButtons(){
    var categories = [];
    var seen = {};
    FAQ.forEach(function(item){
      if (!seen[item.category]) { seen[item.category] = true; categories.push(item.category); }
    });
    var wrap = document.createElement('div');
    wrap.className = 'chatbot-quick-replies';
    wrap.style.cssText = 'margin-top:6px;';
    categories.forEach(function(cat){
      var b = document.createElement('button');
      b.className = 'chatbot-quick-btn';
      b.textContent = cat;
      b.type = 'button';
      b.addEventListener('click', function(){
        showQuestionsForCategory(cat);
      });
      wrap.appendChild(b);
    });
    messagesEl.appendChild(wrap);
    scrollToBottom();
  }

  function showQuestionsForCategory(cat){
    appendMessage('user', cat);
    var items = FAQ.filter(function(f){ return f.category === cat; });
    var botMsg = document.createElement('div');
    botMsg.className = 'chatbot-msg bot';
    botMsg.style.cssText = 'padding-bottom:6px;';
    botMsg.textContent = 'ã€Œ' + cat + 'ã€ã«é–¢ã™ã‚‹ã”è³ªå•ã‚’ãŠé¸ã³ãã ã•ã„ã€‚';
    messagesEl.appendChild(botMsg);

    var wrap = document.createElement('div');
    wrap.className = 'chatbot-quick-replies';
    wrap.style.cssText = 'padding:0 2px;margin-top:4px;';
    items.forEach(function(item){
      var b = document.createElement('button');
      b.className = 'chatbot-quick-btn';
      b.textContent = item.q;
      b.type = 'button';
      b.addEventListener('click', function(){
        handleQuickReply(item);
      });
      wrap.appendChild(b);
    });
    var back = document.createElement('button');
    back.className = 'chatbot-quick-btn';
    back.style.cssText = 'border-color:#94a3b8;color:#64748b;';
    back.textContent = '\u2190 ã‚«ãƒ†ã‚´ãƒªã«æˆ»ã‚‹';
    back.type = 'button';
    back.addEventListener('click', function(){
      appendMessage('user', 'ã‚«ãƒ†ã‚´ãƒªã«æˆ»ã‚‹');
      var note = document.createElement('div');
      note.className = 'chatbot-msg bot';
      note.textContent = 'ã‚«ãƒ†ã‚´ãƒªã‚’ãŠé¸ã³ãã ã•ã„ã€‚';
      messagesEl.appendChild(note);
      showCategoryButtons();
    });
    wrap.appendChild(back);
    messagesEl.appendChild(wrap);
    scrollToBottom();
  }

  function handleQuickReply(item){
    appendMessage('user', item.q);
    chatHistory.push({ role: 'user', content: item.q });
    var answerDiv = appendMessageAndReturn('bot', item.a);
    chatHistory.push({ role: 'assistant', content: item.a });
    showAfterAnswer(answerDiv);
  }

  function showAfterAnswer(answerEl){
    var note = document.createElement('div');
    note.className = 'chatbot-msg bot';
    note.textContent = 'ä»–ã«ã‚‚ã”è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã‚‰ã€ã‚«ãƒ†ã‚´ãƒªã‚’ãŠé¸ã³ã„ãŸã ãã‹ã€è‡ªç”±ã«å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
    messagesEl.appendChild(note);
    showCategoryButtons();
    appendStaffContactButton();
    scrollToElement(answerEl);
  }

  function appendStaffContactButton(){
    var wrap = document.createElement('div');
    wrap.style.cssText = 'padding:0 2px;margin-top:4px;text-align:center;';
    var btn = document.createElement('button');
    btn.className = 'chatbot-staff-btn';
    btn.type = 'button';
    btn.textContent = '\u2709 ã‚¹ã‚¿ãƒƒãƒ•ã«å•ã„åˆã‚ã›ã‚‹';
    btn.addEventListener('click', function(){ showContactForm_(); });
    wrap.appendChild(btn);
    messagesEl.appendChild(wrap);
  }

  function showContactForm_(){
    // Tawk.to ãŒèª­ã¿è¾¼ã¿æ¸ˆã¿ãªã‚‰ãƒ©ã‚¤ãƒ–ãƒãƒ£ãƒƒãƒˆã‚’èµ·å‹•
    if (typeof Tawk_API !== 'undefined' && Tawk_API.maximize) {
      appendMessage('bot', 'ã‚¹ã‚¿ãƒƒãƒ•ã¨ã®ãƒ©ã‚¤ãƒ–ãƒãƒ£ãƒƒãƒˆã‚’é–‹ãã¾ã™ã€‚');
      scrollToBottom();
      window.closeChatbot();
      Tawk_API.maximize();
      return;
    }
    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã§ãƒ¡ãƒ¼ãƒ«å•ã„åˆã‚ã›
    appendMessage('user', 'ã‚¹ã‚¿ãƒƒãƒ•ã«å•ã„åˆã‚ã›ã‚‹');
    var cust = (typeof G !== 'undefined' && G && G.customer) ? G.customer : null;
    var prefillName = (cust && cust.companyName) || '';
    var prefillEmail = (cust && cust.email) || '';
    var lastUserMsg = '';
    for (var i = chatHistory.length - 1; i >= 0; i--) {
      if (chatHistory[i].role === 'user' && chatHistory[i].content !== 'ã‚¹ã‚¿ãƒƒãƒ•ã«å•ã„åˆã‚ã›ã‚‹') {
        lastUserMsg = chatHistory[i].content; break;
      }
    }
    var formDiv = document.createElement('div');
    formDiv.className = 'chatbot-msg bot';
    formDiv.innerHTML =
      '<div style="margin-bottom:6px;font-weight:600;">ã‚¹ã‚¿ãƒƒãƒ•ã¸ã®ãŠå•ã„åˆã‚ã›</div>' +
      '<div style="font-size:12px;color:#64748b;margin-bottom:8px;">å†…å®¹ã‚’å…¥åŠ›ã—ã¦é€ä¿¡ã—ã¦ãã ã•ã„ã€‚2å–¶æ¥­æ—¥ä»¥å†…ã«ãƒ¡ãƒ¼ãƒ«ã§ã”è¿”ä¿¡ã„ãŸã—ã¾ã™ã€‚</div>' +
      '<div class="chatbot-contact-form">' +
      '<label>ãŠåå‰ *</label><input type="text" id="chatContactName" value="' + escAttr(prefillName) + '" placeholder="ä¼šç¤¾å/æ°å">' +
      '<label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ *</label><input type="email" id="chatContactEmail" value="' + escAttr(prefillEmail) + '" placeholder="è¿”ä¿¡å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹">' +
      '<label>ãŠå•ã„åˆã‚ã›å†…å®¹ *</label><textarea id="chatContactMsg" placeholder="ãŠå•ã„åˆã‚ã›å†…å®¹ã‚’ã”è¨˜å…¥ãã ã•ã„">' + escHtml(lastUserMsg) + '</textarea>' +
      '<button class="chatbot-contact-btn" id="chatContactSubmit" type="button">é€ä¿¡</button>' +
      '</div>';
    messagesEl.appendChild(formDiv);
    scrollToBottom();
    var nameEl = document.getElementById('chatContactName');
    if (nameEl && !prefillName) nameEl.focus();
    document.getElementById('chatContactSubmit').addEventListener('click', submitChatContact_);
  }
  window.showChatContactForm_ = showContactForm_;

  function submitChatContact_(){
    var nameEl = document.getElementById('chatContactName');
    var emailEl = document.getElementById('chatContactEmail');
    var msgEl = document.getElementById('chatContactMsg');
    var btn = document.getElementById('chatContactSubmit');
    if (!nameEl || !emailEl || !msgEl || !btn) return;
    var name = (nameEl.value || '').trim();
    var email = (emailEl.value || '').trim();
    var message = (msgEl.value || '').trim();
    if (!name || !email || !message) {
      appendMessage('bot', 'å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
      scrollToBottom();
      return;
    }
    btn.disabled = true;
    btn.textContent = 'é€ä¿¡ä¸­...';
    runApi('apiSendContactForm', { name: name, email: email, message: message, page: 'ã‚¢ã‚½ãƒ¼ãƒˆ' })
      .then(function(res){
        if (res && res.ok) {
          appendMessage('bot', 'ãŠå•ã„åˆã‚ã›ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚2å–¶æ¥­æ—¥ä»¥å†…ã«ã”è¿”ä¿¡ã„ãŸã—ã¾ã™ã€‚\nå¼•ãç¶šãã”è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã‚‰ãŠæ°—è»½ã«ã©ã†ãã€‚');
          showCategoryButtons();
          appendStaffContactButton();
        } else {
          appendMessage('bot', (res && res.message) || 'é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãŠæ‰‹æ•°ã§ã™ãŒã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
          btn.disabled = false;
          btn.textContent = 'é€ä¿¡';
        }
      })
      .catch(function(){
        appendMessage('bot', 'é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãŠæ‰‹æ•°ã§ã™ãŒã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
        btn.disabled = false;
        btn.textContent = 'é€ä¿¡';
      });
  }

  function appendMessage(role, text){
    appendMessageAndReturn(role, text);
  }

  function appendMessageAndReturn(role, text){
    var div = document.createElement('div');
    div.className = 'chatbot-msg ' + role;
    if (role === 'bot') {
      var span = document.createElement('span');
      span.textContent = text;
      var safe = span.innerHTML;
      safe = safe.replace(/âœ‰\s*ãŠå•ã„åˆã‚ã›/g, '<a href="#" style="color:#3b82f6;text-decoration:underline;cursor:pointer;" onclick="event.preventDefault();if(typeof showChatContactForm_===\'function\')showChatContactForm_();return false;">âœ‰ ãŠå•ã„åˆã‚ã›</a>');
      div.innerHTML = safe;
    } else {
      div.textContent = text;
    }
    messagesEl.appendChild(div);
    scrollToBottom();
    return div;
  }

  function showTyping(){
    var div = document.createElement('div');
    div.className = 'chatbot-msg typing';
    div.innerHTML = '<span class="dot"></span><span class="dot"></span><span class="dot"></span>';
    messagesEl.appendChild(div);
    scrollToBottom();
    return div;
  }

  function removeTyping(el){
    if (el && el.parentNode) el.parentNode.removeChild(el);
  }

  function scrollToBottom(){
    requestAnimationFrame(function(){
      messagesEl.scrollTop = messagesEl.scrollHeight;
    });
  }

  function scrollToElement(el){
    if (!el) return;
    requestAnimationFrame(function(){
      var containerTop = messagesEl.getBoundingClientRect().top;
      var elTop = el.getBoundingClientRect().top;
      var offset = elTop - containerTop;
      messagesEl.scrollTop = messagesEl.scrollTop + offset - 8;
    });
  }

  function getKeywords(q){
    var words = q.replace(/[\sã€€?ï¼Ÿ!ï¼ã€‚ã€.,ã‚’ãƒ»ã¯ã®ã«ã¦ã§ãŒã‚‚ã¨ã¸]/g, ' ').split(/\s+/).filter(function(w){ return w.length >= 2; });
    return words.map(function(w){ return w.toLowerCase(); });
  }

  function matchFaq(text){
    var t = text.toLowerCase().replace(/[\sã€€?ï¼Ÿ!ï¼ã€‚ã€.,]/g, '');
    var best = null;
    var bestScore = 0;
    FAQ.forEach(function(item){
      var score = 0;
      var keywords = getKeywords(item.q);
      keywords.forEach(function(kw){
        if (t.indexOf(kw) !== -1) score += kw.length;
      });
      if (score > bestScore) { bestScore = score; best = item; }
    });
    return bestScore >= 2 ? best : null;
  }

  function isUnanswerable(reply){
    var markers = ['ã‚ã‹ã‚Šã¾ã›ã‚“', 'ãŠç­”ãˆã§ãã¾ã›ã‚“', 'æƒ…å ±ãŒã‚ã‚Šã¾ã›ã‚“', 'å¯¾å¿œã§ãã¾ã›ã‚“'];
    var r = reply.toLowerCase();
    return markers.some(function(m){ return r.indexOf(m) !== -1; });
  }

  function getUserKey_(){
    if (typeof bulkState_ !== 'undefined' && bulkState_ && bulkState_.userKey) return bulkState_.userKey;
    try {
      var k = localStorage.getItem('detauri_userKey');
      if (k) return k;
    } catch(e){}
    return 'chatbot_anon_' + Math.random().toString(36).slice(2, 10);
  }

  function sendMessage(){
    if (isSending) return;
    var text = (input.value || '').trim();
    if (!text) return;
    if (text.length > 500) {
      appendMessage('bot', 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯500æ–‡å­—ä»¥å†…ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚');
      return;
    }

    appendMessage('user', text);
    chatHistory.push({ role: 'user', content: text });
    input.value = '';
    input.style.height = 'auto';

    var matched = matchFaq(text);
    if (matched) {
      var ansDiv = appendMessageAndReturn('bot', matched.a);
      chatHistory.push({ role: 'assistant', content: matched.a });
      showAfterAnswer(ansDiv);
      return;
    }

    isSending = true;
    sendBtn.disabled = true;
    var typingEl = showTyping();

    runApi('apiChatbot', getUserKey_(), { message: text, history: chatHistory.slice(-6) })
      .then(function(res){
        removeTyping(typingEl);
        var reply = (res && res.reply) ? res.reply : '';
        var ansDiv;
        if (!reply || isUnanswerable(reply)) {
          var fallback = 'ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚ãŠæ¢ã—ã®æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚\n\nè©³ã—ãã¯ âœ‰ ãŠå•ã„åˆã‚ã› ã‚ˆã‚Šã‚¹ã‚¿ãƒƒãƒ•ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚\næ‹…å½“è€…ãŒç›´æ¥ã”å¯¾å¿œã„ãŸã—ã¾ã™ã€‚';
          ansDiv = appendMessageAndReturn('bot', fallback);
          chatHistory.push({ role: 'assistant', content: fallback });
        } else {
          ansDiv = appendMessageAndReturn('bot', reply);
          chatHistory.push({ role: 'assistant', content: reply });
        }
        if (chatHistory.length > 20) chatHistory = chatHistory.slice(-12);
        showAfterAnswer(ansDiv);
      })
      .catch(function(){
        removeTyping(typingEl);
        var fallback = 'ä¸€æ™‚çš„ã«æ¥ç¶šã§ãã¾ã›ã‚“ã§ã—ãŸã€‚\n\nãŠæ‰‹æ•°ã§ã™ãŒã€ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ã„ãŸã ãã‹ã€âœ‰ ãŠå•ã„åˆã‚ã› ã‚ˆã‚Šã‚¹ã‚¿ãƒƒãƒ•ã«ã”é€£çµ¡ãã ã•ã„ã€‚';
        var ansDiv = appendMessageAndReturn('bot', fallback);
        chatHistory.push({ role: 'assistant', content: fallback });
        showAfterAnswer(ansDiv);
      })
      .finally(function(){
        isSending = false;
        sendBtn.disabled = false;
        input.focus();
      });
  }

  fab.addEventListener('click', toggleChat);
  closeBtn.addEventListener('click', function() { window.closeChatbot(); });
  if (headerToTop) {
    headerToTop.addEventListener('click', function() { window.scrollTo({ top: 0, behavior: 'smooth' }); });
  }
  sendBtn.addEventListener('click', sendMessage);
  input.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
  });
  input.addEventListener('input', function() {
    this.style.height = 'auto';
    this.style.height = Math.min(this.scrollHeight, 80) + 'px';
  });

  if (badge) setTimeout(function() { badge.classList.add('show'); }, 3000);
})();

// ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒˆãƒƒãƒ—ãƒœã‚¿ãƒ³ & ãƒ¢ãƒ¼ãƒ€ãƒ«æ™‚ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆéè¡¨ç¤º
(function() {
  var topBtn = document.getElementById('toTopBtn');
  var chatFab = document.getElementById('chatbotFab');
  var threshold = 400;
  var ticking = false;

  window.updateToTopBtn_ = function() {
    var chatOpen = window._chatbotIsOpen;
    var hasModal = document.querySelector('.bulk-modal[style*="display: block"]') ||
                   document.querySelector('.bulk-modal[style*="display:block"]') ||
                   (document.getElementById('productModal') && document.getElementById('productModal').classList.contains('active'));
    if (chatOpen || hasModal) {
      if (topBtn) topBtn.classList.remove('show');
      return;
    }
    var y = window.pageYOffset || document.documentElement.scrollTop || 0;
    if (y > threshold) { if (topBtn) topBtn.classList.add('show'); }
    else { if (topBtn) topBtn.classList.remove('show'); }
  };

  window.hideFabsForModal_ = function() {
    if (chatFab) chatFab.style.display = 'none';
    if (topBtn) topBtn.classList.remove('show');
  };

  window.showFabsAfterModal_ = function() {
    if (chatFab) chatFab.style.display = '';
    updateToTopBtn_();
  };

  if (topBtn) {
    topBtn.addEventListener('click', function() { window.scrollTo({ top: 0, behavior: 'smooth' }); });
  }

  var onScroll = function() {
    if (!ticking) { ticking = true; requestAnimationFrame(function() { ticking = false; updateToTopBtn_(); }); }
  };
  window.addEventListener('scroll', onScroll, { passive: true });
  window.addEventListener('resize', onScroll);
  updateToTopBtn_();
})();
</script>

<!--Start of Tawk.to Script-->
<!--
  Tawk.to ãƒ©ã‚¤ãƒ–ãƒãƒ£ãƒƒãƒˆè¨­å®š
  1. https://www.tawk.to/ ã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆï¼ˆç„¡æ–™ï¼‰
  2. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã® Administration > Chat Widget > Direct Chat Link ã‹ã‚‰
     ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ID ã¨ ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆID ã‚’å–å¾—
     ï¼ˆURLå½¢å¼: https://tawk.to/chat/PROPERTY_ID/WIDGET_IDï¼‰
  3. ä¸‹ã® YOUR_TAWK_PROPERTY_ID ã¨ YOUR_TAWK_WIDGET_ID ã‚’å®Ÿéš›ã®IDã«ç½®ãæ›ãˆã‚‹
  4. è¨­å®šå®Œäº†å¾Œã€ã€Œã‚¹ã‚¿ãƒƒãƒ•ã«å•ã„åˆã‚ã›ã‚‹ã€ãƒœã‚¿ãƒ³ã‹ã‚‰ãƒ©ã‚¤ãƒ–ãƒãƒ£ãƒƒãƒˆãŒèµ·å‹•
-->
<script type="text/javascript">
var Tawk_API=Tawk_API||{};
Tawk_API.onLoad=function(){ Tawk_API.hideWidget(); };
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/YOUR_TAWK_PROPERTY_ID/YOUR_TAWK_WIDGET_ID';
s1.charset='UTF-8';s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();
</script>
<!--End of Tawk.to Script-->
<!-- === å‰¯æ¥­ç‰©è²©ãŠå½¹ç«‹ã¡æƒ…å ± === -->
<style>
.article-fab{position:fixed;left:16px;bottom:16px;z-index:90;display:flex;align-items:center;gap:6px;padding:8px 12px;border-radius:999px;background:rgba(30,41,59,.75);color:#fff;border:none;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,.15);font-weight:600;font-size:12px;font-family:inherit;line-height:1.2;white-space:nowrap;transition:transform .2s,box-shadow .2s;backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);}
.article-fab:hover{transform:scale(1.05);box-shadow:0 4px 12px rgba(0,0,0,.2);}
.article-fab .article-fab-emoji{font-size:16px;}
.article-fab .article-fab-badge{display:none!important;}
.article-panel{position:fixed;left:16px;bottom:60px;z-index:91;width:360px;max-width:calc(100vw - 32px);height:480px;max-height:calc(100vh - 120px);background:rgba(255,255,255,.95);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border-radius:16px;box-shadow:0 8px 32px rgba(0,0,0,.18);display:none;flex-direction:column;overflow:hidden;border:1px solid rgba(230,232,238,.6);}
.article-panel.open{display:flex;}
.article-panel-header{padding:12px 14px;background:rgba(30,41,59,.9);color:#fff;display:flex;align-items:center;justify-content:space-between;flex-shrink:0;}
.article-panel-title{font-weight:900;font-size:15px;display:flex;align-items:center;gap:6px;}
.article-panel-close{background:rgba(255,255,255,.2);border:none;color:#fff;width:30px;height:30px;border-radius:50%;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .15s;}
.article-panel-close:hover{background:rgba(255,255,255,.35);}
.article-search{padding:8px 12px;border-bottom:1px solid #f0f0f0;flex-shrink:0;display:none;}
.article-search-input{width:100%;padding:8px 10px;border:1px solid #ddd;border-radius:8px;font-size:13px;font-family:inherit;outline:none;box-sizing:border-box;transition:border-color .2s;}
.article-search-input:focus{border-color:#64748b;}
.article-search-input::placeholder{color:#aaa;}
.article-panel-body{flex:1;overflow-y:auto;padding:0;-webkit-overflow-scrolling:touch;}
.article-list{list-style:none;margin:0;padding:0;}
.article-list-item{padding:12px 14px;border-bottom:1px solid #f0f0f0;cursor:pointer;transition:background .15s;}
.article-list-item:hover{background:rgba(241,245,249,.6);}
.article-list-item:last-child{border-bottom:none;}
.article-item-header{display:flex;align-items:flex-start;gap:8px;margin-bottom:4px;}
.article-item-emoji{font-size:22px;flex-shrink:0;line-height:1;}
.article-item-title{font-weight:900;font-size:14px;color:#1a1a2e;line-height:1.4;}
.article-item-meta{display:flex;align-items:center;gap:8px;margin-top:4px;padding-left:30px;}
.article-item-date{font-size:11px;color:#888;}
.article-item-category{font-size:10px;padding:2px 6px;border-radius:4px;background:#f1f5f9;color:#64748b;font-weight:700;}
.article-item-summary{font-size:12px;color:#666;margin-top:4px;padding-left:30px;line-height:1.5;}
.article-detail{display:none;padding:0;}
.article-detail.active{display:block;}
.article-detail-back{display:flex;align-items:center;gap:4px;padding:10px 14px;border-bottom:1px solid #f0f0f0;cursor:pointer;font-size:13px;font-weight:700;color:#64748b;background:transparent;border-top:none;border-left:none;border-right:none;width:100%;text-align:left;transition:background .15s;font-family:inherit;}
.article-detail-back:hover{background:#f8fafc;}
.article-detail-header{padding:14px;border-bottom:1px solid #f0f0f0;}
.article-detail-hero{width:100%;max-height:200px;object-fit:cover;border-radius:8px;margin-bottom:10px;display:block;}
.article-detail-title{font-weight:900;font-size:16px;color:#1a1a2e;line-height:1.4;margin-bottom:8px;}
.article-detail-meta{display:flex;align-items:center;gap:8px;flex-wrap:wrap;}
.article-detail-date{font-size:12px;color:#888;}
.article-detail-category{font-size:11px;padding:2px 8px;border-radius:4px;background:#f1f5f9;color:#64748b;font-weight:700;}
.article-detail-tags{font-size:11px;color:#888;}
.article-detail-content{padding:14px;font-size:14px;line-height:1.8;color:#333;}
.article-detail-content h3{font-size:15px;font-weight:900;margin:16px 0 8px;color:#1a1a2e;}
.article-detail-content p{margin:0 0 12px;}
.article-detail-content ul{margin:0 0 12px;padding-left:20px;}
.article-detail-content li{margin-bottom:4px;}
.article-detail-content strong{color:#1a1a2e;}
.article-loading{text-align:center;padding:40px 14px;color:#888;font-size:13px;}
.article-loading-spinner{display:inline-block;width:24px;height:24px;border:3px solid #f0f0f0;border-top-color:#64748b;border-radius:50%;animation:articleSpin .8s linear infinite;margin-bottom:8px;}
@keyframes articleSpin{to{transform:rotate(360deg);}}
.article-empty{text-align:center;padding:40px 14px;color:#888;font-size:13px;}
@media(max-width:480px){
  .article-panel.open{bottom:0;left:0;right:0;width:100%;max-width:100%;height:100%;max-height:100%;border-radius:0;z-index:110;}
  .article-fab{left:12px;bottom:12px;padding:7px 10px;font-size:11px;}
}
body.admin-mode .article-fab{bottom:136px;}
body.admin-mode .article-panel{bottom:186px;}
@media(max-width:480px){
  body.admin-mode .article-fab{bottom:136px;}
  body.admin-mode .article-panel.open{bottom:0;height:100%;max-height:100%;}
}
/* --- PCå·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆé€éï¼‰ --- */
@media(min-width:1440px){
  .article-fab{display:none !important;}
  .article-panel{display:flex !important;position:fixed;left:0;top:0;bottom:0;width:calc(50vw - 550px);max-width:320px;min-width:200px;height:100vh;max-height:100vh;border-radius:0;box-shadow:none;border:none;background:transparent;z-index:50;right:auto;}
  .article-panel-header{padding:10px 14px;background:transparent;}
  .article-panel-title{color:#1e293b;}
  .article-panel-close{display:none;}
  .article-search{display:block;}
  .article-search-input{background:rgba(255,255,255,.6);}
  .article-item-summary{display:none;}
  .article-item-header{margin-bottom:0;}
  .article-list-item{padding:10px 12px;}
  .article-item-emoji{font-size:16px;}
  .article-item-title{font-size:13px;}
  .article-item-meta{padding-left:24px;margin-top:2px;}
  body.admin-mode .article-panel{top:0;bottom:0;width:calc(50vw - 550px);max-width:320px;min-width:200px;}
}
/* ====== ãƒ¢ãƒã‚¤ãƒ«å›ºå®šæ±ºæ¸ˆãƒãƒ¼ ====== */
#bulkStickyPay{display:none;position:fixed;bottom:0;left:0;right:0;z-index:150;background:linear-gradient(135deg,#1a1a2e,#16213e);padding:10px 16px;box-shadow:0 -3px 14px rgba(0,0,0,.45);align-items:center;justify-content:space-between;gap:12px}
#bulkStickyPay.active{display:flex}
#bulkStickyPayInfo{color:#fff;line-height:1.3;min-width:0}
#bulkStickyPayInfo small{display:block;font-size:10px;color:#93c5fd;font-weight:400}
#bulkStickyPayInfo strong{font-size:16px;font-weight:800}
#bulkStickyPayBtn{flex-shrink:0;background:linear-gradient(135deg,#e53e3e,#c53030);color:#fff;border:none;border-radius:10px;padding:11px 20px;font-size:14px;font-weight:800;cursor:pointer;white-space:nowrap;box-shadow:0 2px 8px rgba(220,38,38,.4)}
#bulkStickyPayBtn:disabled{background:#555;box-shadow:none;cursor:not-allowed}
@media(max-width:767px){body.has-bulk-cart{padding-bottom:68px}}
@media(min-width:768px){
  #bulkStickyPay{display:none!important}
  .pc-two-col>div:first-child{position:sticky;top:60px;max-height:80vh;overflow-y:auto}
}
</style>
<button class="article-fab" id="articleFab" type="button" aria-label="å‰¯æ¥­ç‰©è²©ãŠå½¹ç«‹ã¡æƒ…å ±">
  <span class="article-fab-emoji">ğŸ’¡</span>
  <span class="article-fab-badge" id="articleBadge"></span>
</button>
<div class="article-panel" id="articlePanel">
  <div class="article-panel-header">
    <span class="article-panel-title">ğŸ’¡ å‰¯æ¥­ç‰©è²©ãŠå½¹ç«‹ã¡æƒ…å ±</span>
    <button class="article-panel-close" id="articlePanelClose" type="button" aria-label="é–‰ã˜ã‚‹">&times;</button>
  </div>
  <div class="article-search" id="articleSearch">
    <input type="text" class="article-search-input" id="articleSearchInput" placeholder="è¨˜äº‹ã‚’æ¤œç´¢...">
  </div>
  <div class="article-panel-body" id="articlePanelBody">
    <div id="articleListView">
      <div class="article-loading" id="articleLoading"><div class="article-loading-spinner"></div><div>è¨˜äº‹ã‚’èª­ã¿è¾¼ã¿ä¸­...</div></div>
      <ul class="article-list" id="articleList"></ul>
      <div class="article-empty" id="articleEmpty" style="display:none;">ã¾ã è¨˜äº‹ãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br>æ¯æ—¥æ–°ã—ã„è¨˜äº‹ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚</div>
    </div>
    <div class="article-detail" id="articleDetailView">
      <button class="article-detail-back" id="articleDetailBack" type="button">â† è¨˜äº‹ä¸€è¦§ã«æˆ»ã‚‹</button>
      <div class="article-detail-header" id="articleDetailHeader"></div>
      <div class="article-detail-content" id="articleDetailContent"></div>
    </div>
  </div>
</div>
<script>
(function(){
  var fab=document.getElementById('articleFab'),panel=document.getElementById('articlePanel'),
      closeBtn=document.getElementById('articlePanelClose'),badge=document.getElementById('articleBadge'),
      searchInput=document.getElementById('articleSearchInput'),
      listView=document.getElementById('articleListView'),detailView=document.getElementById('articleDetailView'),
      listEl=document.getElementById('articleList'),loadingEl=document.getElementById('articleLoading'),
      emptyEl=document.getElementById('articleEmpty'),detailBack=document.getElementById('articleDetailBack'),
      detailHeader=document.getElementById('articleDetailHeader'),detailContent=document.getElementById('articleDetailContent');
  if(!panel)return;
  var isDesktop=window.matchMedia('(min-width:1440px)').matches;
  var isOpen=false,articlesLoaded=false,articlesData=[],detailCache={},LS_LAST_READ='detauri_article_last_read_date',LS_ARTICLES='detauri_articles_data';
  function loadArticlesCache_(){try{var raw=localStorage.getItem(LS_ARTICLES);if(!raw)return null;var c=JSON.parse(raw);if(c&&c.articles&&c.articles.length)return c.articles;return null;}catch(e){return null;}}
  function saveArticlesCache_(articles){try{localStorage.setItem(LS_ARTICLES,JSON.stringify({ts:Date.now(),articles:articles}));}catch(e){}}
  function positionSidebar(){if(!panel||!isDesktop)return;var wrap=document.querySelector('.container');if(!wrap)return;var wl=wrap.getBoundingClientRect().left;var w=Math.min(320,Math.max(200,wl));panel.style.left=(wl-w)+'px';panel.style.width=w+'px';panel.style.maxWidth=w+'px';panel.style.right='auto';}
  // localStorageã‹ã‚‰å³åº§ã«è¨˜äº‹ã‚’å¾©å…ƒï¼ˆãƒšãƒ¼ã‚¸é·ç§»å¾Œã‚‚å³è¡¨ç¤ºï¼‰
  var _cached=loadArticlesCache_();if(_cached){articlesData=_cached;articlesLoaded=true;renderList(articlesData);loadingEl.style.display='none';updateBadge();preloadImages_();if(isDesktop)setTimeout(prefetchAllContents,3000);}
  if(isDesktop){positionSidebar();window.addEventListener('resize',positionSidebar);}
  // è¨˜äº‹API: fetchã‚’å„ªå…ˆã—ã€å¤±æ•—æ™‚ã¯runApiã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆdocument.writeé·ç§»å¾Œã‚‚å®‰å®šå‹•ä½œï¼‰
  var _articleApiUrl=(typeof GAS_API_URL!=='undefined')?GAS_API_URL:'https://script.google.com/macros/s/AKfycbwLN23a03qQSGA91J-82_6HlIx0kA5yUYFRxjfbjFGfnZDqynKnyJhEPsoISSQps3SmXQ/exec';
  function articleFetch(action,arg){var body={action:action,args:arg?[arg]:[]};return fetch(_articleApiUrl,{method:'POST',headers:{'Content-Type':'text/plain'},body:JSON.stringify(body),redirect:'follow'}).then(function(r){if(!r.ok)throw new Error('HTTP '+r.status);return r.json();}).catch(function(e){if(typeof runApi==='function')return runApi(action,arg);throw e;});}
  function fmtDate(s){if(!s)return '';var str=String(s);if(/^\d{4}\/\d{2}\/\d{2}\(.\)$/.test(str))return str;var d=new Date(str);if(isNaN(d.getTime()))return str;var dd=['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'];return d.getFullYear()+'/'+String(d.getMonth()+1).padStart(2,'0')+'/'+String(d.getDate()).padStart(2,'0')+'('+dd[d.getDay()]+')';}
  function updateBadge(){if(!badge)return;try{var lr=localStorage.getItem(LS_LAST_READ)||'';if(!lr||!articlesData.length){badge.style.display='none';return;}var u=0;for(var i=0;i<articlesData.length;i++){var pd=String(articlesData[i].publishDate||'').replace(/\(.\)/,'').replace(/\//g,'-');if(pd>lr)u++;}if(u>0){badge.textContent=u>9?'9+':String(u);badge.style.display='flex';}else{badge.style.display='none';}}catch(e){badge.style.display='none';}}
  if(isDesktop){fetchArticles();}else{if(fab)fab.addEventListener('click',function(){if(isOpen)closePanel();else openPanel();});if(closeBtn)closeBtn.addEventListener('click',function(){closePanel();});setTimeout(function(){if(!articlesLoaded){articleFetch('apiGetArticles').then(function(r){if(r&&r.ok&&r.articles){articlesData=r.articles;articlesLoaded=true;saveArticlesCache_(r.articles);renderList(articlesData);loadingEl.style.display='none';updateBadge();preloadImages_();}}).catch(function(){});}},3000);}
  detailBack.addEventListener('click',function(){showListView();});
  if(searchInput)searchInput.addEventListener('input',function(){var q=this.value.toLowerCase().trim();if(!q){renderList(articlesData);return;}var f=[];for(var i=0;i<articlesData.length;i++){var a=articlesData[i];if((a.title||'').toLowerCase().indexOf(q)!==-1||(a.summary||'').toLowerCase().indexOf(q)!==-1||(a.category||'').toLowerCase().indexOf(q)!==-1)f.push(a);}renderList(f);showListView();});
  function openPanel(){isOpen=true;panel.classList.add('open');if(!articlesLoaded){fetchArticles();}else{loadingEl.style.display='none';if(articlesData.length>0){renderList(articlesData);}else{emptyEl.style.display='block';}}setTimeout(prefetchAllContents,2000);try{var n=new Date();localStorage.setItem(LS_LAST_READ,n.getFullYear()+'-'+String(n.getMonth()+1).padStart(2,'0')+'-'+String(n.getDate()).padStart(2,'0'));}catch(e){}if(badge)badge.style.display='none';showListView();}
  function closePanel(){isOpen=false;panel.classList.remove('open');}
  function showListView(){listView.style.display='block';detailView.classList.remove('active');}
  function showDetailView(){listView.style.display='none';detailView.classList.add('active');}
  function fetchArticles(){if(!articlesLoaded){loadingEl.style.display='block';emptyEl.style.display='none';listEl.innerHTML='';}articleFetch('apiGetArticles').then(function(r){loadingEl.style.display='none';articlesLoaded=true;if(!r||!r.ok||!r.articles||r.articles.length===0){if(!articlesData.length)emptyEl.style.display='block';return;}articlesData=r.articles;saveArticlesCache_(r.articles);renderList(articlesData);updateBadge();preloadImages_();if(isDesktop)setTimeout(prefetchAllContents,2000);}).catch(function(){loadingEl.style.display='none';if(!articlesData.length){emptyEl.textContent='è¨˜äº‹ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚';emptyEl.style.display='block';}});}
  function renderList(articles){listEl.innerHTML='';if(!articles.length){emptyEl.style.display='block';return;}emptyEl.style.display='none';for(var i=0;i<articles.length;i++){var a=articles[i];var li=document.createElement('li');li.className='article-list-item';li.setAttribute('data-article-id',a.id);li.innerHTML='<div class="article-item-header"><span class="article-item-emoji">'+esc(a.emoji)+'</span><span class="article-item-title">'+esc(a.title)+'</span></div><div class="article-item-meta"><span class="article-item-date">'+esc(fmtDate(a.publishDate))+'</span><span class="article-item-category">'+esc(a.category)+'</span></div><div class="article-item-summary">'+esc(a.summary)+'</div>';li.addEventListener('click',(function(id){return function(){loadDetail(id);};})(a.id));listEl.appendChild(li);}}
  var LS_CONTENT='detauri_article_contents';
  function loadContentCache_(){try{var r=localStorage.getItem(LS_CONTENT);return r?JSON.parse(r):{};}catch(e){return {};}}
  function saveContentCache_(){try{localStorage.setItem(LS_CONTENT,JSON.stringify(detailCache));}catch(e){}}
  try{var _cc=loadContentCache_();if(_cc){for(var _k in _cc)if(_cc.hasOwnProperty(_k))detailCache[_k]=_cc[_k];}}catch(e){}
  // ãƒ˜ãƒƒãƒ€ç”»åƒãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«å…ˆèª­ã¿ï¼‰
  function preloadImages_(){for(var i=0;i<articlesData.length;i++){var u=articlesData[i].imageUrl;if(u){new Image().src=u;}}}
  // ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å…¨è¨˜äº‹æœ¬æ–‡ã‚’ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒï¼ˆæœªã‚­ãƒ£ãƒƒã‚·ãƒ¥åˆ†ã®ã¿ã€é †æ¬¡å–å¾—ï¼‰
  var _prefetchRunning=false;
  function prefetchAllContents(){if(_prefetchRunning||!articlesData.length)return;_prefetchRunning=true;var ids=[];for(var i=0;i<articlesData.length;i++){var aid=articlesData[i].id;if(!detailCache[aid])ids.push(aid);}if(!ids.length){_prefetchRunning=false;return;}var idx=0;var delay=isDesktop?800:1500;function next(){if(idx>=ids.length){_prefetchRunning=false;return;}var id=ids[idx++];articleFetch('apiGetArticleContent',id).then(function(r){if(r&&r.ok&&r.article){detailCache[id]=r.article;saveContentCache_();}setTimeout(next,delay);}).catch(function(){setTimeout(next,delay+500);});}next();}
  function loadDetail(id){showDetailView();if(detailCache[id]){renderDetail(detailCache[id]);return;}detailHeader.innerHTML='';detailContent.innerHTML='<div class="article-loading"><div class="article-loading-spinner"></div><div>è¨˜äº‹ã‚’èª­ã¿è¾¼ã¿ä¸­...</div></div>';articleFetch('apiGetArticleContent',id).then(function(r){if(!r||!r.ok||!r.article){detailContent.innerHTML='<div class="article-empty">è¨˜äº‹ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</div>';return;}detailCache[id]=r.article;saveContentCache_();renderDetail(r.article);}).catch(function(){detailContent.innerHTML='<div class="article-empty">è¨˜äº‹ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</div>';});}
  function renderDetail(a){var th='';if(a.tags){var ta=a.tags.split(','),p=[];for(var i=0;i<ta.length;i++){var t=ta[i].trim();if(t)p.push('#'+esc(t));}th='<span class="article-detail-tags">'+p.join(' ')+'</span>';}var hero=a.imageUrl?'<img class="article-detail-hero" src="'+esc(a.imageUrl)+'" alt="" loading="lazy">':'';detailHeader.innerHTML=hero+'<div class="article-detail-title">'+esc(a.emoji)+' '+esc(a.title)+'</div><div class="article-detail-meta"><span class="article-detail-date">'+esc(fmtDate(a.publishDate))+'</span><span class="article-detail-category">'+esc(a.category)+'</span>'+th+'</div>';detailContent.innerHTML=san(a.content);}
  function esc(t){var d=document.createElement('div');d.appendChild(document.createTextNode(t||''));return d.innerHTML;}
  function san(h){var s=String(h||'');s=s.replace(/<script[\s\S]*?<\/script>/gi,'');s=s.replace(/<style[\s\S]*?<\/style>/gi,'');s=s.replace(/<iframe[\s\S]*?<\/iframe>/gi,'');s=s.replace(/<object[\s\S]*?<\/object>/gi,'');s=s.replace(/<embed[\s\S]*?>/gi,'');s=s.replace(/<link[\s\S]*?>/gi,'');s=s.replace(/\son\w+\s*=\s*"[^"]*"/gi,'');s=s.replace(/\son\w+\s*=\s*'[^']*'/gi,'');s=s.replace(/\son\w+\s*=[^\s>]*/gi,'');s=s.replace(/javascript\s*:/gi,'');return s;}
})();
</script>
<!-- ãƒ¢ãƒã‚¤ãƒ«å›ºå®šæ±ºæ¸ˆãƒãƒ¼ -->
<div id="bulkStickyPay">
  <div id="bulkStickyPayInfo"><small>ãŠæ”¯æ‰•ã„åˆè¨ˆ</small><strong id="bulkStickyPayTotal">Â¥0</strong></div>
  <button id="bulkStickyPayBtn" onclick="submitOrder()" disabled>ãŠæ”¯æ‰•ã„ã¸ â†’</button>
</div>
</body>
</html>
